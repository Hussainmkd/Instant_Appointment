
var custom_label_map={"English":{},"Urdu":{}};function GetCustomLabel(name)
{return custom_label_map[current_language][name];}
Runner.namespace('Runner.util');(function(){var createDelayed=function(hn,obj,scope){return function(){var argsArr=Array.prototype.slice.call(arguments,0);setTimeout(function(){hn.apply(scope,argsArr);},obj.delay||10);};};var createSingle=function(hn,e,fn,scope){return function(){e.removeListener(fn,scope);return hn.apply(scope,arguments);};};var createBuffered=function(hn,obj,scope){var task=new Runner.util.DelayedTask();return function(){task.delay(obj.buffer,hn,scope,Array.prototype.slice.call(arguments,0));};};Runner.util.Event=function(obj,name){this.name=name;this.obj=obj;this.listeners=[];};Runner.util.Event.prototype={session:null,createListener:function(fn,scope,obj){obj=obj||{};scope=scope||this.obj;var ls={fn:fn,scope:scope,options:obj};var hn=fn;if(obj.delay){hn=createDelayed(hn,obj,scope);}
if(obj.single){hn=createSingle(hn,this,fn,scope);}
if(obj.buffer){hn=createBuffered(hn,obj,scope);}
ls.fireFn=hn;return ls;},getListenerIndex:function(fn,scope){scope=scope||this.obj;var length=this.listeners.length,ls;for(var i=0;i<length;i++){ls=this.listeners[i];if(ls.fn==fn&&ls.scope==scope){return i;}}
return-1;},fire:function(){var scope,ls,length=this.listeners.length;if(this.listeners.length>0){this.firing=true;var argsArr=Array.prototype.slice.call(arguments,0);for(var i=0;i<this.listeners.length;i++){ls=this.listeners[i];if(this.session===null||ls.session==this.session){if(ls.fireFn.apply(ls.scope||this.obj||window,arguments)===false){this.firing=false;return false;}}}
this.firing=false;}
return true;},on:function(fn,scope,options,session){scope=scope||this.obj;if(!this.isListening(fn,scope)){ls=this.createListener(fn,scope,options);ls.session=session;if(!this.firing){this.listeners.push(ls);}else{this.listeners.push(ls);}}},isListening:function(fn,scope){return this.getListenerIndex(fn,scope)!=-1;},removeListener:function(fn,scope){var index;if((index=this.getListenerIndex(fn,scope))!=-1){if(!this.firing){this.listeners.splice(index,1);}else{this.listeners=this.listeners.slice(0);this.listeners.splice(index,1);}
return true;}
return false;},clearListeners:function(){this.listeners=[];}};})();Runner.util.Observable=Runner.extend(Runner.emptyFn,{session:0,filterOptRe:/^(?:scope|delay|buffer|single)$/,addEvents:function(obj){if(!this.events){this.events={};}
if(typeof obj=='string'){for(var i=0,a=arguments,v;v=a[i];i++){if(!this.events[a[i]]){this.events[a[i]]=true;}}}else{Runner.apply(this.events,obj);}},fireEventFilesLoaded:function(){if(this.eventsSuspended!==true){var ce=this.events[arguments[0].toLowerCase()];if(typeof ce=="object"){ce.session=arguments[1];var r=ce.fire.apply(ce,Array.prototype.slice.call(arguments,1));ce.session=null;return r;}}
return true;},fireEvent:function(){if(this.eventsSuspended!==true){var ce=this.events[arguments[0].toLowerCase()];if(typeof ce=="object"){return ce.fire.apply(ce,Array.prototype.slice.call(arguments,1));}}
return true;},on:function(evName,fn,scope,obj){if(typeof evName=="object"){obj=evName;for(var event in obj){if(this.filterOptRe.test(event)){continue;}
if(typeof obj[event]=="function"){this.on(event,obj[event],obj.scope,obj);}else{this.on(event,obj[event].fn,obj[event].scope,obj[event]);}}
return;}
obj=(!obj||typeof obj=="boolean")?{}:obj;evName=evName.toLowerCase();var ce=this.events[evName]||true;if(typeof ce=="boolean"){ce=new Runner.util.Event(this,evName);this.events[evName]=ce;}
ce.on(fn,scope,obj,this.session);},un:function(evName,fn,scope){var ce=this.events[evName.toLowerCase()];if(typeof ce=="object"){ce.removeListener(fn,scope);}},purgeListeners:function(){for(var event in this.events){if(typeof this.events[event]=="object"){this.events[event].clearListeners();}}},suspendEvents:function(){this.eventsSuspended=true;},resumeEvents:function(){this.eventsSuspended=false;}});Runner.namespace('Runner.util');Runner.util.DelayedTask=function(fn,scope,args){var id=null,delay,time;var call=function(){var now=new Date().getTime();if(now-time>=delay){clearInterval(id);id=null;fn.apply(scope,args||[]);}};this.delay=function(newDelay,newFn,newScope,newArgs){if(id&&delay!=newDelay){this.cancel();}
delay=newDelay;time=new Date().getTime();fn=newFn||fn;scope=newScope||scope;args=newArgs||args;if(!id){id=setInterval(call,delay);}};this.cancel=function(){if(id){clearInterval(id);id=null;}};};Runner.util.ScriptLoader=Runner.extend(Runner.util.Observable,{cssFiles:[],jsFiles:[],constructor:function(cfg){Runner.util.ScriptLoader.superclass.constructor.call(this,cfg);this.addEvents('filesLoaded');this.on('filesLoaded',function(){if(Runner.pages){Runner.pages.PageManager.initPages();}},this,{single:true});},addJS:function(files){var self=this,isAdded=false;for(var i=0;i<files.length;i++){for(var j=0;j<this.jsFiles.length;j++){if(this.jsFiles[j].name==files[i]){isAdded=true;break;}}
if(!isAdded){var req=[],onload=null,arg=Array.prototype.slice.call(arguments,1);for(var k=0;k<arg.length;k++){if(typeof(arg[k])==typeof('string')){req.push(arg[k]);}
if(typeof(arg[k])==typeof(function(){})){onload=function(f){return f;}(arg[k]);}}
this.jsFiles.push({name:files[i],isLoaded:false,requirements:Array.prototype.slice.call(arguments,1),'onload':onload,session:parseInt(self.session)});}
isAdded=false;}},loadCSS:function(files,loadIE){for(var i=0;i<files.length;i++){var idx=this.cssFiles.getIndexOfElem(files[i],function(val,arrElem){if(val==arrElem.name){return true;}});if(idx!=-1&&this.cssFiles[idx].isLoaded){continue;}
this.cssFiles.push({name:files[i],isLoaded:true})
var existInHead=false;$('head link[rel="stylesheet"]').each(function(index,element){if($(element).attr('href')==files[i]+".css"){existInHead=true;return false;}});if(existInHead)
continue;var head=$(document).find('head')[0];var css=document.createElement('link');css.setAttribute('rel','stylesheet');css.setAttribute('type','text/css');css.setAttribute('href',files[i]+".css");head.appendChild(css);if(loadIE&&Runner.isIE){css=document.createElement('link');css.setAttribute('rel','stylesheet');css.setAttribute('type','text/css');css.setAttribute('href',files[i]+"IE.css");head.appendChild(css);}}},load:function(){this.session=this.session+1;if(this.jsFiles.length==0){this.fireEventFilesLoaded('filesLoaded',this.session-1);}
for(var i=0;i<this.jsFiles.length;i++){this.loadJS(i);}},loadJS:function(idx){if(!this.jsFiles[idx]){return false;}
if(this.jsFiles[idx].isLoaded){this.jsFiles[idx].session=this.session-1;this.postLoad(idx);return true;}
if(!this.checkReq(this.jsFiles[idx])){return false;}
if(this.jsFiles[idx].isStarted){return false;}
this.jsFiles[idx].isStarted=true;var js=document.createElement('script');js.setAttribute('type','text/javascript');var initFuncName=this.jsFiles[idx].name.replace('.js','')+'_init';initFuncName=initFuncName.replace(/[\/\\.]/g,"_");var sl=this;var onload=this.jsFiles[idx].onload;var fileName=this.jsFiles[idx].name;var postLoadFunction=function(){var tl=true;if(typeof(window[initFuncName])==typeof(function(){})){tl=window[initFuncName].call(sl,idx);}
if(typeof(onload)==typeof(function(){})){tl=onload.call(sl,idx,tl);}
if(tl!==false){sl.postLoad(idx);}};if(Runner.isIE){js.onreadystatechange=function(){if(js.readyState=='complete'||js.readyState=='loaded'){postLoadFunction();}};}else{js.onload=postLoadFunction;}
js.setAttribute('src',this.jsFiles[idx].name);document.getElementsByTagName('HEAD')[0].appendChild(js);return true;},checkReq:function(fileObj){for(var i=0;i<fileObj.requirements.length;i++){for(var j=0;j<this.jsFiles.length;j++){if(fileObj.requirements[i]==this.jsFiles[j].name&&!this.jsFiles[j].isLoaded){return false;}}}
return true;},postLoad:function(idx,session){var loadedAll=true;if(idx!==undefined){this.jsFiles[idx].isLoaded=true;this.loadDependent(idx);var session=this.jsFiles[idx].session;}
for(var i=0;i<this.jsFiles.length;i++){if(!this.jsFiles[i].isLoaded){loadedAll=false;break;}}
if(loadedAll){if($.inArray(session,this.loadedSes)==-1){this.fireEventFilesLoaded('filesLoaded',session);this.loadedSes.push(session);}
if(idx!==undefined){for(var i=0;i<this.session;i++){this.postLoad(undefined,i);}}}},loadedSes:[],loadDependent:function(idx){for(var i=0;i<this.jsFiles.length;i++){for(var j=0;j<this.jsFiles[i].requirements.length;j++){if(i!=idx&&this.jsFiles[i].requirements[j]==this.jsFiles[idx].name){this.loadJS(i);}}}}});Runner.util.ScriptLoader=new Runner.util.ScriptLoader();Runner.namespace('Runner.bricks');Runner.bricks.BrickManager=Runner.extend(Runner.emptyFn,{elem:null,name:'',baseClass:'',hiddenClass:'',constructor:function(cfg){Runner.apply(this,cfg);this.getElemName();},getElemName:function(elem){if(this.name){return;}
if(typeof elem=='undefined'){elem=this.elem;}
if(elem.attr('class')){var cls=elem.attr('class').split(' ');for(var i=0;i<cls.length;i++){if(cls[i]){var pos=cls[i].indexOf(this.baseClass);if(pos>-1){this.name=cls[i].substr(pos+this.baseClass.length).trim();break;}}}}},hide:function(){this.elem.addClass(this.hiddenClass);},show:function(){this.elem.removeClass(this.hiddenClass);},visible:function(){return this.elem.is(':visible');}});Runner.bricks.Brick=Runner.extend(Runner.bricks.BrickManager,{contObj:false,contentElem:false,constructor:function(cfg){cfg.baseClass='runner-b-';cfg.hiddenClass='runner-hiddenbrick';Runner.bricks.Brick.superclass.constructor.call(this,cfg);this.getContainer();this.getContentElem();},getContentElem:function(){var brickContents=$('.runner-brickcontents',this.elem);if(brickContents.length){this.contentElem=brickContents;}else{this.contentElem=this.elem;}},getContainer:function(){var contElem=this.elem.closest('div');if(contElem.length){this.contObj=new Runner.bricks.Container({elem:contElem});}},hide:function(){Runner.bricks.Brick.superclass.hide.call(this);if(!this.contObj){return;}
var contBricks=this.contObj.getBricks(),visible=false;for(var i=0,l=contBricks.length;i<l;i++){if(contBricks[i].visible()){visible=true;break;}}
if(!visible){this.contObj.hide();}},show:function(){Runner.bricks.Brick.superclass.show.call(this);if(!this.contObj){return;}
this.contObj.show();},prepareToReplaceWith:function(newHTML){if(newHTML&&!$(newHTML).length||$(newHTML).length&&$(newHTML).html()){if(!this.visible()){this.show();}}else if(this.visible()){this.hide();}},replaceWith:function(newHTML){this.prepareToReplaceWith(newHTML);this.elem.replaceWith(newHTML);},replaceHTMLWith:function(newHTML){this.prepareToReplaceWith(newHTML);this.elem.empty().html(newHTML);},replaceContentWith:function(newContent){this.prepareToReplaceWith(newContent);this.contentElem.replaceWith(newContent);},replaceContentHTMLWith:function(newHTML){this.prepareToReplaceWith(newHTML);this.contentElem.empty().html(newHTML);}});Runner.bricks.Container=Runner.extend(Runner.bricks.BrickManager,{blockObj:false,constructor:function(cfg){cfg.baseClass='runner-c-';cfg.hiddenClass='runner-hiddencontainer';Runner.bricks.Container.superclass.constructor.call(this,cfg);this.getBlock();},getElemName:function(){Runner.bricks.Container.superclass.getElemName.call(this,$('table.runner-c:first',this.elem));},hide:function(){Runner.bricks.Container.superclass.hide.call(this);var bWrapperParent=this.getBWrapperParent();if(bWrapperParent){bWrapperParent.addClass('runner-hiddencontainer');}
if(!this.blockObj){return;}
var blockConts=this.blockObj.getContainers(),visible=false;for(var i=0,l=blockConts.length;i<l;i++){if(blockConts[i].visible()){visible=true;break;}}
if(!visible){this.blockObj.hide();}},getBWrapperParent:function(){var result=false,parent=$(this.elem).parent();while(parent&&parent.tagName()!='body'){if(parent.hasClass('runner-b-wrapper')){result=parent;break;}
parent=parent.parent();}
return result;},show:function(){Runner.bricks.Container.superclass.show.call(this);var bWrapperParent=this.getBWrapperParent();if(bWrapperParent){bWrapperParent.removeClass('runner-hiddencontainer');}
if(!this.blockObj){return;}
this.blockObj.show();},getBricks:function(){var bricksArr=[];$('[class*="runner-b-"]',this.elem).each(function(){bricksArr.push(new Runner.bricks.Brick({elem:$(this)}));});return bricksArr;},getBlock:function(elem){var blockElem;if(typeof elem=='undefined'){blockElem=this.elem.closest('td');}else{blockElem=elem.parent().closest('td');}
if(blockElem.hasClass('runner-wrapper')){this.getBlock(blockElem);}else if(blockElem.length){this.blockObj=new Runner.bricks.Block({elem:blockElem});}}});Runner.bricks.Block=Runner.extend(Runner.bricks.BrickManager,{constructor:function(cfg){cfg.baseClass='runner-';cfg.hiddenClass='runner-hiddenblock';Runner.bricks.Block.superclass.constructor.call(this,cfg);},getContainers:function(){var contsArr=[];$('[class*="runner-s-"]',this.elem).each(function(){contsArr.push(new Runner.bricks.Container({elem:$(this)}));});return contsArr;}});Runner.namespace('Runner.menu');Runner.menu.Manager=Runner.extend(Runner.emptyFn,{isDirRTL:false,init:function(){if($('html').attr('dir')=='RTL'){this.isDirRTL=true;}},itemClickHandler:function(event){var target=Runner.Event.prototype.getTarget(event),link=$('a:first',this)[0];if($(this).hasClass('Group')&&target.nodeName!='IMG'&&!link.href){$('.groupImg:first',this).click();return;}
if(target.nodeName=="A"){if(target.rel=='external'){return!window.open(target.href);}
return;}
Runner.Event.prototype.stopEvent(event);if(link.href){if(link.rel=='external'){return!window.open(link.href);}
window.location=link.href;}}});Runner.menu.QuickJump=Runner.extend(Runner.emptyFn,{selectCurrent:-1,init:function(){var menuObj=this;$(".runner-quickjump:first").prop("initialized","true");$(".runner-quickjump").bind({focus:function(){menuObj.selectCurrent=this.selectedIndex;},change:function(){if(this.options[this.selectedIndex].value){if($(this.options[this.selectedIndex]).attr('link')=='External'){window.open(this.options[this.selectedIndex].value);}else{window.location.href=this.options[this.selectedIndex].value;}}else{this.selectedIndex=menuObj.selectCurrent;}}});}});Runner.menu.Horizontal=Runner.extend(Runner.menu.Manager,{maxSubMenuWidth:0,maxGroupWidth:0,maxItemWidth:0,topItemHovered:false,topItemAbsPos:null,itemHovered:false,subMenu:null,init:function(){Runner.menu.Horizontal.superclass.init.call(this);this.bindHoverOnItems();this.setRaquoToTopItems();$(".runner-hmenu:first").prop("initialized","true");},findSubMenu:function(elem){this.subMenu=$('ul:first:has(li)',elem);},manageActiveClass:function(elem,toggle){if($(elem).attr('class')!='Separator'){if($('table:first',elem).length){$('.runner-menutab',elem).toggleClass('active',toggle);}else{$(elem).toggleClass('active',toggle);}}},bindHoverOnItems:function(){var menuObj=this;$('.runner-hmenu td, .runner-hmenu ul li').hover(function(){menuObj.findSubMenu(this);menuObj.manageActiveClass(this,true);if(menuObj.subMenu.length){menuObj.maxGroupWidth=0;if($(this).attr('view')=='topitem'){menuObj.topItemAbsPos=Runner.getAbsolutePosition(this,1);menuObj.maxItemWidth=menuObj.topItemAbsPos.width;menuObj.topItemHovered=false;}
menuObj.subMenu.css('display','block');$('li[parent='+(menuObj.subMenu.attr('id'))+'] a',menuObj.subMenu).each(function(){if(menuObj.maxGroupWidth<this.offsetWidth)
menuObj.maxGroupWidth=this.offsetWidth});if(!menuObj.topItemHovered&&menuObj.maxGroupWidth<menuObj.maxItemWidth){menuObj.maxSubMenuWidth=menuObj.maxItemWidth;}else{menuObj.maxSubMenuWidth=menuObj.maxGroupWidth;}
menuObj.maxSubMenuWidth+=20;menuObj.subMenu.css('width',''+menuObj.maxSubMenuWidth+'px');if(!menuObj.topItemHovered){if(menuObj.isDirRTL){menuObj.subMenu.css('left',''+(menuObj.topItemAbsPos.left+(menuObj.topItemAbsPos.width-menuObj.subMenu[0].offsetWidth))+'px');}else{menuObj.subMenu.css('left',''+(menuObj.topItemAbsPos.left)+'px');}
menuObj.subMenu.css('top',''+(menuObj.topItemAbsPos.top+menuObj.topItemAbsPos.height-1)+'px');}else{var raquoElement=$('.raquo',this)[0];menuObj.subMenu.css('top',''+this.offsetTop+'px');menuObj.subMenu.css('left',''+(Runner.getAbsolutePosition(raquoElement,1).left+raquoElement.offsetWidth-Runner.getAbsolutePosition(this,1).left+10)+'px');}
$('li[parent='+(menuObj.subMenu.attr('id'))+']',menuObj.subMenu).each(function(){$(this).css('width',''+menuObj.maxSubMenuWidth+'px');if(menuObj.isDirRTL){$('ul:first',this).css('right',''+menuObj.maxSubMenuWidth+'px');}else{$('ul:first',this).css('left',''+menuObj.maxSubMenuWidth+'px');}});menuObj.topItemHovered=true;menuObj.itemHovered=true;setTimeout(function(){if(Runner.menu.Horizontal.prototype.itemHovered){Runner.menu.Horizontal.prototype.itemHovered=false;}},150);}},function(){menuObj.itemHovered=false;menuObj.manageActiveClass(this,false);$('ul:first',this).css('display','none');});$('.runner-hmenu td, .runner-hmenu ul li').click(this.itemClickHandler);},setRaquoToTopItems:function(){$('a:first','.runner-hmenu td:has(ul:has(li)), .runner-hmenu li:has(ul:has(li))').each(function(){if(!$('b',this).length){$(this).after('<b class="raquo">&nbsp;&raquo;</b>');$(".runner-hmenu .raquo").css("color",$(this).css("color"));}});$('b.raquo:first','.runner-hmenu td[view=topitem]:has(ul:has(li.current))').append("&nbsp;<b class='subcur'>"+$(".runner-hmenu .curlink").attr('title')+"</b>");$('.runner-hmenu .subcur').css("color",$("runner-hmenu .curlink").css("color"));$('.runner-hmenu ul li ul li ul').css('top','0px');}});Runner.menu.SimpleVmenu=Runner.extend(Runner.menu.Manager,{itemHovered:false,topItemHovered:false,topItemAbsPos:null,subMenu:null,init:function(){Runner.menu.SimpleVmenu.superclass.init.call(this);this.bindHoverOnItems();this.setRaquoToTopItems();$(".runner-vmenu.simple:first").prop("initialized","true");},findSubMenu:function(elem){this.subMenu=$('ul:first:has(li)',elem);},manageActiveClass:function(elem,toggle){if(!$(elem).hasClass('Separator')){$(elem).toggleClass('active',toggle);}},bindHoverOnItems:function(){var menuObj=this;$('.runner-vmenu.simple, .runner-vmenu.simple ul li').hover(function(){menuObj.manageActiveClass(this,true);menuObj.findSubMenu(this);var vScroll=0;if(menuObj.subMenu.length){menuObj.subMenu.css('display','block');if(menuObj.isDirRTL&&$.browser.msie){$('.runner-vmenu.simple li.Separator[parent='+menuObj.subMenu.attr('id')+']',menuObj.subMenu).each(function(){$(this).addClass('runner-hiddenelem');});}
var subMenuOfW=menuObj.subMenu[0].offsetWidth;if($(this).attr('view')=='topitem'){menuObj.topItemAbsPos=Runner.getAbsolutePosition(this,1);menuObj.topItemHovered=false;}
if(!$.browser.msie&&(menuObj.subMenu[0].offsetHeight+menuObj.topItemAbsPos.top)>document.body.clientHeight){vScroll=10;}
var raquoElement=$('.raquo',this)[0],requoAbsPosLeft=Runner.getAbsolutePosition(raquoElement,1).left;if(!menuObj.topItemHovered){if(menuObj.isDirRTL){menuObj.subMenu.css('right',''+(raquoElement.offsetWidth-vScroll+20)+'px');}else{menuObj.subMenu.css('left',''+(requoAbsPosLeft+raquoElement.offsetWidth-vScroll+10)+'px');}
menuObj.subMenu.css('top',''+(menuObj.topItemAbsPos.top)+'px');}else{menuObj.subMenu.css('top',''+this.offsetTop+'px');if(menuObj.isDirRTL){menuObj.subMenu.css('right',''+(this.offsetWidth-vScroll)+'px');}else{menuObj.subMenu.css('left',''+(requoAbsPosLeft-Runner.getAbsolutePosition(this,1).left-vScroll+raquoElement.offsetWidth+10)+'px');}}
if(menuObj.isDirRTL){if($.browser.msie){$('.runner-vmenu.simple li.Separator[parent='+menuObj.subMenu.attr('id')+']',menuObj.subMenu).each(function(){$(this).css('width',''+subMenuOfW+'px');$(this).show();});}}
menuObj.itemHovered=true;menuObj.topItemHovered=true;setTimeout(function(){if(Runner.menu.SimpleVmenu.prototype.itemHovered){Runner.menu.SimpleVmenu.prototype.itemHovered=false;}},150);}},function(){menuObj.findSubMenu(this);menuObj.itemHovered=false;menuObj.manageActiveClass(this,false);if(menuObj.subMenu.length){menuObj.subMenu.css('display','none');}});$('.runner-vmenu.simple, .runner-vmenu.simple ul li').click(this.itemClickHandler);},setRaquoToTopItems:function(){$('.runner-vmenu.simple:has(ul:has(li)), .runner-vmenu.simple li:has(ul:has(li))').find('a:first').each(function(){if(!$('b',this).length){$(this).after('<b class="raquo">&nbsp;&raquo;</b>');$("b.raquo").css("color",$(this).css("color"));}});$('.runner-vmenu.simple[view=topitem]:has(ul:has(li.current))').find("b.raquo:first").append("&nbsp;<b class='subcur'>"+$(".runner-vmenu.simple a.curlink").attr('title')+"</b>");$(".runner-vmenu.simple .subcur").css("color",$(".runner-vmenu.simple .current").css("color"));}});Runner.menu.TreeLikeVmenu=Runner.extend(Runner.menu.Manager,{cookieRoot:"",curItem:null,curItemId:"",curItemLevel:-1,init:function(){if($('.runner-vmenu.tree .curlink').length){this.curItem=$('.runner-vmenu.tree .curlink').closest('tr');this.curItemId=$(this.curItem).attr('id');this.curItemLevel=this.getItemLevel(this.curItem);}
$('.runner-vmenu.tree[parent]').addClass('runner-hiddenelem');this.bindHoverOnItems();this.setCurrentStyle();this.toggleMenuGroup();this.manageExpandCollapse();this.openMenuOnLoad();$(".runner-vmenu.tree:first").prop("initialized","true");},getItemLevel:function(item){var clsItem=$(item).attr('class'),pos=clsItem.indexOf("level");if(pos==-1){return 0;}
return parseInt(clsItem.substr(pos+5,1),10);},bindHoverOnItems:function(){$('.runner-vmenu.tree[id^=item]').hover(function(){if($(this).parent().attr('class')!='Separator'){$(this).addClass('active');}},function(){if($(this).parent().attr('class')!='Separator'){$(this).removeClass('active');}});$('.runner-vmenu.tree[id^=item]').click(this.itemClickHandler);},setCurrentStyle:function(){$('.runner-vmenu.tree.Group[view=topitem]').each(function(){var group=this;$('.runner-vmenu.tree[topparent='+this.id+']').each(function(){if($(this).hasClass('current')){$(group).addClass('current');}});});},toggleMenuGroup:function(){var menuObj=this;$('.runner-vmenu.tree.Group span').click(function(){var spanItem=$(this).closest("tr"),spanItemId=spanItem.attr('id');if($('.groupImg',this).attr('src')=='images/plus.gif'){menuObj.showGroupChildren(spanItem,spanItemId);}
else if($('.groupImg',this).attr('src')=='images/minus.gif'){menuObj.hideGroupChildren(spanItem,spanItemId);if(spanItemId!=menuObj.curItemId&&menuObj.curItemLevel>menuObj.getItemLevel(spanItem)&&menuObj.hasCurrentItem(spanItem,spanItemId)){spanItem.addClass('current');}}
return false;});},showGroupChildren:function(item,itemId){var menuObj=this;if(!itemId){itemId=$(item).attr('id');}
$('.groupImg',item).attr('src','images/minus.gif');if(itemId!=this.curItemId&&$(item).hasClass('current'))
$(item).removeClass('current');$('.runner-vmenu.tree[parent='+itemId+']').each(function(){$(this).removeClass('runner-hiddenelem');if($(this).hasClass('Group')&&menuObj.curItemLevel>menuObj.getItemLevel(this)&&menuObj.hasCurrentItem(this)){menuObj.showGroupChildren(this);}});this.addToCookie(itemId);},hideGroupChildren:function(item,itemId){var menuObj=this;if(!itemId){itemId=$(item).attr('id');}
$('.groupImg',item).attr('src','images/plus.gif');$('.runner-vmenu.tree[parent='+itemId+']').each(function(){$(this).addClass('runner-hiddenelem');if($(this).hasClass('Group'))
menuObj.hideGroupChildren(this);});this.removeFromCookie(itemId);},hasCurrentItem:function(item,itemId){if(!itemId){itemId=$(item).attr('id');}
if($('.runner-vmenu.tree.[parent='+itemId+']').hasClass('current'))
return true;var colSubGroups=$('.runner-vmenu.tree.Group.[parent='+itemId+']').length;for(var i=0;i<colSubGroups;i++){if(this.hasCurrentItem($('.runner-vmenu.tree.Group.[parent='+itemId+']').get(i)))
return true;}
return false;},manageExpandCollapse:function(){var menuObj=this,expand=false;if($('.runner-vmenu.tree.Group[view=topitem]').length){$('.manage').css('display','block');$('.manage a').click(function(){if(expand){expand=false;$('.runner-vmenu.tree[parent]').addClass('runner-hiddenelem');$('.manage a').empty();$('img.groupImg').attr('src','images/plus.gif');$('.manage a').append('<img src=\"images/plus.gif\" border=0> &nbsp;&nbsp;'+Runner.lang.constants.TEXT_EXPAND_ALL);delete_cookie('openMenuGroupIds',menuObj.cookieRoot,'');if(menuObj.curItem){$('#'+menuObj.curItem.attr('topparent')).addClass('current');}}else{expand=true;$('.runner-vmenu.tree[parent]').removeClass('runner-hiddenelem');$('.manage a').empty();$('img.groupImg').attr('src','images/minus.gif');$('.manage a').append('<img src=\"images/minus.gif\" border=0> &nbsp;&nbsp;'+Runner.lang.constants.TEXT_COLLAPSE_ALL);$('.runner-vmenu.tree.Group').each(function(){menuObj.addToCookie(this.id);});if(menuObj.curItem){$('#'+menuObj.curItem.attr('topparent')).removeClass('current');}}
return false;});}},findCookieRoot:function(){var cutFrom=document.location['pathname'].indexOf('/',1);this.cookieRoot=document.location['pathname'].substr(0,(cutFrom+1));},addToCookie:function(menuGroupId){var openMenuGroupIds=get_cookie('openMenuGroupIds');if(openMenuGroupIds){if(openMenuGroupIds.indexOf(menuGroupId)==-1)
openMenuGroupIds+=";"+menuGroupId;}else
openMenuGroupIds=menuGroupId;set_cookie('openMenuGroupIds',openMenuGroupIds,'',this.cookieRoot,'','');this.toggleExpandCollapse();},removeFromCookie:function(menuGroupId){var openMenuGroupIds=get_cookie('openMenuGroupIds');if(openMenuGroupIds){openMenuGroupIds=openMenuGroupIds.replace((";"+menuGroupId),"");openMenuGroupIds=openMenuGroupIds.replace(menuGroupId,"");if(openMenuGroupIds.indexOf(';')==0)
openMenuGroupIds=openMenuGroupIds.substr(1,openMenuGroupIds.length);set_cookie('openMenuGroupIds',openMenuGroupIds,'',this.cookieRoot,'','');}
setTimeout(function(){Runner.menu.TreeLikeVmenu.prototype.toggleExpandCollapse();},500);},toggleExpandCollapse:function(){var visibleLength=$(".runner-vmenu.tree.subitem:visible").length,hiddenLength=$(".runner-vmenu.tree.subitem:hidden").length;if(visibleLength==0&&hiddenLength>0){$('.manage a').empty();$('.groupImg').attr('src','images/plus.gif');$('.manage a').append('<img src=\"images/plus.gif\" border=0> &nbsp;&nbsp;'+Runner.lang.constants.TEXT_EXPAND_ALL);}
else if(visibleLength!=0&&hiddenLength==0){$('.manage a').empty();$('.groupImg').attr('src','images/minus.gif');$('.manage a').append('<img src=\"images/minus.gif\" border=0> &nbsp;&nbsp;'+Runner.lang.constants.TEXT_COLLAPSE_ALL);}},openMenuOnLoad:function(){this.findCookieRoot();var openMenuGroupIds=get_cookie('openMenuGroupIds');if(openMenuGroupIds){var groupForOpenArr=openMenuGroupIds.split(";");for(var i=0;i<groupForOpenArr.length;i++){if(groupForOpenArr[i].indexOf('item')==-1){continue;}
var group=$('#'+groupForOpenArr[i]);group.removeClass('runner-hiddenelem');$('.runner-vmenu.tree[parent='+groupForOpenArr[i]+']').removeClass('runner-hiddenelem');$(".groupImg",group).attr("src","images/minus.gif");}
this.afterOpenMenuOnLoad();}
this.toggleExpandCollapse();},afterOpenMenuOnLoad:function(item){if(typeof item=='undefined'){if(this.curItem)
item=this.curItem;else
return;}
if(item.attr('view')=='topitem')
return;$('#'+item.attr('topparent')).removeClass('current');var itemPar=$('#'+item.attr('parent'));if($(".groupImg",itemPar).attr('src')=='images/plus.gif'){itemPar.addClass('current');if(itemPar.attr('view')!='topitem'){this.afterOpenMenuOnLoad(itemPar);}}}});Runner.controls.constants={FORMAT_NONE:'',FORMAT_DATE_SHORT:"Short Date",FORMAT_DATE_LONG:"Long Date",FORMAT_DATE_TIME:"Datetime",FORMAT_TIME:"Time",FORMAT_CURRENCY:"Currency",FORMAT_PERCENT:"Percent",FORMAT_HYPERLINK:"Hyperlink",FORMAT_EMAILHYPERLINK:"Email Hyperlink",FORMAT_FILE_IMAGE:"File-based Image",FORMAT_DATABASE_IMAGE:"Database Image",FORMAT_DATABASE_FILE:"Database File",FORMAT_FILE:"Document Download",FORMAT_LOOKUP_WIZARD:"Lookup wizard",FORMAT_PHONE_NUMBER:"Phone Number",FORMAT_NUMBER:"Number",FORMAT_HTML:"HTML",FORMAT_CHECKBOX:"Checkbox",FORMAT_MAP:"Map",FORMAT_CUSTOM:"Custom",EDIT_FORMAT_NONE:"",EDIT_FORMAT_TEXT_FIELD:"Text field",EDIT_FORMAT_TEXT_AREA:"Text area",EDIT_FORMAT_RTE:"RTE",EDIT_FORMAT_RTEINNOVA:"RTEINNOVA",EDIT_FORMAT_RTECK:"RTECK",EDIT_FORMAT_PASSWORD:"Password",EDIT_FORMAT_DATE:"Date",EDIT_DATE_SIMPLE:0,EDIT_DATE_SIMPLE_DP:11,EDIT_DATE_DD:12,EDIT_DATE_DD_DP:13,EDIT_FORMAT_TIME:"Time",EDIT_FORMAT_RADIO:"Radio button",EDIT_FORMAT_CHECKBOX:"Checkbox",EDIT_FORMAT_DATABASE_IMAGE:"Database image",EDIT_FORMAT_DATABASE_FILE:"Database file",EDIT_FORMAT_FILE:"Document upload",EDIT_FORMAT_LOOKUP_WIZARD:"Lookup wizard",EDIT_FORMAT_HIDDEN:"Hidden field",EDIT_FORMAT_READONLY:"Readonly",LCT_DROPDOWN:0,LCT_AJAX:1,LCT_LIST:2,LCT_CBLIST:3,LT_LISTOFVALUES:0,LT_LOOKUPTABLE:1,MODE_ADD:0,MODE_EDIT:1,MODE_SEARCH:2,MODE_LIST:3,MODE_PRINT:4,MODE_VIEW:5,MODE_INLINE_ADD:6,MODE_INLINE_EDIT:7,MODE_EXPORT:8};Runner.Event=Runner.extend(Runner.emptyFn,{events:null,listeners:null,elemsForEvent:null,suspendedEvents:null,constructor:function(){this.listeners=[];this.elemsForEvent=[];this.suspendedEvents=[];},init:function(){if(this.events.length==0){return false;}
for(var i=0;i<this.events.length;i++){if(typeof this[this.events[i]]=="function"){this.on(this.events[i],this[this.events[i]]);}else if(typeof this[this.events[i]]=="object"){this.on(this.events[i],this[this.events[i]].fn,this[this.events[i]].options,this[this.events[i]].scope);}}
return true;},suspendEvent:function(eventArr){for(var i=0;i<eventArr.length;i++){if(!this.suspendedEvents.isInArray(eventArr[i])){this.suspendedEvents.push(eventArr[i]);}}},resumeEvent:function(eventArr){var eventInd=-1;for(var i=0;i<eventArr.length;i++){eventInd=this.suspendedEvents.getIndexOfElem(eventArr[i]);if(eventInd!=-1){this.suspendedEvents.splice(eventInd,1);}}},createDelayed:function(handler,timeout){return function(){var obj=this,args=Array.prototype.slice.call(arguments);setTimeout(function(){handler.apply(obj,args);},timeout||10);};},createBuffered:function(handler,buffer){var task=new Runner.util.DelayedTask(handler);return function(){task.delay(buffer,handler,null,Array.prototype.slice.call(arguments));};},createSingle:function(handler,eventName){var obj=this;return function(){handler.apply(obj,Array.prototype.slice.call(arguments));obj.unbindHn(eventName,arguments.callee);};},bindHn:function(eventName,callHandler){if(!callHandler||!eventName){return false;}
var el;for(var i=0;i<this.elemsForEvent.length;i++){el=this.elemsForEvent[i];$(el).bind(eventName,{hn:callHandler,obj:this},callHandler);}
return true;},unbindHn:function(eventName,callHandler){if(!callHandler||!eventName){return false;}
var el;for(var j=0;j<this.elemsForEvent.length;j++){el=this.elemsForEvent[j];$(el).unbind(eventName,callHandler);}
return true;},on:function(eventName,fn,options,scope){if(!this.elemsForEvent.length||!fn){return false;}
eventName=eventName.toLowerCase();this.addEvent([eventName]);var onEventName="";if(eventName.indexOf("on",0)==0){onEventName=eventName;eventName=eventName.substring(2);}else{onEventName="on"+eventName;}
var scope=scope?scope:this,objScope=this,options=options?options:{};var args=options.args?options.args:[],single=options.single?options.single:false,timeout=options.timeout?options.timeout:0,buffer=options.buffer?options.buffer:0;var callHandler=function(e){if(objScope.suspendedEvents.isInArray(eventName)){return;}
fn.apply(scope,Array.prototype.slice.call(arguments).concat(args));}
if(timeout){callHandler=this.createDelayed(callHandler,timeout);}
if(single){callHandler=this.createSingle(callHandler,eventName)}
if(buffer){callHandler=this.createBuffered(callHandler,buffer);}
this.listeners.push({name:eventName,handler:fn,callHandler:callHandler,options:options,scope:scope,index:this.listeners.length});this.bindHn(eventName,callHandler);return true;},addEvent:function(eventNameArr){if(!this.events){this.events=[];}
this.addEvent=function(eventNameArr){for(var i=0;i<eventNameArr.length;i++){if(!this.events.isInArray(eventNameArr[i])){this.events.push(eventNameArr[i]);}}}
this.addEvent(eventNameArr);},killEvent:function(eventName){var eventInd=this.isDefinedEvent(eventName);if(eventInd==-1){return false;}
this.clearEvent(eventName);this.unbindHn(eventName,this[eventName]);delete this[eventName];this.events.splice(eventInd,1);return true;},purgeListeners:function(){for(var i=0;i<this.events.length;i++){this.killEvent(this.events[i]);}},clearEvent:function(eventName){var listeners=this.getListeners(eventName);for(var i=0;i<listeners.length;i++){this.unbindHn(eventName,listeners[i].callHandler);this.listeners.splice(i,1);}
return true;},stopEvent:function(e){this.stopPropagation(e);this.preventDefault(e);},stopPropagation:function(e){e=this.getEvent(e);if(e&&e.stopPropagation){e.stopPropagation();}else if(e){e.cancelBubble=true;}},preventDefault:function(e){e=this.getEvent(e);if(e&&e.preventDefault){e.preventDefault();}else if(e){e.returnValue=false;}},getEvent:function(e){return e||window.event;},getTarget:function(e){if(e){return e.target||e.srcElement;}},fireEvent:function(eventName){var listeners=this.getListeners(eventName);for(var i=0;i<listeners.length;i++){listeners[i].callHandler.apply(this,[null].concat(Array.prototype.slice.call(arguments,1)));}},isDefinedEvent:function(eventName){return this.events.getIndexOfElem(eventName);},getListeners:function(eventName){var listeneresArr=[];for(var i=0;i<this.listeners.length;i++){if(this.listeners[i].name==eventName){listeneresArr.push(this.listeners[i]);}}
return listeneresArr;}});validation={validatorConsts:{predefined:1,user:2,notFound:3},userValidators:[],predefinedValidatorsArr:['isrequired','isnumeric','ispassword','isemail','ismoney','iszipcode','isphonenumber','isstate','isssn','iscc','istime','isdate','regexp'],arrStates:['AL','AK','AS','AZ','AR','CA','CO','CT','DE','DC','FM','FL','GA','GU','HI','ID','IL','IN','IA','KS','KY','LA','ME','MH','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','MP','OH','OK','OR','PW','PA','PR','RI','SC','SD','TN','TX','UT','VT','VI','VA','WA','WV','WI','WY'],validate:function(validArr,control){var validationRes=false,validatorStatus,result={result:true,messageArr:[]};for(var i=0;i<validArr.length;i++){if(!validArr[i]){continue;}
validatorStatus=this.getValidatorStatus(validArr[i]);if(validatorStatus==this.validatorConsts.user){validationRes=window[control.validationArr[i]](control.getValue());}else if(validatorStatus==this.validatorConsts.predefined){if(validArr[i]=="IsRequired"){if(control.isEmpty()){validationRes=Runner.lang.constants.TEXT_INLINE_FIELD_REQUIRED;}else{validationRes=true;}}else{validationRes=this[validArr[i]](control.getValue(),control.regExp);}}else{validationRes=true;}
result=this.setResult(validationRes,result);}
return result;},getValidatorStatus:function(validatorName){if(this.predefinedValidatorsArr.isInArray(validatorName)){return this.validatorConsts.predefined;}else if(window[validatorName]&&((typeof(window[validatorName])=='function')||(Runner.isIE&&typeof(window[validatorName])=='object'))){return this.validatorConsts.user;}else{return this.validatorConsts.notFound;}},setResult:function(res,obj){var len=obj.messageArr.length;if(res!==true){obj.result=false;if(typeof(res)=='object'){for(var i=0;i<res.length;i++){obj.messageArr.push(res[i]);}}else{obj.messageArr.push(res);}}
return obj;},registerCustomValidation:function(ctrl){var validatorStatus;for(var i=0;i<ctrl.validationArr.length;i++){if(!ctrl.validationArr[i]){continue;}
validatorStatus=this.getValidatorStatus(ctrl.validationArr[i]);if(validatorStatus==this.validatorConsts.user||validatorStatus==this.validatorConsts.notFound){var isAdded=false;for(var j=0;j<this.userValidators.length;j++){if(this.userValidators[j]==ctrl.validationArr[i]){isAdded=true;break;}}
if(!isAdded){Runner.loadJS('include/validate/'+ctrl.validationArr[i]+'.js');this.userValidators.push(ctrl.validationArr[i]);}}}},"IsRequired":function(sVal)
{var regexp=/.+/;if(typeof(sVal)!='string')
sVal=sVal.toString();if(!sVal.match(regexp)&&!this.setRequired)
{this.setRequired=true;return Runner.lang.constants.TEXT_INLINE_FIELD_REQUIRED;}
else
return true;},"IsNumeric":function(sVal)
{sVal=sVal.replace(/,/g,"");if(isNaN(sVal))
return Runner.lang.constants.TEXT_INLINE_FIELD_NUMBER;else
return true;},"IsPassword":function(sVal)
{var regexp1=/^password$/;var regexp2=/.{4,}/;if(sVal.match(regexp1))
return Runner.lang.constants.TEXT_INLINE_FIELD_PASSWORD1;else if(!sVal.match(regexp2))
return Runner.lang.constants.TEXT_INLINE_FIELD_PASSWORD2;else
return true;},"IsEmail":function(sVal)
{var regexp=/^[A-z0-9_-]+([.][A-z0-9_-]+)*[@][A-z0-9_-]+([.][A-z0-9_-]+)*[.][A-z]{2,4}$/;if(sVal.match(/.+/)&&!sVal.match(regexp))
return Runner.lang.constants.TEXT_INLINE_FIELD_EMAIL;else
return true;},"IsMoney":function(sVal)
{var regexp=/^(\d*)\.?(\d*)$/;if(sVal.match(/.+/)&&!sVal.match(regexp))
return Runner.lang.constants.TEXT_INLINE_FIELD_CURRENCY;else
return true;},"IsZipCode":function(sVal)
{var regexp=/^\d{5}([\-]\d{4})?$/;if(sVal.match(/.+/)&&!sVal.match(regexp))
return Runner.lang.constants.TEXT_INLINE_FIELD_ZIPCODE;else
return true;},"IsPhoneNumber":function(sVal)
{var regexp=/^\(\d{3}\)\s?\d{3}\-\d{4}$/;var stripped=sVal.replace(/[\(\)\.\-\ ]/g,'');if(sVal.match(/.+/)&&(isNaN(parseInt(stripped))||stripped.length!=10))
return Runner.lang.constants.TEXT_INLINE_FIELD_PHONE;else
return true;},"IsState":function(sVal)
{if(sVal.match(/.+/)&&!this.arrStates.isInArray(sVal))
return Runner.lang.constants.TEXT_INLINE_FIELD_STATE;else
return true;},"IsSSN":function(sVal)
{var regexp=/^\d{3}(-|\s)\d{2}(-|\s)\d{4}$/;if(sVal.match(/.+/)&&!sVal.match(regexp))
return Runner.lang.constants.TEXT_INLINE_FIELD_SSN;else
return true;},"IsCC":function(sVal)
{var regexp=/^((4\d{3})|(5[1-5]\d{2}))(-?|\040?)(\d{4}(-?|\040?)){3}|^(3[4,7]\d{2})(-?|\040?)\d{6}(-?|\040?)\d{5}/;if(sVal.match(/.+/)&&!sVal.match(regexp))
return Runner.lang.constants.TEXT_INLINE_FIELD_CC;else
return true;},"IsTime":function(sVal)
{var regexp=/\d+/g;if(!sVal)
return true;var arr=sVal.match(regexp);var bFlag=true;if(arr==null||arr.length>3)
bFlag=false;while(bFlag&&arr.length<3)
arr[arr.length]=0;if(bFlag&&(arr[0]<0||arr[0]>23||arr[1]<0||arr[1]>59||arr[2]<0||arr[2]>59))
bFlag=false;if(!bFlag)
return Runner.lang.constants.TEXT_INLINE_FIELD_TIME;else
return true;},"IsDate":function(sVal)
{var fmt="";switch(locale_dateformat){case 0:fmt="MDY";break;case 1:fmt="DMY";break;default:fmt="YMD";break;};if(!this.isValidDate(sVal,fmt)){return Runner.lang.constants.TEXT_INLINE_FIELD_DATE;}else{return true;}},"RegExp":function(sVal,regExpParamsObj){var re=new RegExp(regExpParamsObj.regex);if(sVal.length!=0&&(!re.test(sVal)||re.exec(sVal)[0]!=sVal)){if(regExpParamsObj.messagetype=='Text'){return regExpParamsObj.message;}else{return GetCustomLabel(regExpParamsObj.message);}}else{return true;}},isValidDate:function(dateStr,format){if(format==null)
format="MDY";format=format.toUpperCase();if(format.length!=3)
format="MDY";if((format.indexOf("M")==-1)||(format.indexOf("D")==-1)||(format.indexOf("Y")==-1))
format="MDY";if(format.substring(0,1)=="Y")
{var reg1=/^\d{2}(\-|\/|\.)\d{1,2}\1\d{1,2}$/;var reg2=/^\d{4}(\-|\/|\.)\d{1,2}\1\d{1,2}$/;}
else if(format.substring(1,2)=="Y"){var reg1=/^\d{1,2}(\-|\/|\.)\d{2}\1\d{1,2}$/;var reg2=/^\d{1,2}(\-|\/|\.)\d{4}\1\d{1,2}$/;}else{var reg1=/^\d{1,2}(\-|\/|\.)\d{1,2}\1\d{2}$/;var reg2=/^\d{1,2}(\-|\/|\.)\d{1,2}\1\d{4}$/;}
if((reg1.test(dateStr)==false)&&(reg2.test(dateStr)==false))
return false;var parts=dateStr.split(RegExp.$1);if(format.substring(0,1)=="M")
var mm=parts[0];else if(format.substring(1,2)=="M")
var mm=parts[1];else
var mm=parts[2];if(format.substring(0,1)=="D")
var dd=parts[0];else if(format.substring(1,2)=="D")
var dd=parts[1];else
var dd=parts[2];if(format.substring(0,1)=="Y")
var yy=parts[0];else if(format.substring(1,2)=="Y")
var yy=parts[1];else
var yy=parts[2];if(parseFloat(yy)<=50)
yy=(parseFloat(yy)+2000).toString();if(parseFloat(yy)<=99)
yy=(parseFloat(yy)+1900).toString();var dt=new Date(parseFloat(yy),parseFloat(mm)-1,parseFloat(dd),0,0,0,0);if(parseFloat(dd)!=dt.getDate())
return false;if(parseFloat(mm)-1!=dt.getMonth())
return false;return true;}}
Runner.controls.RowManager=Runner.extend(Runner.emptyFn,{fields:{},rowId:-1,fieldsCount:0,fieldNames:[],constructor:function(rowId){Runner.controls.RowManager.superclass.constructor.call(this,rowId);this.fields={};this.fieldNames=[];this.rowId=rowId;},register:function(control){var controlName=control.fieldName;if(!this.fields[controlName]){this.fields[controlName]=[];this.fieldNames.push(controlName);this.fieldsCount++;}
this.fields[controlName][control.ctrlInd]=control;return true;},getAt:function(fName,controlIndex){if(!fName){var rowControlsArr=[];for(var i=0;i<this.fieldNames.length;i++){for(var j=0;j<this.fields[this.fieldNames[i]].length;j++){var fControl=this.getAt(this.fieldNames[i],j);rowControlsArr.push(fControl);}}
return rowControlsArr;}
if(!this.fields[fName]){return false;}
return this.fields[fName][controlIndex];},unregister:function(fName,controlIndex){if(fName==null){for(var i=0;i<this.fieldsCount;i++){this.unregister(this.fieldNames[i],null);i--;}
return true;}else if(!this.fields[fName]){return false;}else if(controlIndex==null){for(var i=0;i<this.fields[fName].length;i++){this.unregister(fName,i);};for(var i=0;i<this.fieldsCount;i++){if(this.fieldNames[i]==fName){this.fieldNames.splice(i,1);this.fieldsCount--;}}
delete this.fields[fName];return true;}else{if(this.fields[fName][controlIndex].destructor){this.fields[fName][controlIndex].destructor();}else if(this.fields[fName][controlIndex]["destructor"]){this.fields[fName][controlIndex]["destructor"]();}
delete this.fields[fName][controlIndex];return true;}},getMaxFieldIndex:function(fName){if(!this.fields[fName]){return false;}
return this.fields[fName].length;}});Runner.controls.TableManager=Runner.extend(Runner.emptyFn,{rows:{},tName:"",rowsCount:0,rowIds:[],constructor:function(tName){this.tName=tName;this.rows={};this.rowIds=[];},register:function(control){var controlId=control.id;if(!this.rows[controlId]){this.rows[controlId]=new Runner.controls.RowManager(controlId);this.rowIds.push(controlId);this.rowsCount++;}
return this.rows[controlId].register(control);},getAt:function(rowId,fName,controlIndex){if(rowId==null){var tableControlsArr=[];for(var i=0;i<this.rowIds.length;i++){var rowControls=this.rows[this.rowIds[i]].getAt();for(var j=0;j<rowControls.length;j++){tableControlsArr.push(rowControls[j]);}}
return tableControlsArr;}
if(!this.rows[rowId]){return false;}
return this.rows[rowId].getAt(fName,controlIndex);},unregister:function(rowId,fName,controlIndex){if(rowId==null){for(var i=0;i<this.rowsCount;i++){this.rows[this.rowIds[i]].unregister(null,null);}
return true;}else if(!this.rows[rowId]){return false;}else{var rowUnregStat=this.rows[rowId].unregister(fName,controlIndex);if(rowUnregStat&&fName==null){for(var i=0;i<this.rowsCount;i++){if(this.rowIds[i]==rowId){this.rowIds.splice(i,1);this.rowsCount--;}}
delete this.rows[rowId];return true;}else{return rowUnregStat;}}},getMaxFieldIndex:function(rowId,fName){if(!this.rows[rowId]){return false;}
return this.rows[rowId].getMaxFieldIndex(fName);}});Runner.controls.ControlManager=function(){var tables={};var tablesCount=0;var tableNames=[];return{register:function(control){if(!control){return false;}
var controlTable=control.table;if(!tables[controlTable]){tables[controlTable]=new Runner.controls.TableManager(controlTable);tableNames.push(controlTable);tablesCount++;}
return tables[controlTable].register(control);},getAt:function(tName,rowId,fName,controlIndex){controlIndex=controlIndex?controlIndex:0;if(tName===false){for(var i=0;i<tableNames.length;i++){var ctrl=tables[tableNames[i]].getAt(rowId,fName,controlIndex);if(ctrl!==false){return ctrl;}}
return false;}
if(!tables[tName]){return false;}
return tables[tName].getAt(rowId,fName,controlIndex);},unregister:function(tName,rowId,fName,controlIndex){if(!tables[tName]){return false;}
var tUnregStat=tables[tName].unregister(rowId,fName,controlIndex);if(tUnregStat&&rowId==null){for(var i=0;i<tablesCount;i++){if(tableNames[i]==tName){tableNames.splice(i,1);tablesCount--;}}
delete tables[tName];return true;}else{return tUnregStat;}},getMaxFieldIndex:function(tName,rowId,fName){if(!tables[tName]){return false;}
return tables[tName].getMaxFieldIndex(rowId,fName);},resetControlsForTable:function(tName){var cntrls=this.getAt(tName);if(!cntrls){return false;}
var updContext={"enableNextButtons":false,"resetHappend":true,"values":{}};for(var i=0;i<cntrls.length;i++){updContext.values[cntrls[i].fieldName]=cntrls[i].defaultValue;}
for(var i=0;i<cntrls.length;i++){cntrls[i].reset(updContext);}
return true;},clearControlsForTable:function(tName){var cntrls=this.getAt(tName);if(!cntrls){return false;}
for(var i=0;i<cntrls.length;i++){cntrls[i].clear();}
return true;}};}();Runner.namespace('Runner.form');Runner.form.Button=Runner.extend(Runner.Event,{id:"",messContId:"",messageCont:null,elem:null,disableHandler:null,tagName:"",constructor:function(cfg){Runner.apply(this,cfg);Runner.form.Button.superclass.constructor.call(this,cfg);this.elem=$('#'+this.id);if(!this.elem.length){this.elem=document.createElement('INPUT');this.elem=$(this.elem).attr('type','button');}
this.elemsForEvent=[this.elem.get(0)];this.tagName=this.elem[0].tagName;},setDisabled:function(){switch(this.tagName)
{case'INPUT':this.elem.get(0).disabled=true;break;default:this.suspendEvent(['click']);break;}},setEnabled:function(){switch(this.tagName)
{case'INPUT':this.elem.get(0).disabled=false;break;default:this.resumeEvent(['click']);break;}},setMessage:function(txt){this.initMessCont();this.setMessage=function(txt){this.messageCont.html(txt);}
this.setMessage(txt);},removeMessage:function(){this.initMessCont();this.removeMessage=function(){this.messageCont.empty();}
this.removeMessage();},initMessCont:function(){if(this.messageCont){return;}
var messCont=document.createElement('DIV');this.messContId=this.id+"_messCont";messCont.id=this.messContId;this.messageCont=$(messCont);if($(this.elem).hasClass('runner-button')&&$(this.elem).parent().hasClass('runner-btnframe')){$(this.messageCont).insertAfter($(this.elem).parent());}else{this.messageCont.insertAfter(this.elem);}}});Runner.controls.ControlFabric=function(baseCfg){var cfg={goodFieldName:Runner.goodFieldName(baseCfg.fieldName)};Runner.apply(cfg,baseCfg);var tName=cfg.table,id=cfg.id,fName=cfg.fieldName;if(cfg.editFormat==undefined){cfg.editFormat=Runner.pages.PageSettings.getEditFormat(tName,fName);}
if(cfg.RTEType==undefined){cfg.RTEType=Runner.pages.PageSettings.getFieldData(tName,fName,"RTEType");}
if(cfg.dateEditType==undefined){cfg.dateEditType=Runner.pages.PageSettings.getFieldData(tName,fName,"dateEditType");}
cfg.validation=Runner.pages.PageSettings.getValidations(tName,fName);cfg.shortTableName=Runner.pages.PageSettings.getShortTName(tName);cfg.disabled=Runner.pages.PageSettings.getDisabledStatus(tName,fName);cfg.hidden=Runner.pages.PageSettings.getHiddenStatus(tName,fName);switch(cfg.editFormat){case Runner.controls.constants.EDIT_FORMAT_NONE:return new Runner.controls.TextField(cfg);break;case Runner.controls.constants.EDIT_FORMAT_TEXT_FIELD:return new Runner.controls.TextField(cfg);break;case Runner.controls.constants.EDIT_FORMAT_TEXT_AREA:{switch(cfg.RTEType)
{case Runner.controls.constants.EDIT_FORMAT_RTE:return new Runner.controls.RTEInnova(cfg);break;case Runner.controls.constants.EDIT_FORMAT_RTEINNOVA:cfg.useRTE="INNOVA";return new Runner.controls.RTEInnova(cfg);break;case Runner.controls.constants.EDIT_FORMAT_RTECK:return new Runner.controls.RTECK(cfg);break;default:return new Runner.controls.TextArea(cfg);break;}}
case Runner.controls.constants.EDIT_FORMAT_PASSWORD:return new Runner.controls.TextField(cfg);break;case Runner.controls.constants.EDIT_FORMAT_DATE:{cfg.ctrlType="date"+cfg.dateEditType;switch(cfg.dateEditType)
{case Runner.controls.constants.EDIT_DATE_SIMPLE_DP:cfg.useDatePicker=true;return new Runner.controls.DateTextField(cfg);break;case Runner.controls.constants.EDIT_DATE_DD:return new Runner.controls.DateDropDown(cfg);break;case Runner.controls.constants.EDIT_DATE_DD_DP:cfg.useDatePicker=true;return new Runner.controls.DateDropDown(cfg);break;case Runner.controls.constants.EDIT_DATE_SIMPLE:default:return new Runner.controls.DateTextField(cfg);break;}}
case Runner.controls.constants.EDIT_FORMAT_TIME:return new Runner.controls.TimeField(cfg);break;case Runner.controls.constants.EDIT_FORMAT_RADIO:cfg.parentFieldName=Runner.pages.PageSettings.getCategoryField(tName,fName);cfg.lookupTable=Runner.pages.PageSettings.getLookupTable(tName,fName);cfg.linkField=Runner.pages.PageSettings.getFieldData(tName,fName,"linkField");cfg.dispField=Runner.pages.PageSettings.getFieldData(tName,fName,"dispField");if(cfg.mode==Runner.pages.constants.PAGE_EDIT||cfg.mode==Runner.pages.constants.PAGE_INLINE_EDIT)
cfg.autoCompleteFields=Runner.pages.PageSettings.getFieldData(tName,fName,"autoCompleteFieldsEdit");else if(cfg.mode==Runner.pages.constants.PAGE_ADD||cfg.mode==Runner.pages.constants.PAGE_INLINE_ADD)
cfg.autoCompleteFields=Runner.pages.PageSettings.getFieldData(tName,fName,"autoCompleteFieldsAdd");return new Runner.controls.RadioControl(cfg);break;case Runner.controls.constants.EDIT_FORMAT_CHECKBOX:if(cfg.mode==Runner.controls.constants.MODE_SEARCH){return new Runner.controls.DropDownLookup(cfg);}else{return new Runner.controls.CheckBoxLookup(cfg);}
break;case Runner.controls.constants.EDIT_FORMAT_DATABASE_IMAGE:return new Runner.controls.ImageField(cfg);break;case Runner.controls.constants.EDIT_FORMAT_DATABASE_FILE:return new Runner.controls.FileField(cfg);break;case Runner.controls.constants.EDIT_FORMAT_FILE:return new Runner.controls.FileField(cfg);break;case Runner.controls.constants.EDIT_FORMAT_LOOKUP_WIZARD:cfg.lcType=Runner.pages.PageSettings.getLCT(tName,fName);cfg.multiSel=Runner.pages.PageSettings.getLookupSize(tName,fName);cfg.parentFieldName=Runner.pages.PageSettings.getCategoryField(tName,fName);cfg.lookupTable=Runner.pages.PageSettings.getLookupTable(tName,fName);cfg.linkField=Runner.pages.PageSettings.getFieldData(tName,fName,"linkField");cfg.dispField=Runner.pages.PageSettings.getFieldData(tName,fName,"dispField");if(cfg.mode==Runner.pages.constants.PAGE_EDIT||cfg.mode==Runner.pages.constants.PAGE_INLINE_EDIT)
cfg.autoCompleteFields=Runner.pages.PageSettings.getFieldData(tName,fName,"autoCompleteFieldsEdit");else if(cfg.mode==Runner.pages.constants.PAGE_ADD||cfg.mode==Runner.pages.constants.PAGE_INLINE_ADD)
cfg.autoCompleteFields=Runner.pages.PageSettings.getFieldData(tName,fName,"autoCompleteFieldsAdd");switch(cfg.lcType){case Runner.controls.constants.LCT_DROPDOWN:return new Runner.controls.DropDownLookup(cfg);break;case Runner.controls.constants.LCT_AJAX:cfg.freeInput=Runner.pages.PageSettings.getFieldData(tName,fName,"freeInput");return new Runner.controls.EditBoxLookup(cfg);break;case Runner.controls.constants.LCT_LIST:return new Runner.controls.ListPageLookup(cfg);break;case Runner.controls.constants.LCT_CBLIST:cfg.lcSize=2;return new Runner.controls.CheckBoxLookup(cfg);break;default:throw('Invalid lookup wizard type = '+cfg.lcType+'. Cannot create lookup!');};break;case Runner.controls.constants.EDIT_FORMAT_READONLY:return new Runner.controls.ReadOnly(cfg);break;default:throw('Invalid control edit format = '+cfg.editFormat+'. Cannot create control!');return;};};Runner.controls.Control=Runner.extend(Runner.Event,{fieldName:"",goodFieldName:"",shortTableName:"",id:"",css:"",style:"",valContId:"",valueElem:null,spanContId:"",spanContElem:null,errContId:"",errContainer:null,validationArr:null,defaultValue:null,isClearHappend:false,table:"",regExp:null,inputType:"",ctrlType:"",showStatus:true,ctrlInd:-1,isSetFocus:false,hidden:false,mode:'',isInvalid:false,constructor:function(cfg){Runner.apply(this,cfg);Runner.controls.Control.superclass.constructor.call(this,cfg);this.validationArr=cfg.validation.validationArr||[];this.regExp=cfg.validation.regExp;this.valContId="value"+(cfg.ctrlInd||"")+"_"+this.goodFieldName+"_"+this.id;this.valueElem=(this.valueElem==null)?$("#"+this.valContId):this.valueElem;this.spanContId="edit"+this.id+"_"+this.goodFieldName+"_"+cfg.ctrlInd;this.spanContElem=$("#"+this.spanContId);this.errContId="errorCont"+cfg.ctrlInd+"_"+this.valContId;if(cfg.disabled===true||cfg.disabled==="true"){this.setDisabled();}
if(cfg.hidden===true||cfg.hidden==="true"){this.hide();}
this.ccs?valueElem.addclass(this.css):'';this.addStyle(this.style);this.defaultValue=this.getValue();if(this.valueElem.attr&&this.valueElem.attr("type")){this.inputType=this.valueElem.attr("type");}
this.addEvent(["click"]);if(cfg.stopEventInit!==true){if(this.appearOnPage())
this.elemsForEvent=[this.valueElem.get(0)];this.addEvent(["blur"]);this.init();}
Runner.controls.ControlManager.register(this);validation.registerCustomValidation(this);},destructor:function(){this.purgeListeners();},unregister:function(){Runner.controls.ControlManager.unregister(this.table,this.id,this.fieldName);},initToolTip:function(text,pageObj){if(this.valueElem.addClass&&this.mode!=Runner.controls.constants.MODE_SEARCH){this.valueElem.addClass('titleHintBox').inputHintBox({div:$('#shiny_box'),div_sub:'.shiny_box_body',html:text,incrementLeft:5,pageObj:pageObj});this.initToolTip=Runner.emptyFn;return true;}else{return false;}},addStyle:function(styleToAdd){if(!styleToAdd){return false;}
var stylesArr=styleToAdd.split(';');for(var i=0;i<stylesArr.length;i++){var style=stylesArr[i].split(":");style[0]=style[0].toString().trim();if(!style[0]){continue;}
style[1]=style[1].toString().trim();this.valueElem.css(style[0],style[1]);}
return true;},validate:function(valArr){if(!this.appearOnPage()){return{result:true,messageArr:[]};}
var vRes=validation.validate(valArr||this.validationArr,this);if(valArr||this.validationArr.length){if(!vRes.result){this.markInvalid(vRes.messageArr);}else{this.clearInvalid();}}
return vRes;},removeValidation:function(vType){if(typeof vType!="string"){this.regExp=null;vType="RegExp";}
for(var i=0;i<this.validationArr.length;i++){if(this.validationArr[i]==vType){this.validationArr.splice(i,1);return true;}}
return false;},addValidation:function(vType){if(typeof vType!="string"){this.regExp=vType;vType="RegExp";}
if(!this.isSetValidation(vType)){this.validationArr[this.validationArr.length]=vType;}},isSetValidation:function(vType){if(!validation[vType]){return false;}
for(var i=0;i<this.validationArr.length;i++){if(this.validationArr[i]==vType){return true;}}
return false;},validateAs:function(vType){if(!this.appearOnPage()){return{result:true,messageArr:[]};}
return validation[vType](this.getValue());},initErrorCont:function(){this.errContainer=document.createElement('div');this.errContainer=$(this.errContainer);this.errContainer.attr('id',this.errContId);this.errContainer.addClass('runner-error-text');this.errContainer.css('display',"none");this.errContainer.appendTo(this.spanContElem);this.initErrorCont=Runner.emptyFn;},markInvalid:function(messArr,dontDenySubmit){this.initErrorCont();this.markInvalid=function(messArr){var divInnerHtml="";this.errContainer.show();for(var i=0;i<messArr.length;i++){divInnerHtml+=messArr[i]+"</br>";}
this.errContainer.html(divInnerHtml);this.isInvalid=true;}
this.markInvalid(messArr);},clearInvalid:function(){this.initErrorCont();this.clearInvalid=function(){this.errContainer.hide();this.errContainer.empty();this.isInvalid=false;}
this.clearInvalid();},invalid:function(){return this.isInvalid;},reset:function(updContext){this.setValue(this.defaultValue,true,updContext);this.clearInvalid();return true;},clear:function(){this.isClearHappend=true;this.setValue('');this.clearInvalid();this.isClearHappend=false;return true;},hide:function(){this.spanContElem.css("display","none");this.showStatus=false;},show:function(){this.spanContElem.css("display","");this.showStatus=true;},toggleHide:function(){if(this.showStatus){this.hide();}else{this.show();}},getValue:function(){if(this.valueElem.val){return this.valueElem.val();}else{return false;}},getStringValue:function(){return this.getValue();},setValue:function(val,triggerEvent,updContext){if(this.valueElem.val){this.valueElem.val(val);if(triggerEvent===true){this.fireEvent("change",updContext);}
return true;}else{return false;}},setDisabled:function(){if(this.valueElem.get(0)){this.valueElem.get(0).disabled=true;return true;}else{return false;}},setEnabled:function(){if(this.valueElem.get(0)){this.valueElem.get(0).disabled=false;return true;}else{return false;}},getControlType:function(){return this.inputType;},setFocus:function(triggerEvent){var cType=this.getControlType();if(cType!=""){if(!this.appearOnPage()||this.valueElem.get(0).disabled==true||!this.showStatus||this.valueElem.css('display')=='none'||this.valueElem.css('visibility')=='hidden'){return false;}
try{this.valueElem.get(0).focus();}catch(err){}
if(triggerEvent===true){this.fireEvent("focus");}
this.isSetFocus=true;return true;}else{this.isSetFocus=false;return false;}},isEmpty:function(){return this.getValue().toString()=="";},"blur":function(e){this.stopEvent(e);this.isSetFocus=false;if(this.invalid()){return this.validate();}else{var valArr=this.validationArr.copy().removeElem("IsRequired");return this.validate(valArr);}},"click":function(e){this.isSetFocus=true;},removeCSS:function(className){this.valueElem.removeClass(className);},addCSS:function(className){this.valueElem.addClass(className);},getAttr:function(attrName){return this.valueElem.attr(attrName);},getDispElem:function(){return this.valueElem;},getForSubmit:function(){return(this.appearOnPage()?[this.valueElem.clone().val(this.valueElem.val())]:[]);},makeReadonly:function(){if(!this.appearOnPage()){return false;}
this.valueElem.attr("readonly",true);return true;},isReadonly:function(){return this.valueElem.attr("readonly")==true;},appearOnPage:function(){return this.valueElem.length;}});Runner.controls.ReadOnly=Runner.extend(Runner.controls.Control,{constructor:function(cfg){Runner.controls.ReadOnly.superclass.constructor.call(this,cfg);},validate:function(){return{result:true};},getControlType:function(){return"readonly";},setFocus:function(){return false;}});Runner.controls.TextArea=Runner.extend(Runner.controls.Control,{constructor:function(cfg){this.addEvent(["change","keyup"]);Runner.controls.TextArea.superclass.constructor.call(this,cfg);this.inputType="textarea";},getForSubmit:function(){if(!this.appearOnPage()){return[];}
return[this.valueElem.clone().val(this.getValue())]}});Runner.controls.TextField=Runner.extend(Runner.controls.Control,{constructor:function(cfg){this.addEvent(["change","keyup"]);Runner.controls.TextField.superclass.constructor.call(this,cfg);}});Runner.controls.TimeField=Runner.extend(Runner.controls.Control,{typeHiddId:"",typeHiddElem:null,rangeSec:[],constructor:function(cfg){Runner.controls.TimeField.superclass.constructor.call(this,cfg);this.typeHiddId="type_"+this.goodFieldName+"_"+this.id;this.typeHiddElem=$("#"+this.typeHiddId);this.imgTime=$("#trigger-test-"+this.valContId);this.imgTime.css('visibility','visible');if(cfg.disabled===true||cfg.disabled==="true"){this.setDisabled();}
for(i=0;i<60;i++)
{if(i<10)
this.rangeSec[i]="0"+i;else
this.rangeSec[i]=""+i;}
this.addEvent(["change"]);this.init();this.initTimePicker();},initTimePicker:function(){var ctrl=this;var initializer=function(e){ctrl.imgTime.unbind("click");$(function(){var settings=Runner.pages.PageSettings.getFieldData(ctrl.table,ctrl.fieldName,'timePick',{});var params={handle:"#"+ctrl.imgTime.attr("id"),updateLive:false,trigger:'click',convention:settings['convention'],seconds:settings['showSec'],rangeMin:settings['rangeMin'],rangeSec:ctrl.rangeSec};ctrl.valueElem.timepickr(params);ctrl.imgTime.click();});}
this.imgTime.bind("click",initializer);},addValidation:function(type){if(type!="isRequired"){return false;}
Runner.controls.TimeField.superclass.addValidation.call(this,type);},getForSubmit:function(){return[this.valueElem.clone(),this.typeHiddElem.clone()];},setDisabled:function()
{if(this.valueElem.get(0)&&this.imgTime)
{this.valueElem.get(0).disabled=true;this.imgTime.css('visibility','hidden');return true;}else{return false;}},setEnabled:function()
{if(this.valueElem.get(0))
{this.valueElem.get(0).disabled=false;if(!Runner.isIE){this.imgTime.css('visibility','visible');}
return true;}else{return false;}},"change":function(e)
{return this.validate().result;}});Runner.controls.RTEField=Runner.extend(Runner.controls.Control,{iframeElemId:"",iframeElem:null,constructor:function(cfg){cfg.stopEventInit=true;Runner.controls.RTEField.superclass.constructor.call(this,cfg);this.inputType="RTE";this.tName=cfg.table;this.iframeElemId=this.valContId;this.iframeElem=$('#'+this.iframeElemId);if(cfg.disabled==true||cfg.disabled=="true"){this.setDisabled();}
this.fixForChrome();},useRTE:false,fixForChrome:function(){var pageObj=Runner.pages.PageManager.getAt(this.tName,this.id);if($.browser.safari&&pageObj.fly){src=this.iframeElem.attr('src');this.iframeElem.attr('src',"");this.iframeElem.attr('src',src);}},addValidation:function(type)
{if(type!="isRequired")
return false;Runner.controls.RTEField.superclass.addValidation.call(this,type);},getForSubmit:function(){if(!this.appearOnPage()){return[];}
var clElem=$('<input type="hidden" name="'+this.iframeElemId+'">').clone();$(clElem).val(this.getValue());return[clElem];},setDisabled:function()
{if(this.iframeElem){var val=this.getValue();this.iframeElem.css('display','none');this.spanContElem.prepend('<div id="disabledRTE'+this.fieldName+'_'+this.id+'">'+val+'</div>')
return true;}else{return false;}},setEnabled:function()
{if(this.iframeElem){$("#disabledRTE"+this.fieldName+'_'+this.id).remove();this.iframeElem.css('display','block');return true;}else{return false;}}});Runner.controls.RTEInnova=Runner.extend(Runner.controls.RTEField,{constructor:function(cfg)
{Runner.controls.RTEInnova.superclass.constructor.call(this,cfg);this.useRTE=cfg.useRTE?cfg.useRTE:false;if(this.useRTE=="INNOVA")
this.innerIframeId='idContentoEdit'+this.goodFieldName+'_'+this.id;this.fixForChrome();},getValue:function()
{var val;if(this.iframeElem)
{if(this.useRTE=='INNOVA')
val=this.iframeElem.contents().find('#'+this.innerIframeId).contents().find('body').html();else
val=this.iframeElem.contents().find('#'+this.iframeElemId).contents().find('body').html();if(val)
val=val.trim();if(val=='<br>')
val='';return val;}
else
return false;},setValue:function(val)
{if(this.useRTE=='INNOVA')
this.iframeElem.contents().find('#'+this.innerIframeId).contents().find('body').html(val);else
this.iframeElem.contents().find('#'+this.iframeElemId).contents().find('body').html(val);}});Runner.controls.RTECK=Runner.extend(Runner.controls.RTEField,{constructor:function(cfg){Runner.controls.RTECK.superclass.constructor.call(this,cfg);nWidth=Runner.pages.PageSettings.getFieldData(this.tName,this.fieldName,'nWidth');nHeight=Runner.pages.PageSettings.getFieldData(this.tName,this.fieldName,'nHeight');if(this.appearOnPage()){CKEDITOR.replace(this.valContId,{"width":nWidth,"height":nHeight});}},getEditor:function(){if(!window.CKEDITOR){return false;}
if(typeof window.CKEDITOR.instances[this.valContId]=='undefined'){return false;}
return window.CKEDITOR.instances[this.valContId];},destructor:function(){var editor=this.getEditor();if(editor!==false){CKEDITOR.remove(editor);}},getValue:function(){var editor=this.getEditor();if(editor===false){return false;}
return editor.getData();},setValue:function(val){var editor=this.getEditor();if(editor===false){return false;}
editor.setData(val);return true;},initToolTip:function(text,pageObj){if(this.valueElem.addClass&&this.mode!=Runner.controls.constants.MODE_SEARCH&&this.valueElem.parent().length&&this.valueElem.parent().get(0).nodeName=="SPAN"){this.valueElem.parent().addClass('titleHintBox').inputHintBox({div:$('#shiny_box'),div_sub:'.shiny_box_body',html:text,incrementLeft:5,pageObj:pageObj});this.initToolTip=Runner.emptyFn;return true;}else{return false;}}});Runner.controls.FileControl=Runner.extend(Runner.controls.Control,{radioElemsName:"",radioElems:null,notEmptyCntrl:0,constructor:function(cfg){this.radioElems={};cfg.stopEventInit=true;Runner.controls.FileControl.superclass.constructor.call(this,cfg);var notEmpty=$("#notempty_"+this.goodFieldName+"_"+this.id);this.notEmptyCntrl=parseInt($(notEmpty).val());this.radioElemsName="type_"+this.goodFieldName+"_"+this.id;if($('#'+this.radioElemsName).length){this.getChekedRadio=function(){return false;}}
this.getRadioControls();this.events=["change"];delete this["blur"];this.elemsForEvent=[this.valueElem.get(0)];this.init();},"blur":Runner.emptyFn,"change":function(e){this.stopEvent(e);this.changeRadio("updateRadio");return this.validate();},changeRadio:function(radioToCheck){for(var radio in this.radioElems){if(radio==radioToCheck&&this.radioElems[radio]!=false){this.radioElems[radio].elem.get(0).checked=true;this.radioElems[radio].cheked=true;}else if(radio==radioToCheck&&this.radioElems[radio]==false){return false;}else if(this.radioElems[radio]!=false){this.radioElems[radio].elem.get(0).checked=false;this.radioElems[radio].cheked=false;}}
return true;},getRadioControls:function(){var keepRadio=$('#'+this.radioElemsName+'_keep');var ctrl=this;keepRadio.bind('click',function(e){ctrl.changeRadio('keepRadio');});var deleteRadio=$('#'+this.radioElemsName+'_delete');deleteRadio.bind('click',function(e){ctrl.changeRadio('deleteRadio');});var updateRadio=$('#'+this.radioElemsName+'_update');updateRadio.bind('click',function(e){ctrl.changeRadio('updateRadio');});this.radioElems["keepRadio"]=keepRadio.length?{elem:keepRadio,cheked:true}:false;this.radioElems["deleteRadio"]=deleteRadio.length?{elem:deleteRadio,cheked:false}:false;this.radioElems["updateRadio"]=updateRadio.length?{elem:updateRadio,cheked:false}:false;return true;},getChekedRadio:function(){for(var radio in this.radioElems){if(this.radioElems[radio]!=false&&this.radioElems[radio].cheked===true){return radio;}}
return false;},validate:function(valArr){if(this.notEmptyCntrl&&(this.mode==Runner.pages.constants.PAGE_EDIT||this.mode==Runner.pages.constants.PAGE_INLINE_EDIT)){return{result:true,messageArr:[]};}else{return Runner.controls.FileControl.superclass.validate.call(this,valArr);}},getForSubmit:function(){var radio=this.getChekedRadio();var cloneArr=[];if(radio){var radioClone=document.createElement('input');$(radioClone).attr('type','hidden');$(radioClone).attr('id',this.radioElems[radio].elem.attr('id'));$(radioClone).attr('name',this.radioElems[radio].elem.attr('name'));$(radioClone).val(this.radioElems[radio].elem.val());cloneArr.push($(radioClone));}else if($('#'+this.radioElemsName).length){cloneArr.push($('#'+this.radioElemsName));}
var realFile=this.valueElem;var clone=this.valueElem.clone(true);clone.insertAfter(realFile);cloneArr.push(realFile);this.valueElem=clone;return cloneArr;},isEmpty:function(){if(this.mode==Runner.pages.constants.PAGE_EDIT||this.mode==Runner.pages.constants.PAGE_INLINE_EDIT){if(this.notEmptyCntrl){return false;}else{if(typeof(this.fileNameElem)!='undefined'){if(this.fileNameElem.get(0).value==''){this.fileNameElem.get(0).value=this.fileNameElem.get(0).defaultValue;}}
return(this.radioElems["keepRadio"].cheked===true||this.getValue().toString()==""||this.radioElems["updateRadio"].cheked===false)}}else{if(typeof(this.fileNameElem)!='undefined'){if(!(this.getValue().toString()=="")&&(this.fileNameElem.get(0).value==''))
this.fileNameElem.get(0).value=this.fileNameElem.get(0).defaultValue;}
return(this.getValue().toString()=="")}},resetRadio:function(){for(var radio in this.radioElems){if(this.radioElems[radio]!=false){this.radioElems[radio].elem.get(0).checked=this.radioElems[radio].elem.get(0).defaultChecked;this.radioElems[radio].cheked=this.radioElems[radio].elem.get(0).defaultChecked;}}}});Runner.controls.ImageField=Runner.extend(Runner.controls.FileControl,{imgElem:null,constructor:function(cfg){Runner.controls.ImageField.superclass.constructor.call(this,cfg);this.imgElemId="image_"+this.goodFieldName+"_"+this.id;this.imgElem=$("#"+this.imgElemId);},setValue:function(val,triggerEvent,updContext){if($(val).attr('src')){this.imgElem.attr('src',($(val).attr('src')+"&rndVal="+Math.random()));}else{Runner.controls.ImageField.superclass.setValue.call(this,val,triggerEvent,updContext);if(updContext&&updContext.resetHappend){this.resetRadio();}}}});Runner.controls.FileField=Runner.extend(Runner.controls.FileControl,{addTimeStamp:false,fileNameElemId:"",fileNameElem:null,fileHiddElemId:"",fileHiddElem:null,constructor:function(cfg){cfg.stopEventInit=true;Runner.controls.FileField.superclass.constructor.call(this,cfg);this.fileNameElemId="filename_"+this.goodFieldName+"_"+this.id;this.fileNameElem=$("#"+this.fileNameElemId).length?$("#"+this.fileNameElemId):null;this.fileHiddElemId="filenameHidden_"+this.goodFieldName+"_"+this.id;this.fileHiddElem=$("#"+this.fileHiddElemId).length?$("#"+this.fileHiddElemId):null;this.addTimeStamp=cfg.addTimeStamp||Runner.pages.PageSettings.getFieldData(this.table,this.fieldName,'isUseTimeStamp');for(radio in this.radioElems){if(this.radioElems[radio]){var objScope=this;this.radioElems[radio].elem.bind('click',function(e){var radioTypeStartFrom=this.id.lastIndexOf('_');var radioTypeName=this.id.substring(radioTypeStartFrom+1)+'Radio';objScope.changeControlsStyles(radioTypeName);});}}},addValidation:function(type){if(type!="isRequired"){return false;}
Runner.controls.FileField.superclass.addValidation.call(this,type);},getFileNameFromPath:function(path){var wpos=path.lastIndexOf('\\');var upos=path.lastIndexOf('/');var pos=wpos;if(upos>wpos)
pos=upos;return path.substr(pos+1);},setValue:function(val,triggerEvent,updContext){var valWithStamp="",fileName="";if(this.fileNameElem!=null||this.addTimeStamp){fileName=this.getFileNameFromPath(this.valueElem.val());}
if(this.addTimeStamp){var valWithStamp=this.addTimestamp(fileName);}
if(this.fileNameElem!=null){this.fileNameElem.val(valWithStamp||fileName);this.fileNameElem.get(0).defaultValue=(valWithStamp||fileName);}
if(updContext&&updContext.resetHappend){this.valueElem.val(updContext.values[this.fieldName]);if(this.fileNameElem!=null){this.fileNameElem.val(this.fileNameElem.get(0).defaultValue);}
this.resetRadio();}
if(triggerEvent===true){this.fireEvent("change",updContext);}},addTimestamp:function(filename){var wpos=filename.lastIndexOf('.');if(wpos<0){return filename+'-'+this.getTimestamp();}
return filename.substring(0,wpos)+'-'+this.getTimestamp()+filename.substring(wpos);},getTimestamp:function(){var ts="",now=new Date();ts+=now.getFullYear();ts+=this.padDateValue(now.getMonth()+1,false);ts+=this.padDateValue(now.getDate(),false)+'-';ts+=this.padDateValue(now.getHours(),false);ts+=this.padDateValue(now.getMinutes(),false);ts+=this.padDateValue(now.getSeconds(),false);return ts;},padDateValue:function(value,threedigits){if(!threedigits){if(value>9){return''+value;}
return'0'+value;}
if(value>9){if(value>99){return''+value;}
return'0'+value;}
return'00'+value;},"change":function(e){this.stopEvent(e);var vRes=this.validate();if(!arguments[1]||!arguments[1].resetHappend){this.changeRadio("updateRadio");if(vRes.result){var vl=this.getValue();this.setValue(vl,false);}}
return vRes.result;},changeRadio:function(radioToCheck){this.changeControlsStyles(radioToCheck);Runner.controls.FileField.superclass.changeRadio.call(this,radioToCheck);},changeControlsStyles:function(radioToCheck){if(!this.radioElems[radioToCheck]){return false;}
if(this.fileNameElem==null){return false;}
if(radioToCheck=="deleteRadio"){this.fileNameElem.css('backgroundColor','gainsboro');this.fileNameElem[0].disabled=true;return true;}else if(radioToCheck=="updateRadio"||radioToCheck=="keepRadio"){this.fileNameElem.css('backgroundColor','white');this.fileNameElem[0].disabled=false;return true;}else{return false;}},getFileName:function(){if(this.fileHiddElem){return this.fileHiddElem.val();}else{return false;}},setFileName:function(fileName){if(this.fileHiddElem){this.fileHiddElem.val(fileName);return true;}else{return false;}},getForSubmit:function(){var cloneArr=Runner.controls.ImageField.superclass.getForSubmit.call(this);if(this.fileNameElem){cloneArr.push(this.fileNameElem.clone());}
if(this.fileHiddElem){cloneArr.push(this.fileHiddElem.clone());}
return cloneArr;}});Runner.controls.DateField=Runner.extend(Runner.controls.Control,{datePickerHiddId:"",datePickerHiddElem:null,imgCal:null,useDatePicker:false,dateFormatHiddId:"",dateFormat:"",showTime:false,dateFormatHiddElem:null,dataPicker:null,timeBox:null,dateDelimiter:"/",startWeekDay:0,constructor:function(cfg){Runner.controls.DateField.superclass.constructor.call(this,cfg);this.useDatePicker=cfg.useDatePicker?cfg.useDatePicker:false;this.dateFormat=typeof cfg.dateFormat!="undefined"?cfg.dateFormat:Runner.pages.PageSettings.getGlobalData("locale").dateFormat;this.dateDelimiter=Runner.pages.PageSettings.getGlobalData("locale")["dateDelimiter"];this.startWeekDay=(Number(Runner.pages.PageSettings.getGlobalData("locale").startWeekDay)+1)%7;this.showTime=Runner.pages.PageSettings.getFieldData(this.table,this.fieldName,"showTime");this.dateFormatHiddId="type"+(cfg.ctrlInd||"")+"_"+this.goodFieldName+"_"+this.id;this.dateFormatHiddElem=$("#"+this.dateFormatHiddId);this.initDataPicker();},initDataPicker:function(){if(!this.useDatePicker){this.initDataPicker=Runner.emptyFn;return false;}
this.imgCal=$('#imgCal_'+this.valContId);this.datePickerHiddId="tsvalue"+(this.ctrlInd||"")+"_"+this.goodFieldName+"_"+this.id;this.datePickerHiddElem=$("#"+this.datePickerHiddId);var dateControl=this;this.imgCal.bind("click",function(e){(function(e){Runner.Event.prototype.stopEvent(e);if(!this.dataPicker){YAHOO.util.Event.on(document,"click",function(e){(function(e){var el=YAHOO.util.Event.getTarget(e);var dialogEl=this.dataPicker.element;if(el!=this.dataPicker.dataPickerEl&&!YAHOO.util.Dom.isAncestor(dialogEl,el)&&el!=this.imgCal.get(0)&&!YAHOO.util.Dom.isAncestor(this.imgCal.get(0),el)){this.dataPicker.hide();}}).createDelegate(dateControl,[e])();});function todayHandler(){this.setValue(this.calendar.today,true);this.calendar.select(this.calendar.today);this.dataPicker.hide();}
function closeHandler(){this.dataPicker.hide();}
this.dataPicker=new YAHOO.widget.Dialog("calcontainer_"+(new Date().getTime()+''+Math.floor(Math.random()*100)),{visible:false,context:["show","tl","bl"],buttons:[{text:Runner.lang.constants.TEXT_TODAY,handler:todayHandler.createDelegate(dateControl),isDefault:true}],draggable:true,close:true,constraintoviewport:true,fixedcenter:true,modal:true});var dt=new Date();var currentYear=dt.getFullYear();var initialYear=Runner.pages.PageSettings.getFieldData(this.table,this.fieldName,"initialYear");var lastYear=Runner.pages.PageSettings.getFieldData(this.table,this.fieldName,"lastYear");var startYear=this.startYear=currentYear-initialYear;var endYear=this.endYear=currentYear+lastYear;var addCalId="cal"+(new Date().getTime()+''+Math.floor(Math.random()*100));this.dataPicker.setBody('<div id="'+addCalId+'"></div>');this.dataPicker.render(document.body);}
if(this.showTime&&!this.timeBox){var timeSpan=$(document.createElement('DIV')).css("text-align","center");this.timeBox=$(document.createElement('INPUT')).attr('type','text').attr('size','10').attr('id','timeBox'+this.id).attr('maxlength',8).css("margin-bottom","8px").appendTo(timeSpan);$(this.dataPicker.footer).prepend(timeSpan);}else{this.timeBox=$('#timeBox'+this.id);}
if(!this.calendar){this.calendar=new YAHOO.widget.Calendar(addCalId,{iframe:false,hide_blank_weeks:true,LOCALE_WEEKDAYS:"short",START_WEEKDAY:this.startWeekDay,mindate:"1/1/"+startYear,maxdate:"12/31/"+endYear});this.calendar.buildMonthLabel=function(){var date=this.cfg.getProperty('pagedate'),currentYear=(date.getFullYear()+this.Locale.YEAR_OFFSET);var yearDDId=this.id+'_year_dd';this.yearDDId=yearDDId;var monthDDId=this.id+'_month_dd';this.monthDDId=monthDDId;var yearDD='<select id="'+yearDDId+'">';$('#'+yearDDId).remove();$('#'+monthDDId).remove();var minYear=this.cfg.getProperty('mindate').getFullYear(),maxYear=this.cfg.getProperty('maxdate').getFullYear();for(var i=minYear;i<=maxYear;i++){yearDD+='<option value="'+i+'"';if(i==currentYear){yearDD+='selected="selected"';}
yearDD+='>'+i+'</option>';}
yearDD+='<div></select>';var currMonth=date.getMonth();var monthNames=[Runner.lang.constants.TEXT_MONTH_JAN,Runner.lang.constants.TEXT_MONTH_FEB,Runner.lang.constants.TEXT_MONTH_MAR,Runner.lang.constants.TEXT_MONTH_APR,Runner.lang.constants.TEXT_MONTH_MAY,Runner.lang.constants.TEXT_MONTH_JUN,Runner.lang.constants.TEXT_MONTH_JUL,Runner.lang.constants.TEXT_MONTH_AUG,Runner.lang.constants.TEXT_MONTH_SEP,Runner.lang.constants.TEXT_MONTH_OCT,Runner.lang.constants.TEXT_MONTH_NOV,Runner.lang.constants.TEXT_MONTH_DEC];var monthDD='<select class="datapicker-dd" id="'+monthDDId+'">';for(var i=0;i<monthNames.length;i++){monthDD+='<option value="'+i+'"';if(i==currMonth){monthDD+='selected="selected"';}
monthDD+='>'+monthNames[i]+'</option>';}
monthDD+='</select></div>';return monthDD+yearDD;this.buildMonthLabel=Runner.emptyFn;}
var baseNextMonthHn=this.calendar.doNextMonthNav;this.calendar.doNextMonthNav=function(e,cal){var currYear=cal.getDateByCellId("newcalelement_0_cell17").getFullYear(),currMonth=cal.getDateByCellId("newcalelement_0_cell17").getMonth();if(currYear<endYear||(currYear==endYear&&cal.getDateByCellId("newcalelement_0_cell17").getMonth()<11)){baseNextMonthHn(e,cal);}}
var basePrevMonthHn=this.calendar.doPreviousMonthNav;this.calendar.doPreviousMonthNav=function(e,cal){var currYear=cal.getDateByCellId("newcalelement_0_cell17").getFullYear(),currMonth=cal.getDateByCellId("newcalelement_0_cell17").getMonth();if(currYear>startYear||(currYear==startYear&&cal.getDateByCellId("newcalelement_0_cell17").getMonth()>0)){basePrevMonthHn(e,cal);}}
var currDate=this.getValue();this.calendar.cfg.setProperty("pagedate",currDate);this.calendar.selectEvent.subscribe(function(){var selDate=this.calendar.getSelectedDates()[0];var selTime=this.getTime();if(selTime){var timeArr=selTime.split(":");selDate.setHours(timeArr[0]);selDate.setMinutes(timeArr[1]);selDate.setSeconds(timeArr[2]);}
if(selDate.toString()!=this.getValue().toString()){this.setValue(selDate,true);this.dataPicker.hide();}},this,this);this.calendar.renderEvent.subscribe(function(){var currYear=this.calendar.getDateByCellId("newcalelement_0_cell17").getFullYear(),currMonth=this.calendar.getDateByCellId("newcalelement_0_cell17").getMonth(),cal=this.calendar;$('#'+this.calendar.yearDDId).val(currYear);$('#'+this.calendar.monthDDId).val(currMonth);$('#'+this.calendar.yearDDId).bind('change',function(e){var val=parseInt(this.value);if(val<endYear+1&&val>startYear-1){cal.setYear(val);cal.render();}});$('#'+this.calendar.monthDDId).bind('change',function(e){var val=parseInt(this.value);cal.setMonth(val);cal.render();});if(Runner.isGecko){$(this.dataPicker.body).find('a.calnavright').css({top:'10px',right:'-1px'});}},this,this);this.localizeCalendar();}
var selDate=this.getValue();this.setTime(selDate);if(selDate){this.calendar.cfg.setProperty("pagedate",selDate);this.calendar.select(selDate);}
this.calendar.render();this.dataPicker.show();}).call(dateControl,e);});},localizeCalendar:function(){if(!this.calendar){return false;}
this.calendar.cfg.setProperty("DATE_FIELD_DELIMITER",this.dateDelimiter);if(this.dateFormat==-1){this.calendar.cfg.setProperty("MDY_DAY_POSITION",1);this.calendar.cfg.setProperty("MDY_MONTH_POSITION",2);this.calendar.cfg.setProperty("MDY_YEAR_POSITION",3);}else if(this.dateFormat==1){this.calendar.cfg.setProperty("MDY_DAY_POSITION",1);this.calendar.cfg.setProperty("MDY_MONTH_POSITION",2);this.calendar.cfg.setProperty("MDY_YEAR_POSITION",3);}else if(this.dateFormat==0){this.calendar.cfg.setProperty("MDY_DAY_POSITION",2);this.calendar.cfg.setProperty("MDY_MONTH_POSITION",1);this.calendar.cfg.setProperty("MDY_YEAR_POSITION",3);}else{this.calendar.cfg.setProperty("MD_DAY_POSITION",2);this.calendar.cfg.setProperty("MD_MONTH_POSITION",1);}
this.calendar.cfg.setProperty("MONTHS_SHORT",[Runner.lang.constants.TEXT_MONTH_JAN,Runner.lang.constants.TEXT_MONTH_FEB,Runner.lang.constants.TEXT_MONTH_MAR,Runner.lang.constants.TEXT_MONTH_APR,Runner.lang.constants.TEXT_MONTH_MAY,Runner.lang.constants.TEXT_MONTH_JUN,Runner.lang.constants.TEXT_MONTH_JUL,Runner.lang.constants.TEXT_MONTH_AUG,Runner.lang.constants.TEXT_MONTH_SEP,Runner.lang.constants.TEXT_MONTH_OCT,Runner.lang.constants.TEXT_MONTH_NOV,Runner.lang.constants.TEXT_MONTH_DEC]);this.calendar.cfg.setProperty("MONTHS_LONG",[Runner.lang.constants.TEXT_MONTH_JAN,Runner.lang.constants.TEXT_MONTH_FEB,Runner.lang.constants.TEXT_MONTH_MAR,Runner.lang.constants.TEXT_MONTH_APR,Runner.lang.constants.TEXT_MONTH_MAY,Runner.lang.constants.TEXT_MONTH_JUN,Runner.lang.constants.TEXT_MONTH_JUL,Runner.lang.constants.TEXT_MONTH_AUG,Runner.lang.constants.TEXT_MONTH_SEP,Runner.lang.constants.TEXT_MONTH_OCT,Runner.lang.constants.TEXT_MONTH_NOV,Runner.lang.constants.TEXT_MONTH_DEC]);this.calendar.cfg.setProperty("WEEKDAYS_1CHAR",[Runner.lang.constants.TEXT_DAY_SU,Runner.lang.constants.TEXT_DAY_MO,Runner.lang.constants.TEXT_DAY_TU,Runner.lang.constants.TEXT_DAY_WE,Runner.lang.constants.TEXT_DAY_TH,Runner.lang.constants.TEXT_DAY_FR,Runner.lang.constants.TEXT_DAY_SA]);this.calendar.cfg.setProperty("WEEKDAYS_SHORT",[Runner.lang.constants.TEXT_DAY_SU,Runner.lang.constants.TEXT_DAY_MO,Runner.lang.constants.TEXT_DAY_TU,Runner.lang.constants.TEXT_DAY_WE,Runner.lang.constants.TEXT_DAY_TH,Runner.lang.constants.TEXT_DAY_FR,Runner.lang.constants.TEXT_DAY_SA]);this.calendar.cfg.setProperty("WEEKDAYS_MEDIUM",[Runner.lang.constants.TEXT_DAY_SU,Runner.lang.constants.TEXT_DAY_MO,Runner.lang.constants.TEXT_DAY_TU,Runner.lang.constants.TEXT_DAY_WE,Runner.lang.constants.TEXT_DAY_TH,Runner.lang.constants.TEXT_DAY_FR,Runner.lang.constants.TEXT_DAY_SA]);this.calendar.cfg.setProperty("WEEKDAYS_LONG",[Runner.lang.constants.TEXT_DAY_SU,Runner.lang.constants.TEXT_DAY_MO,Runner.lang.constants.TEXT_DAY_TU,Runner.lang.constants.TEXT_DAY_WE,Runner.lang.constants.TEXT_DAY_TH,Runner.lang.constants.TEXT_DAY_FR,Runner.lang.constants.TEXT_DAY_SA]);},parseDateTime:function(str,dmy){if(str==null){return null;}
var dt,re=/\d+/g,arr=str.match(re);if(arr==null||arr.length<3){return null;}
while(arr.length<6){arr[arr.length]=0;}
if(dmy==1){dt=new Date(arr[2],arr[1]-1,arr[0],arr[3],arr[4],arr[5]);}else if(dmy==0){dt=new Date(arr[2],arr[0]-1,arr[1],arr[3],arr[4],arr[5]);}else{dt=new Date(arr[0],arr[1]-1,arr[2],arr[3],arr[4],arr[5]);}
if(isNaN(dt)){return null;}
if(dmy==1&&(dt.getMonth()!=arr[1]-1||dt.getDate()!=arr[0]||dt.getFullYear()!=arr[2])){return null;}
if(dmy==0&&(dt.getMonth()!=arr[0]-1||dt.getDate()!=arr[1]||dt.getFullYear()!=arr[2])){return null;}
if(dmy==2&&(dt.getMonth()!=arr[1]-1||dt.getDate()!=arr[2]||dt.getFullYear()!=arr[0])){return null;}
return dt;},addValidation:function(type){if(type!="IsRequired"){return false;}
Runner.controls.DateField.superclass.addValidation.call(this,type);},parseTime:function(dtObj){if(typeof dtObj=="object"){return((dtObj.getHours()<10?'0':'')+dtObj.getHours()+":"
+(dtObj.getMinutes()<10?'0':'')+(dtObj.getMinutes())+":"
+(dtObj.getSeconds()<10?'0':'')+(dtObj.getSeconds()));}else{return"";}},getTime:function(){if(this.showTime){return this.timeBox.val();}else{return"";}},setTime:function(dtObj){if(this.showTime){if(dtObj)
this.timeBox.val(this.parseTime(dtObj));else
this.timeBox.val('00:00:00');}},setValue:function(newDate){if(typeof newDate=="string"){return this.parseDateTime(newDate,this.dateFormat);}else{return newDate;}},print_datetime:function(value,format){var date='';if(format==-1)
date+=(value.getDate()<10?'0'+value.getDate():value.getDate())+'-'+(value.getMonth()<9?'0'+(value.getMonth()+1):value.getMonth()+1)+'-'+value.getFullYear();else if(format==1)
date+=(value.getDate()<10?'0'+value.getDate():value.getDate())+this.dateDelimiter+(value.getMonth()<9?'0'+(value.getMonth()+1):value.getMonth()+1)+this.dateDelimiter+value.getFullYear();else if(format==0)
date+=(value.getMonth()<9?'0'+(value.getMonth()+1):value.getMonth()+1)+this.dateDelimiter+(value.getDate()<10?'0'+value.getDate():value.getDate())+this.dateDelimiter+value.getFullYear();else
date+=value.getFullYear()+this.dateDelimiter+(value.getMonth()<9?'0'+(value.getMonth()+1):value.getMonth()+1)+this.dateDelimiter+(value.getDate()<10?'0'+value.getDate():value.getDate());if(value.getHours()==0&&value.getMinutes()==0&&value.getSeconds()==0){return date;}
var time='';if(value.getHours()>0||value.getMinutes()>0||value.getSeconds()>0){time+=(value.getHours()<10?'0'+value.getHours():value.getHours());time+=':'+(value.getMinutes()<10?'0'+value.getMinutes():value.getMinutes())}
if(value.getSeconds()>0)
time+=':'+(value.getSeconds()<10?'0'+value.getSeconds():value.getSeconds());return date+' '+time;}});Runner.controls.DateTextField=Runner.extend(Runner.controls.DateField,{constructor:function(cfg){this.addEvent(["change","keyup"]);Runner.controls.DateTextField.superclass.constructor.call(this,cfg);if(cfg.disabled===true||cfg.disabled==="true"){this.setDisabled();}
this.defaultValue=this.getValue();},getValue:function(){var parsedTime=this.parseDateTime(this.valueElem.val(),this.dateFormat);if(parsedTime==null){return"";}else{return parsedTime;}},setValue:function(newDate,triggerEvent,updContext){newDate=Runner.controls.DateTextField.superclass.setValue.call(this,newDate,triggerEvent);if(typeof newDate=='object'&&newDate!=null){var dt=this.print_datetime(newDate,this.dateFormat);this.valueElem.val(dt);if(this.useDatePicker){dt=this.print_datetime(newDate,-1);this.datePickerHiddElem.val(dt);}
this.validate();return true;}else{this.valueElem.val("");if(this.useDatePicker){this.datePickerHiddElem.val("");}
this.validate();return false;}
if(triggerEvent===true){this.fireEvent("change",updContext);}},"blur":function(e){this.stopEvent(e);this.focusState=false;if(!this.invalid()){return;}
var vRes=this.validate();if(vRes.result&&this.useDatePicker&&this.getValue()){this.setValue(this.getValue());}},setDisabled:function(){if(this.valueElem.get(0)&&this.imgCal)
{this.valueElem.get(0).disabled=true;this.imgCal.css('visibility','hidden');return true;}else{return false;}},setEnabled:function(){if(this.valueElem.get(0)){this.valueElem.get(0).disabled=false;if(this.imgCal!=null)
this.imgCal.css('visibility','visible');return true;}else{return false;}},getForSubmit:function(){return[this.valueElem.clone(),this.dateFormatHiddElem.clone()];},getStringValue:function(){return this.valueElem.val();}});Runner.controls.DateDropDown=Runner.extend(Runner.controls.DateField,{hiddValueElem:null,hiddElemId:"",constructor:function(cfg){cfg.stopEventInit=true;Runner.controls.DateDropDown.superclass.constructor.call(this,cfg);this.valueElem={"day":$("#day"+this.valContId),"month":$("#month"+this.valContId),"year":$("#year"+this.valContId)};if(cfg.disabled===true||cfg.disabled==="true"){this.setDisabled();}
this.addEvent(["change"]);this.killEvent("blur");this.elemsForEvent=[this.valueElem["day"].get(0),this.valueElem["month"].get(0),this.valueElem["year"].get(0)];this.init();this.hiddElemId=this.valContId;this.hiddValueElem=$("#"+this.hiddElemId);this.inputType="3dd";if(Runner.lang.constants.TEXT_MONTH_JAN){this.addYearOptions(cfg.yearVal);this.addMonthOptions(cfg.monthVal);this.addDayOptions(cfg.dayVal);}
if(this.hiddValueElem.length){var dateObj=this.parseDateTime(this.hiddValueElem.val(),2);this.setValue(dateObj);}
this.defaultValue=this.getValue();},destructor:function(){Runner.controls.DateDropDown.superclass.destructor.call(this);this.valueElem['day'].remove();this.valueElem['month'].remove();this.valueElem['year'].remove();},initToolTip:function(text,pageObj){if(this.valueElem['day'].addClass&&this.valueElem['month'].addClass&&this.valueElem['year'].addClass){this.valueElem['day'].addClass('titleHintBox').inputHintBox({div:$('#shiny_box'),div_sub:'.shiny_box_body',html:text,incrementLeft:5,pageObj:pageObj,el:this.valueElem['year']});this.valueElem['month'].addClass('titleHintBox').inputHintBox({div:$('#shiny_box'),div_sub:'.shiny_box_body',html:text,incrementLeft:5,pageObj:pageObj,el:this.valueElem['year']});this.valueElem['year'].addClass('titleHintBox').inputHintBox({div:$('#shiny_box'),div_sub:'.shiny_box_body',html:text,incrementLeft:5,pageObj:pageObj});return true;}else{return false;}},addYearOptions:function(selectedYear){this.valueElem["year"].html('');var dt=new Date();var currentYear=dt.getFullYear();var initialYear=Runner.pages.PageSettings.getFieldData(this.table,this.fieldName,"initialYear");var lastYear=Runner.pages.PageSettings.getFieldData(this.table,this.fieldName,"lastYear");var startYear=currentYear-initialYear;var endYear=currentYear+lastYear;var opt=document.createElement('OPTION');$(opt).val('').html('');this.valueElem["year"].append(opt);for(var i=startYear;i<=endYear;i++){var opt=document.createElement('OPTION');$(opt).val(i).html(i);if(i==selectedYear){opt.selected=true;}
this.valueElem["year"].append(opt);};this.addYearOptions=Runner.emptyFn;},addMonthOptions:function(selectedMonth){this.valueElem["month"].html('');var opt=document.createElement('OPTION');$(opt).val('').html('');this.valueElem["month"].append(opt);var monthNames=[];monthNames[1]=Runner.lang.constants.TEXT_MONTH_JAN;monthNames[2]=Runner.lang.constants.TEXT_MONTH_FEB;monthNames[3]=Runner.lang.constants.TEXT_MONTH_MAR;monthNames[4]=Runner.lang.constants.TEXT_MONTH_APR;monthNames[5]=Runner.lang.constants.TEXT_MONTH_MAY;monthNames[6]=Runner.lang.constants.TEXT_MONTH_JUN;monthNames[7]=Runner.lang.constants.TEXT_MONTH_JUL;monthNames[8]=Runner.lang.constants.TEXT_MONTH_AUG;monthNames[9]=Runner.lang.constants.TEXT_MONTH_SEP;monthNames[10]=Runner.lang.constants.TEXT_MONTH_OCT;monthNames[11]=Runner.lang.constants.TEXT_MONTH_NOV;monthNames[12]=Runner.lang.constants.TEXT_MONTH_DEC;for(var i=1;i<monthNames.length;i++){var opt=document.createElement('OPTION');$(opt).val(i).html(monthNames[i]);if(i==selectedMonth){opt.selected=true;}
this.valueElem["month"].append(opt);}
this.valueElem["month"].css('width','90px');this.addMonthOptions=Runner.emptyFn;},addDayOptions:function(selectedDay){this.valueElem["day"].html('');var opt=document.createElement('OPTION');$(opt).val('').html('');this.valueElem["day"].append(opt);for(var i=1;i<=31;i++){var opt=document.createElement('OPTION');$(opt).val(i).html(i);if(i==selectedDay){opt.selected=true;}
this.valueElem["day"].append(opt);};this.addDayOptions=Runner.emptyFn;},"change":function(e){this.stopEvent(e);for(var name in this.valueElem){if(this.valueElem[name].val()=='')
{this.setValue();return true;}}
var vRes=this.validate();if(vRes.result){this.setValue(this.getValue());}
return vRes;},"blur":Runner.emptyFn,getValue:function()
{if(this.valueElem["day"]&&this.valueElem["day"].val()){var dayVal=this.valueElem["day"].val();}else{return false;}
if(this.valueElem["month"]&&this.valueElem["month"].val()){var monthVal=this.valueElem["month"].val();}else{return false;}
if(this.valueElem["year"]&&this.valueElem["year"].val()){var yearVal=this.valueElem["year"].val();}else{return false;}
var date=new Date(yearVal,monthVal-1,dayVal,00,00,00);return date;},setValue:function(newDate,triggerEvent,updContext){newDate=Runner.controls.DateTextField.superclass.setValue.call(this,newDate,triggerEvent);if(typeof newDate=='object'&&newDate!=null){this.hiddValueElem.get(0).value=newDate.getFullYear()+'-'+(newDate.getMonth()+1)+'-'+newDate.getDate();this.valueElem["day"].get(0).selectedIndex=newDate.getDate();this.valueElem["month"].get(0).selectedIndex=newDate.getMonth()+1;for(var i=0;i<this.valueElem["year"].get(0).options.length;i++){if(this.valueElem["year"].get(0).options[i].value==newDate.getFullYear()){this.valueElem["year"].get(0).selectedIndex=i;break;}}
if(this.useDatePicker){this.datePickerHiddElem.get(0).value=newDate.getDate()+'-'+(newDate.getMonth()+1)+'-'+newDate.getFullYear();if(this.calendar&&this.calendar.cfg.getProperty('pagedate').toString()!=newDate.toString()){this.calendar.cfg.setProperty('pagedate',newDate);this.calendar.select(newDate);}}
return true;}else{this.hiddValueElem.val('');if(updContext&&updContext.resetHappend||this.isClearHappend)
{this.valueElem["day"].get(0).selectedIndex=0;this.valueElem["month"].get(0).selectedIndex=0;this.valueElem["year"].get(0).selectedIndex=0;}
if(this.useDatePicker){this.datePickerHiddElem.val("");}
return false;}
if(triggerEvent===true){this.fireEvent("change",updContext);}},makeReadonly:function(){this.setDisabled();return true;},setDisabled:function(){if(!this.valueElem["day"]||!this.valueElem["month"]||!this.valueElem["year"]||!this.imgCal){return false;}
this.valueElem["day"][0].disabled=true;this.valueElem["month"][0].disabled=true;this.valueElem["year"][0].disabled=true;this.imgCal.css('visibility','hidden');return true;},setEnabled:function(){this.valueElem["day"][0].disabled=false;this.valueElem["month"][0].disabled=false;this.valueElem["year"][0].disabled=false;if(this.imgCal!=null){this.imgCal.css('visibility','visible');}
return true;},getForSubmit:function(){return[this.hiddValueElem.clone(),this.dateFormatHiddElem.clone()];},setFocus:function(triggerEvent){if(this.valueElem["day"].get(0).disabled!=true){cont=false;this.spanContElem.children().each(function(){if($(this).css("display")!="none"&&!cont){this.focus();cont=true;if(triggerEvent===true){this.fireEvent("focus");}
this.isSetFocus=true;}});return true;}else{this.isSetFocus=false;return false;}},isEmpty:function(){if(this.valueElem["day"].val()==""||this.valueElem["month"].val()==""||this.valueElem["year"].val()==""){return true;}else{return false;}},validate:function(valArr){if(!this.valueElem["day"].length||!this.valueElem["month"].length||!this.valueElem["year"].length){return{result:true,messageArr:[]};}
var vRes=validation.validate(valArr||this.validationArr,this);if(valArr||this.validationArr.length){if(!vRes.result){this.markInvalid(vRes.messageArr);}else{this.clearInvalid();}}
return vRes;},getStringValue:function(){return this.hiddValueElem.val();},appearOnPage:function(){var elemLen=0;for(var elem in this.valueElem){elemLen++;}
return elemLen;}});Runner.controls.LookupWizard=Runner.extend(Runner.controls.Control,{isLookupWizard:true,dependentCtrls:null,parentCtrl:null,parentFieldName:'',lookupTable:"",addNew:"",pageId:-1,dispField:"",linkField:"",preloadData:null,autoCompleteFields:null,constructor:function(cfg){cfg.stopEventInit=true;this.dependentCtrls=[];this.autoCompleteFields=[];Runner.controls.LookupWizard.superclass.constructor.call(this,cfg);this.addNew=$("#addnew_"+this.valContId);this.addEvent(["change"]);var control=this;this.addNew.bind("click",this,function(e){Runner.Event.prototype.stopEvent(e);if(!e.data.getPageParams)
return;var params=e.data.getPageParams();control.pageId=Runner.pages.PageManager.openPage(params);});},destructor:function(){Runner.controls.LookupWizard.superclass.destructor.call(this);delete this.dependentCtrls;},getPageParams:function(){var control=this,category='';if(this.parentCtrl){category=this.parentCtrl.getValue();}
return{tName:this.lookupTable,pageType:Runner.pages.constants.PAGE_ADD,destroyOnClose:true,fName:this.fieldName,category:this.parentFieldName,lookupCtrl:this,modal:true,baseParams:{parId:this.id,field:Runner.goodFieldName(this.fieldName),category:category,table:Runner.pages.PageSettings.getShortTName(this.table),editType:Runner.pages.constants.ADD_ONTHEFLY},afterSave:{fn:function(respObj,formObj,fieldControls,page){if(respObj.success){if(control.inputType=='select'){control.addOption(respObj.vals[control.dispField],respObj.vals[control.linkField]);control.setValue([respObj.vals[control.dispField],respObj.vals[control.linkField]],true);}else if(control.inputType=='text'&&control.suggestValues){control.suggestValues.push(respObj.vals[control.dispField]);control.lookupValues.push(respObj.vals[control.linkField]);control.setLookupValue(respObj.vals[control.linkField],true,respObj.vals[control.dispField]);}}else
{if(respObj.message!=undefined)
{$('#message_block'+page.id+' div.message').html(respObj.message);}
else if(respObj.html!=-1)
{page.win.setBody(respObj.html);}
$('div.bd').animate({scrollTop:0});return false;}},scope:this}}},addDependentCtrls:function(ctrlsArr){for(var i=0;i<ctrlsArr.length;i++){this.dependentCtrls.push(ctrlsArr[i]);}},clearChildrenLinks:function(triggerReload){for(var i=0;i<this.dependentCtrls.length;i++){if(this.dependentCtrls[i]){this.dependentCtrls[i].clearParent(triggerReload);}}},clearParent:function(triggerReload){this.parentCtrl=null;if(triggerReload===true){this.reload();}},setParentCtrl:function(ctrl){this.parentCtrl=ctrl;},reloadDependeces:function(updContext){if(!this.dependentCtrls||!this.dependentCtrls.length){return false;}
var masterCtrlVal=this.getValue();masterCtrlVal=typeof(masterCtrlVal)=='object'?masterCtrlVal[0]:masterCtrlVal;for(var i=0;i<this.dependentCtrls.length;i++){if(this.dependentCtrls[i]){this.dependentCtrls[i].reload(masterCtrlVal,updContext);}}},clearInvalidOnDependences:function(){if(!this.dependentCtrls)
return;for(var i=0;i<this.dependentCtrls.length;i++){if(this.dependentCtrls[i]){this.dependentCtrls[i].clearInvalid();}}},doAutoCompleteFields:function(val){if(this.autoCompleteFields.length){$.ajax({url:'autofillfields.php',type:"GET",dataType:"json",data:{mainTable:Runner.pages.PageSettings.getShortTName(this.table),mainField:this.fieldName,linkField:this.linkField,linkFieldVal:val||this.getValue()},success:(function(respObj){if(!respObj.success){return false;}
var data=respObj.data,updContext={values:{}},valToFill,ctrl=null;for(var i=0;i<this.autoCompleteFields.length;i++){updContext.values[this.autoCompleteFields[i].masterF]=[data[this.autoCompleteFields[i].lookupF]];}
for(var i=0;i<this.autoCompleteFields.length;i++){ctrl=Runner.controls.ControlManager.getAt(this.table,this.id,this.autoCompleteFields[i].masterF);if(!ctrl)
continue;valToFill=data[this.autoCompleteFields[i].lookupF];if(valToFill==null||typeof valToFill=='undefined'){valToFill='';}
ctrl.setValue(valToFill,true,updContext);}}).createDelegate(this)});}},"change":function(){var updContext={};if(arguments.length>1&&typeof arguments[1]=='object'){updContext=arguments[1];}
if(!updContext.resetHappend){this.doAutoCompleteFields();}
this.clearInvalidOnDependences();var vRes=this.validate();if(vRes.result){this.reloadDependeces(updContext);return true;}else{return false;}}});Runner.controls.RadioControl=Runner.extend(Runner.controls.LookupWizard,{radioElemsId:"",radioElemsArr:[],radioElemsNameAttr:"",radioElem:null,radioElemsCount:0,constructor:function(cfg){this.radioElemsArr=new Array();cfg.stopEventInit=true;Runner.controls.RadioControl.superclass.constructor.call(this,cfg);this.radioElemsId="radio_"+this.goodFieldName+"_"+this.id+"_";this.radioElemsNameAttr="radio_"+this.goodFieldName+"_"+this.id;this.radioElem=$('input[name='+this.radioElemsNameAttr+']');this.radioElemsCount=this.radioElem.length;for(var i=0;i<this.radioElemsCount;i++){this.radioElemsArr.push($("#"+this.radioElemsId+i));this.elemsForEvent.push(this.radioElemsArr[i].get(0));}
if(cfg.disabled==true||cfg.disabled=="true"){this.setDisabled();}
this.addEvent(["click"]);this.init();},setValue:function(val,triggerEvent,updContext){var choosen=false;for(var i=0;i<this.radioElemsCount;i++){if(this.radioElemsArr[i].val()==val){this.radioElemsArr[i].get(0).checked=true;this.valueElem.val(val);choosen=true;}else{this.radioElemsArr[i].get(0).checked=false;}}
if(!choosen){this.valueElem.val('');}
if(triggerEvent===true){this.fireEvent("change",updContext);}
return choosen;},setDisabled:function(){for(var i=0;i<this.radioElemsCount;i++){this.radioElemsArr[i].get(0).disabled=true;}
return true;},setEnabled:function(){for(var i=0;i<this.radioElemsCount;i++){this.radioElemsArr[i].get(0).disabled=false;}
return true;},"blur":Runner.emptyFn,"change":Runner.emptyFn,"click":function(e){if(e.target.value!=this.getValue()){this.setValue(e.target.value,false);this.doAutoCompleteFields();return this.validate().result;}else{return true;}},initToolTip:function(text,pageObj){if(this.valueElem.addClass&&this.mode!=Runner.controls.constants.MODE_SEARCH&&this.valueElem.parent().length&&this.valueElem.parent().get(0).nodeName=="SPAN"){this.valueElem.parent().addClass('titleHintBox').inputHintBox({div:$('#shiny_box'),div_sub:'.shiny_box_body',html:text,incrementLeft:5,pageObj:pageObj});this.initToolTip=Runner.emptyFn;return true;}else{return false;}}});Runner.controls.DropDownLookup=Runner.extend(Runner.controls.LookupWizard,{multiSel:1,optionsDOM:null,constructor:function(cfg){this.multiSel=cfg.multiSel?cfg.multiSel:1;this.valContId="value"+(cfg.ctrlInd||"")+"_"+cfg.goodFieldName+"_"+cfg.id;this.valueElem=$("#"+this.valContId);if(this.appearOnPage()){this.optionsDOM=this.valueElem.get(0).options;}else{this.optionsDOM=[];}
Runner.controls.DropDownLookup.superclass.constructor.call(this,cfg);this.inputType="select";this.elemsForEvent=[this.valueElem.get(0)];this.init();if(cfg.disabled==true||cfg.disabled=="true"){this.setDisabled();}
if(this.preloadData){this.preload(this.preloadData.vals,this.preloadData.fVal);}
this.defaultValue=this.getValue(true);},setValue:function(pvals,triggerEvent,updContext){var vals=pvals
if(!Runner.isArray(pvals)){vals=[pvals]}
var choosen=0;for(var i=0;i<this.valueElem.get(0).options.length;i++){for(var j=0;j<vals.length;j++){if(this.valueElem.get(0).options[i].value==vals[j]){try{this.optionsDOM[i].selected=true;choosen++;}catch(e){};if(this.multiSel==1){try{this.valueElem.get(0).selectedIndex=i;}catch(e){};}else{break;}}else{try{this.optionsDOM[i].selected=false;}catch(e){};}}
if(choosen>0&&this.multiSel==1){break;}}
if(triggerEvent===true){this.fireEvent("change",updContext);}
if(choosen==vals.length&&choosen<=this.multiSel){return true;}else{return false;}},getValue:function(returnArray){var selVals=[];if(this.optionsDOM.length){for(var i=0;i<this.optionsDOM.length;i++){if(this.optionsDOM[i].selected)
selVals.push(this.optionsDOM[i].value)}}else if(this.appearOnPage()){for(var i=0;i<this.valueElem.get(0).options.length;i++){if(this.valueElem.get(0).options[i].selected){selVals.push(this.valueElem.get(0).options[i].value);}}}
if(returnArray===true)
return selVals;if(selVals.length>1)
return selVals;else if(selVals.length==1)
return selVals[0];else
return"";},isEmpty:function(){var selVals=this.getValue();if(typeof selVals!='object')
return selVals==="";return false;},clearOptions:function(){var select=this.valueElem.get(0);for(var i=this.optionsDOM.length-1;i>-1;i--){select.remove(i);}},addOption:function(text,val){var opt=new Option(text,val);$(opt).html(text);this.valueElem.append(opt);},addOptionsArr:function(optionsArr){for(var i=0;i<optionsArr.length-1;i=i+2){this.addOption(optionsArr[i+1],optionsArr[i]);}},preload:function(vals,selectValue){this.clearOptions();if(this.multiSel==1){this.addOption(Runner.lang.constants.TEXT_PLEASE_SELECT,"");}
this.addOptionsArr(vals);if(this.optionsDOM.length==2){this.setValue([this.optionsDOM[1].value],false);}else if((this.multiSel==1)&&(selectValue!=null)&&(selectValue!='')){selectValue=[selectValue];this.setValue(selectValue,false);}else if(this.optionsDOM.length>0){this.setValue([this.optionsDOM[0].value],false);}},reload:function(masterCtrlValue,updContext){var fName=this.fieldName,tName=this.table,rowId=this.id;if(masterCtrlValue&&!this.parentCtrl){return false;}
var ajaxParams={field:fName,value:(masterCtrlValue!==undefined?masterCtrlValue:''),isExistParent:(this.parentCtrl?1:0),type:this.valueElem[0].tagName,mode:this.mode,rndVal:(new Date().getTime())};var ctrl=this;$.get(this.shortTableName+"_autocomplete.php",ajaxParams,function(respObj,textStatus){if(respObj){respObj=JSON.parse(respObj);}else{respObj={data:{}};}
var data=respObj.data;ctrl.clearOptions();if(ctrl.multiSel==1){ctrl.addOption(Runner.lang.constants.TEXT_PLEASE_SELECT,"");}
ctrl.addOptionsArr(data);if(ctrl.optionsDOM.length==2&&ctrl.multiSel==1){ctrl.setValue([ctrl.optionsDOM[1].value],false);}else if(ctrl.optionsDOM.length==1&&ctrl.multiSel>1){ctrl.setValue([ctrl.optionsDOM[0].value],false);}
if(updContext&&updContext.values&&updContext.values[ctrl.fieldName]){ctrl.setValue([updContext.values[ctrl.fieldName]],true,updContext);}
ctrl.fireEvent("change",updContext);ctrl.clearInvalid();});},setDisabled:function(){if(this.valueElem){this.valueElem.get(0).disabled=true;if(this.addNew){this.addNew.css('visibility','hidden');}
return true;}
return false;},setEnabled:function(){if(this.valueElem){this.valueElem.get(0).disabled=false;if(this.addNew){this.addNew.css('visibility','visible');}
return true;}else{return false;}},getForSubmit:function(){if(!this.appearOnPage()){return[];}
var clone=this.valueElem.clone(),selVals=this.getValue(true);var cloneOpt=clone.get(0).options;for(var i=0;i<cloneOpt.length;i++){for(var j=0;j<selVals.length;j++){if(cloneOpt[i].value==selVals[j]){if(this.multiSel==1)
clone.get(0).selectedIndex=i;cloneOpt[i].selected=true;break;}
else
{cloneOpt[i].selected=false;}}}
return[clone];},"blur":Runner.emptyFn});Runner.controls.CheckBoxLookup=Runner.extend(Runner.controls.LookupWizard,{typeElemId:"",typeElem:null,checkBoxCount:0,checkBoxesArr:null,checkBoxNameAttr:"",constructor:function(cfg){this.checkBoxesArr=[];Runner.controls.CheckBoxLookup.superclass.constructor.call(this,cfg);this.inputType="checkbox";this.typeElemId="type_"+this.goodFieldName+"_"+this.id;this.typeElem=$("#"+this.typeElemId);this.dataCheckBoxId="data_"+this.valContId;if(($("#"+this.valContId)).length){var checkBox=$("#"+this.valContId);this.checkBoxesArr.push(checkBox);this.elemsForEvent.push(this.checkBoxesArr[0].get(0));}else{var checkBox,i=0;while(($("#"+this.valContId+"_"+i)).length){checkBox=$("#"+this.valContId+"_"+i);this.checkBoxesArr.push(checkBox);this.elemsForEvent.push(this.checkBoxesArr[i].get(0));i++;}}
if(cfg.disabled==true||cfg.disabled=="true"){this.setDisabled();}
this.addEvent(["click"]);this.init();this.defaultValue=this.getValue();this.checkBoxNameAttr='value_'+this.goodFieldName+'_'+this.id;this.valueElem=$('input[name^='+this.checkBoxNameAttr+']');},setValue:function(valsArr,triggerEvent,updContext){var checkCount=0;for(var i=0;i<this.checkBoxesArr.length;i++){this.checkBoxesArr[i].get(0).checked=false;for(var j=0;j<valsArr.length;j++){if(this.checkBoxesArr[i].val()==valsArr[j]){this.checkBoxesArr[i].get(0).checked=true;checkCount++;break;}}}
if(triggerEvent===true){this.fireEvent("click",updContext);}
if(checkCount==valsArr.length&&checkCount<=this.checkBoxesArr.length&&valsArr.length<=this.checkBoxesArr.length){return true;}else{return false;}},getValue:function(){var checkedArr=this.getCheckedBoxes(),valsArr=[];for(var i=0;i<checkedArr.length;i++){valsArr.push(checkedArr[i].val());}
return valsArr;},getStringValue:function(){return this.getValue().join(",");},isEmpty:function(){if(this.getValue().length==0){return true;}else{return false;}},setDisabled:function(){for(var i=0;i<this.checkBoxesArr.length;i++){this.checkBoxesArr[i].get(0).disabled=true;}
return true;},setEnabled:function(){for(var i=0;i<this.checkBoxesArr.length;i++){this.checkBoxesArr[i].get(0).disabled=false;}
return true;},setDisabledShowCheckedBoxes:function()
{for(var i=0;i<this.checkBoxesArr.length;i++)
{if(this.checkBoxesArr[i].get(0).checked)
this.checkBoxesArr[i].get(0).disabled=true;else{var dataId=$('#'+this.dataCheckBoxId+'_'+i);this.checkBoxesArr[i].css("display","none");dataId.css("display","none");dataId.next().css("display","none");}}
return true;},getCheckedBoxes:function(){var chekedArr=[];for(var i=0;i<this.checkBoxesArr.length;i++){if(this.checkBoxesArr[i].get(0).checked){chekedArr.push(this.checkBoxesArr[i]);}}
return chekedArr;},getForSubmit:function(){var checkedArr=this.getCheckedBoxes(),cloneArr=[];for(var i=0;i<checkedArr.length;i++){var realCb=checkedArr[i];var cbClone=document.createElement('input');$(cbClone).attr('type','hidden');$(cbClone).attr('id',realCb.attr('id'));$(cbClone).attr('name',realCb.attr('name'));$(cbClone).val(realCb.val());cloneArr.push(cbClone);}
cloneArr.push(this.typeElem);return cloneArr;},clearCheckBoxes:function(){this.spanContElem.find('div').children().remove().append('<br>');this.checkBoxesArr=[];},addCheckBox:function(text,val){var newCheckBoxId=this.valContId+"_"+this.checkBoxesArr.length;var checkBox=document.createElement("INPUT");$(checkBox).attr("type","checkbox").attr("id",newCheckBoxId).attr("name",this.valContId+'[]').val(val);var label=document.createElement("B");$(label).attr("id","data_"+newCheckBoxId).html(text);this.spanContElem.find('div').append(checkBox).append("&nbsp;").append(label).append("<br/>");this.checkBoxesArr.push($("#"+newCheckBoxId));},addCheckBoxArr:function(optionsArr){for(var i=0;i<optionsArr.length-1;i=i+2){this.addCheckBox(optionsArr[i+1],optionsArr[i]);}},preload:function(vals,selectValue){this.clearCheckBoxes();this.addCheckBoxArr(vals);if(this.checkBoxesArr.length==1){this.setValue([this.checkBoxesArr[0].val()],false);}
this.setValue([selectValue],false);},reload:function(masterCtrlValue,updContext){var ctrl=this,fName=this.fieldName,tName=this.table,rowId=this.id;var ajaxParams={field:fName,value:masterCtrlValue,type:this.valueElem[0].tagName,rndVal:(new Date().getTime())};$.get(this.shortTableName+"_autocomplete.php",ajaxParams,function(respObj,textStatus){respObj=JSON.parse(respObj);var data=respObj.data;ctrl.clearCheckBoxes();var data=ctrl.parseContentToValues(txt);if(data===false){return false;}
ctrl.addOptionsArr(data);if(ctrl.checkBoxesArr.length==1){ctrl.setValue([ctrl.checkBoxesArr[0].val()],false);}
if(updContext&&updContext.values&&updContext.values[ctrl.fieldName]){ctrl.setValue([updContext.values[ctrl.fieldName]],true,updContext);}
ctrl.fireEvent("change",updContext);ctrl.clearInvalid();});},"blur":Runner.emptyFn,"click":this["change"]});Runner.controls.TextFieldLookup=Runner.extend(Runner.controls.LookupWizard,{displayId:"",displayElem:null,constructor:function(cfg){Runner.controls.TextFieldLookup.superclass.constructor.call(this,cfg);this.displayId="display_"+this.valContId;this.displayElem=$("#"+this.displayId);this.inputType="text";this.elemsForEvent=[this.valueElem.get(0)];if(cfg.disabled==true||cfg.disabled=="true"){this.setDisabled();}
if(this.preloadData){this.preload(this.preloadData.vals,this.preloadData.fVal);}
this.defaultValue=[this.getValue(),this.getDisplayValue()];},setDisplayValue:function(val){if(this.displayElem){return this.displayElem.val(val);}else{return false;}},getDisplayValue:function(){if(this.displayElem){return this.displayElem.val();}else{return false;}},setValue:function(value,triggerEvent,updContext){this.setLookupValue(value,triggerEvent,value,updContext);},setLookupValue:function(hiddVal,triggerEvent,dispVal,updContext){var changed=false;if(this.valueElem.val()!=hiddVal)
changed=true;var isSetHiddVal=this.valueElem.val(hiddVal);if(isSetHiddVal===false){return false;}
if(this.getDisplayValue()!=dispVal)
changed=true;var isSetDispVal=this.setDisplayValue(dispVal);if(isSetDispVal===false){return false;}
if(changed&&triggerEvent===true){this.fireEvent("change",updContext);}
return changed;},getValue:function(){return this.valueElem.val();},reset:function(updContext){this.setLookupValue(this.defaultValue[0],true,this.defaultValue[1],updContext);this.clearInvalid();return true;},setDisabled:function(){if(this.displayElem){this.displayElem.get(0).disabled=true;return true;}else{return false;}},setEnabled:function(){if(this.displayElem){this.displayElem.get(0).disabled=false;return true;}else{return false;}},setFocus:function(triggerEvent){if(this.displayElem.get(0)&&this.displayElem.get(0).disabled!=true){this.displayElem.get(0).focus();if(triggerEvent===true){this.fireEvent("focus");}
this.isSetFocus=true;return true;}else{this.isSetFocus=false;return false;}},removeCSS:function(className){this.displayElem.removeClass(className);},addCSS:function(className){this.displayElem.addClass(className);},getAttr:function(attrName){return this.displayElem.attr(attrName);},getDispElem:function(){return this.displayElem;},isEmpty:function(){return this.getDisplayValue().toString()=="";},preload:function(vals,selectValue){for(var i=0;i<vals.length-1;i=i+2){if(vals[i]==selectValue){this.setLookupValue(vals[i],false,vals[i+1]);}}},reload:function(masterCtrlValue,updContext){var fName=this.fieldName,tName=this.table,rowId=this.id;if(masterCtrlValue&&!this.parentCtrl){return false;}
var ajaxParams={field:fName,value:masterCtrlValue,isExistParent:(this.parentCtrl?1:0),mode:this.mode,type:this.valueElem[0].tagName,rndVal:(new Date().getTime())};var ctrl=this;$.get(this.shortTableName+"_autocomplete.php",ajaxParams,function(respObj,reqStatus){var data=[],triggerEvent=false;if(respObj){respObj=JSON.parse(respObj);data=respObj.data;}
if(data.length==2){if(ctrl.getValue()!=data[0]){triggerEvent=true;}
ctrl.setLookupValue(data[0],triggerEvent,data[1],updContext);}else{ctrl.setValue("",true,updContext);}
if(updContext&&updContext.values&&updContext.values[ctrl.fieldName]){triggerEvent=false;if(ctrl.getValue()!=updContext.values[ctrl.fieldName][0]){triggerEvent=true;}
if(updContext.values[ctrl.fieldName].length==2){ctrl.setLookupValue(updContext.values[ctrl.fieldName][0],triggerEvent,updContext.values[ctrl.fieldName][1],updContext);}else{ctrl.setValue(updContext.values[ctrl.fieldName],triggerEvent,updContext);}}
ctrl.clearInvalid();});},initToolTip:function(text,pageObj){if(this.displayElem.addClass&&this.mode!=Runner.controls.constants.MODE_SEARCH){this.displayElem.addClass('titleHintBox').inputHintBox({div:$('#shiny_box'),div_sub:'.shiny_box_body',html:text,incrementLeft:5,pageObj:pageObj});this.initToolTip=Runner.emptyFn;return true;}else{return false;}}});Runner.controls.EditBoxLookup=Runner.extend(Runner.controls.TextFieldLookup,{focusState:false,cursor:-1,suggestValues:null,lookupValues:null,lookupDivId:"",lookupDiv:null,lookupIframe:null,freeInput:false,isError:false,constructor:function(cfg){this.lookupValues=[];this.suggestValues=[];Runner.controls.EditBoxLookup.superclass.constructor.call(this,cfg);this.lookupDivId='lookupSuggest_'+this.valContId;this.init();this.elemsForEvent=[this.displayElem.get(0)];this.on("blur",this.blur.fn,this.blur.options,this.blur.scope);this.on("keyup",this.keyup.fn,this.keyup.options,this.keyup.scope);this.on("focus",this.focus.fn,this.focus.options,this.focus.scope);this.on("keydown",this.keydown.fn,this.keydown.options,this.keydown.scope);},setFrame:function(b){if(b&&this.getDisplayValue()!=""&&!this.freeInput){this.addCSS("highlight");this.isError=true;}else{this.removeCSS("highlight");this.isError=false;}},destructor:function(){Runner.controls.EditBoxLookup.superclass.destructor.call(this);this.destroyDiv();},isEmpty:function(){return Runner.controls.EditBoxLookup.superclass.isEmpty.call(this)||this.isError;},checkKeyCodeForRunSuggest:function(keyCode){return(((keyCode>=65)&&(keyCode<=90))||((keyCode>=48)&&(keyCode<=57))||((keyCode>=96)&&(keyCode<=105))||(keyCode==8)||(keyCode==46)||(keyCode==32)||(keyCode==222));},"keyup":{fn:function(e){if(this.getDisplayValue()==""){this.destroyDiv();this.setFrame(false);this.setValue("",true);return;}
if(this.freeInput)
{var eventsFlag=(this.getDisplayValue()!=this.getValue());this.setValue(this.getDisplayValue(),eventsFlag);}
this.focus();if(e&&this.checkKeyCodeForRunSuggest(e.keyCode)){this.lookupAjax();}},options:{buffer:200}},"keydown":function(e){var keyCode=e.keyCode;switch(keyCode){case 38:this.moveUp();break;case 40:this.moveDown();break;case 13:this.destroyDiv();this.stopEvent(e);return false;break;}
return true;},showDiv:function(divsArr){this.destroyDiv();if(!divsArr.length)
return;this.lookupDiv=$(document.createElement("DIV"));this.lookupDiv.attr("id",this.lookupDivId).addClass("search_suggest").css("visibility","visible").appendTo(document.body);for(var i=0;i<divsArr.length;i++){this.lookupDiv.append(divsArr[i]);}
this.setDivPos();},destroyDiv:function(){if(this.lookupDiv){this.lookupDiv.remove();}
this.cursor=-1;this.lookupDiv=null;},setDivPos:function(){if(!this.lookupDiv)
return;var dispPos=Runner.getPosition(this.getDispElem().get(0));dispPos.top+=dispPos.height;this.lookupDiv.css("top",dispPos.top+"px");this.lookupDiv.css("left",dispPos.left+"px");Runner.setZindexMaxToElem(this.lookupDiv);},suggestOver:function(divHovered){this.lookupDiv.find("div.suggest_link_over").each(function(){this.className='suggest_link';});divHovered.className='suggest_link_over';this.cursor=divHovered.id.substring(10);},suggestOut:function(divValue){divValue.className='suggest_link';},lookupAjax:function(){var table=this.table,recId=this.id,fName=this.fieldName,ctrl=this;var ajaxParams={mode:this.mode,table:this.shortTableName,searchFor:this.getDisplayValue(),searchField:this.goodFieldName,lookupValue:this.getValue(),category:(this.parentCtrl?this.parentCtrl.getValue():""),rndVal:(new Date().getTime()),editMode:this.mode}
$.get("lookupsuggest.php",ajaxParams,function(respObj,textStatus){respObj=JSON.parse(respObj);if(!respObj.success){ctrl.setFrame(true);ctrl.destroyDiv();return false;}
var data=respObj.data,dispVal=ctrl.getDisplayValue();ctrl.suggestValues=[];ctrl.lookupValues=[];var found=false;if(ctrl.freeInput){found=true;}
var divsArr=[];for(var i=0,j=0;i<data.length-1;i=i+2,j++)
{if(ctrl.focusState)
{(function(i,j){var suggestDiv=$(document.createElement("DIV")).attr("id","suggestDiv"+i).css("cursor","pointer").addClass("suggest_link").html(data[i+1]).bind("mouseover",function(){ctrl.suggestOver(this);}).bind("mouseout",function(){ctrl.suggestOut(this);}).bind("click",function(){ctrl.setFrame(false);ctrl.setLookupValue(data[i],true,ctrl.suggestValues[j]);ctrl.destroyDiv();});divsArr.push(suggestDiv);})(i,j);}
ctrl.suggestValues[j]=data[i+1];ctrl.lookupValues[j]=data[i];if(!found&&ctrl.suggestValues[j]==dispVal)
{var eventsFlag=(ctrl.lookupValues[j]!=ctrl.getValue());ctrl.setLookupValue(ctrl.lookupValues[j],true,ctrl.suggestValues[j]);found=true;}}
if(!ctrl.focusState)
{if(found)
{ctrl.setFrame(false);}
else
{ctrl.setFrame(true);var eventsFlag=(ctrl.getValue()!="");ctrl.setLookupValue("",eventsFlag,dispVal);}
return true;}
if(ctrl.lookupValues.length)
ctrl.setFrame(false);else
ctrl.setFrame(true);ctrl.showDiv(divsArr);ctrl.setDivPos();$("body,input,a").click(function(evt){var target=evt.target;if(target.id.substr(0,10)!="suggestDiv"){ctrl.destroyDiv();}});});},moveDown:function(){if(!this.lookupDiv)
return;if(this.lookupDiv.children().length>0&&this.cursor<this.lookupDiv.children().length){this.cursor++;for(var i=0;i<this.lookupDiv.children().length;i++){if(i==this.cursor){this.setFrame(false);this.lookupDiv.children().get(i).className="suggest_link_over";var suggestVal=this.suggestValues[this.cursor].replace(/\<(\/b|b)\>/gi,""),lookupVal=this.lookupValues[this.cursor];if(this.getValue()!=lookupVal){this.setLookupValue(lookupVal,true,suggestVal);}else{this.setLookupValue(lookupVal,false,suggestVal);}}
else{this.lookupDiv.children().get(i).className="suggest_link";}}
if(this.cursor==(this.lookupDiv.children().length)){this.cursor=-1;this.focus();}}},moveUp:function()
{if(!this.lookupDiv)
return;if(this.lookupDiv.children().length>0&&this.cursor>=-1){this.cursor--;if(this.cursor==-2){this.cursor=this.lookupDiv.children().length-1;this.focus();}
for(var i=0;i<this.lookupDiv.children().length;i++){if(i==this.cursor){this.setFrame(false);this.lookupDiv.children().get(i).className="suggest_link_over";var suggestVal=this.suggestValues[this.cursor].replace(/\<(\/b|b)\>/gi,""),lookupVal=this.lookupValues[this.cursor];if(this.getValue()!=lookupVal){this.setLookupValue(lookupVal,true,suggestVal);}else{this.setLookupValue(lookupVal,false,suggestVal);}}
else{this.lookupDiv.children().get(i).className="suggest_link";}}}},setDisabled:function()
{var res=Runner.controls.EditBoxLookup.superclass.setDisabled.call(this);if(res){this.addNew.css('visibility','hidden');}
return res;},setEnabled:function()
{var res=Runner.controls.EditBoxLookup.superclass.setEnabled.call(this);if(res){this.addNew.css('visibility','visible');}
return res;},"blur":function(e){this.focusState=false;if(!this.freeInput)
{if(this.suggestValues.length)
{if(this.getDisplayValue()!=""&&!this.suggestValues.isInArray(this.getDisplayValue()))
this.setFrame(true);else
this.setFrame(false);}
this.lookupAjax();}
var ctrl=this;setTimeout(function()
{ctrl.destroyDiv();},250);Runner.controls.EditBoxLookup.superclass["blur"].call(this,e);},"focus":function(e){this.stopEvent(e);this.focusState=true;},setLookupValue:function(hiddVal,triggerEvent,dispVal,updContext){Runner.controls.EditBoxLookup.superclass.setLookupValue.call(this,hiddVal,triggerEvent,dispVal,updContext);}});Runner.controls.ListPageLookup=Runner.extend(Runner.controls.TextFieldLookup,{selectLinkId:"",selectLinkElem:null,lookupVals:null,selectField:'',isLookupOpen:false,constructor:function(cfg){Runner.controls.ListPageLookup.superclass.constructor.call(this,cfg);this.init();this.selectLinkId="open_lookup_"+this.goodFieldName+"_"+this.id;this.selectLinkElem=$("#"+this.selectLinkId);if(cfg.disabled==true||cfg.disabled=="true"){this.setDisabled();}
var control=this,eventParams={tName:this.lookupTable,pageType:Runner.pages.constants.PAGE_LIST,pageId:this.pageId,lookupCtrl:this,destroyOnClose:true,modal:true,baseParams:{parId:this.id,field:this.fieldName,category:"",table:this.table,firstTime:1,mode:"lookup",editMode:this.mode}};this.selectLinkElem.bind("click",eventParams,function(e){Runner.Event.prototype.stopEvent(e);if(control.parentCtrl){e.data.baseParams.category=control.parentCtrl.getValue();}else{e.data.baseParams.category='';}
control.pageId=Runner.pages.PageManager.openPage(e.data);control.setDisabled();});},setDisabled:function(){var res=Runner.controls.ListPageLookup.superclass.setDisabled.call(this);if(res){if(this.selectLinkElem){this.selectLinkElem.css('visibility','hidden');}}
return res;},setEnabled:function(){var res=Runner.controls.ListPageLookup.superclass.setEnabled.call(this);if(res){if(this.selectLinkElem){this.selectLinkElem.css('visibility','visible');}}
return res;},setValByInd:function(valInd){this.setLookupValue(this.lookupVals[valInd].linkVal,true,this.lookupVals[valInd].dispVal);},addLookupVal:function(linkVal,dispVal){return(this.lookupVals.push({'linkVal':linkVal,'dispVal':dispVal})-1);},initLink:function(link,ind){var ctrl=this;link.bind('click',function(e){ctrl.stopEvent(e);ctrl.setValByInd(ind);Runner.pages.PageManager.unregister(ctrl.lookupTable,ctrl.pageId);ctrl.setFocus();});},initLinks:function(winId){var links=$("a[type='lookupSelect"+winId+"']");this.setEnabled();for(var i=0;i<links.length;i++){this.initLink($(links[i]),i);}}});Runner.namespace('Runner.util.inlineEditing');Runner.util.inlineEditing.InlineEditor=Runner.extend(Runner.util.Observable,{tName:"",shortTName:"",id:-1,rows:null,ajaxRequestUrl:null,lookupTable:"",categoryValue:"",lookupField:"",fNames:null,pageType:"",pageObj:"",submitUrl:"",saveAllButt:null,cancelAllButt:null,massRecButtEditMode:false,isUseFileUpload:true,hideRevertButt:false,hideSaveButt:false,baseParams:null,loadSettings:false,isVertLayout:false,constructor:function(cfg){this.rows=[];this.fNames=[];this.baseParams={};Runner.apply(this,cfg);Runner.util.inlineEditing.InlineEditor.superclass.constructor.call(this,cfg);this.pageObj=Runner.pages.PageManager.getAt(this.tName,this.id);this.isUseIbox=Runner.pages.PageSettings.getTableData(this.tName,"isUseIbox");this.totalFields=Runner.pages.PageSettings.getTableData(this.tName,"totalFields");this.isUseLocking=Runner.pages.PageSettings.getTableData(this.tName,"locking");this.addEvents('rowsEdited','createControls','beforeSubmit','afterSubmit','submitFailed','beforeProcessNewRow',"revertRow","validationFailed","afterInit","beforeRequestControls");this.on('rowsEdited',function(){this.toggleMassRecButt();this.calcTotals();},this);this.rowPref="gridRow";},initEvents:function(pageType){var events=Runner.pages.PageSettings.getTableData(this.tName,"events"),eventHnArr,i;for(var pType in events){if(pType!=this.pageType){continue;}
for(var evName in events[pType]){if(evName!='afterInit'){continue;}
eventHnArr=events[pType][evName];for(i=0;i<eventHnArr.length;i++){this.on(evName,eventHnArr[i].hn,eventHnArr[i].scope||this.pageObj||this);}}}},init:function(){this.initButtons();this.initEvents();},reInit:function(gridRows){this.rows=gridRows;if(this.pageObj.pageMode==Runner.pages.constants.MODE_LIST_DETAILS){this.initButtons();}},resetSelectAll:function(){if($('#select_all'+this.id).length){$('#select_all'+this.id).get(0).checkAllStatus=false;}
if($('.chooseAll'+this.id).length){$('input[type=checkbox][id^=chooseAll_'+this.id+']').each(function(){this.checked=false;});}},initButtons:function(){this.editAllButt=$("#edit_selected"+this.id);this.saveAllButt=$("#saveall_edited"+this.id);this.cancelAllButt=$("#revertall_edited"+this.id);var inlineObj=this;this.saveAllButt.bind("click",function(e){Runner.Event.prototype.stopEvent(e);inlineObj.saveAll();inlineObj.resetSelectAll();});this.cancelAllButt.bind("click",function(e){Runner.Event.prototype.stopEvent(e);inlineObj.cancelAll();inlineObj.resetSelectAll();if(inlineObj.isUseIbox){init_ibox();}});},parseForTotals:function(val,format){if(format=='Number'){return parseFloat(val);}else if(format=='Time'){var timeArr=val.split(":");if(timeArr.length!=3){return[0,0,0];}else{timeArr[0]=parseInt(timeArr[0],10);timeArr[1]=parseInt(timeArr[1],10);timeArr[2]=parseInt(timeArr[2],10);return timeArr;}}else{return val.toString().trim();}},calcTotalField:function(fName,format){var fVal,sec=0,s,m,h,d,totalVal=0;for(var i=0;i<this.rows.length;i++){if(typeof this.rows[i].data[fName]=="undefined"){this.getValuesFromSpan(this.rows[i]);}
fVal=this.parseForTotals(this.getValueFromSpan(this.rows[i],fName),format);if(!fVal){continue;}
if(format=="Time"){sec+=fVal[2]+fVal[1]*60+fVal[0]*3600;}else{var parsedVal=parseFloat(fVal);if(!isNaN(parsedVal)){totalVal+=parsedVal;}}}
if(format=='Time'){s=sec%60;sec-=s;sec/=60;m=sec%60;sec-=m;sec/=60;h=sec%24;sec-=h;sec/=24;d=sec;totalVal=(d>0?d+'d ':'')+(h==0?'00':h)+':'+(m>9?m:(m==0?'00':'0'+m))+':'+(s>9?s:(s==0?'00':'0'+s));}
$("#total"+this.id+"_"+Runner.goodFieldName(fName)).html(''+totalVal);},calcCountField:function(fName,format){var fVal,totalVal=0;for(var i=0;i<this.rows.length;i++){if(typeof this.rows[i].data[fName]=="undefined"){this.getValuesFromSpan(this.rows[i]);}
fVal=this.rows[i].data[fName].toString().trim();if(fVal){totalVal++;}}
$("#total"+this.id+"_"+Runner.goodFieldName(fName)).html(''+totalVal);},calcAverageField:function(fName,format){var fVal,sec=0,s,m,h,d,totalVal=0;for(var i=0;i<this.rows.length;i++){if(typeof this.rows[i].data[fName]=="undefined"){this.getValuesFromSpan(this.rows[i]);}
fVal=this.parseForTotals(this.getValueFromSpan(this.rows[i],fName),format);if(!fVal){continue;}
if(format=="Time"){sec+=fVal[2]+fVal[1]*60+fVal[0]*3600;}else{var parsedVal=parseFloat(fVal);if(!isNaN(parsedVal))
totalVal+=parsedVal;}}
if(format=='Time'){sec=Math.round(sec/this.rows.length);s=sec%60;sec-=s;sec/=60;m=sec%60;sec-=m;sec/=60;h=sec%24;sec-=h;sec/=24;d=sec;totalVal=(d>0?d+'d ':'')+(h==0?'00':h)+':'+(m>9?m:(m==0?'00':'0'+m))+':'+(s>9?s:(s==0?'00':'0'+s));}else{totalVal=Math.round((totalVal/this.rows.length)*100)/100;}
$("#total"+this.id+"_"+Runner.goodFieldName(fName)).html(''+totalVal);},calcTotals:function(){if(this.pageObj.fly){return;}
for(var i=0;i<this.totalFields.length;i++){if(this.totalFields[i].type=="TOTAL"){this.calcTotalField(this.totalFields[i].fName,this.totalFields[i].format);}else if(this.totalFields[i].type=="COUNT"){this.calcCountField(this.totalFields[i].fName,this.totalFields[i].format);}else if(this.totalFields[i].type=="AVERAGE"){this.calcAverageField(this.totalFields[i].fName,this.totalFields[i].format);}};var totalsTr=$('tr[rowid=totals]',this.pageObj.gridElem);if($(totalsTr).css('display')=='none'){$(totalsTr).css('display','');}},initForm:function(row){if(row.basicForm){row.basicForm.fieldControls=Runner.controls.ControlManager.getAt(this.tName,row.id);row.basicForm.id=row.id;row.basicForm.fields=this.fNames;}else{var inlineObj=this;var baseParams={a:'added',editType:'inline',id:row.id};row.basicForm=new Runner.form.BasicForm({fields:this.fNames,fieldControls:Runner.controls.ControlManager.getAt(this.tName,row.id),isFileUpload:this.isUseFileUpload,standardSubmit:false,submitUrl:this.submitUrl,method:'POST',id:row.id,baseParams:Runner.apply(this.baseParams,baseParams),successSubmit:{fn:function(respObj,formObj,fieldControls){if(!respObj.success){if(respObj.fatalError)
formObj.clearForm();this.fireEvent("submitFailed",respObj,this,formObj,fieldControls);inlineObj.makeError(respObj.message,row);}else{this.afterSubmit(row,respObj);}},scope:this},submitFailed:{fn:function(respObj,formObj,fieldControls){if(respObj.success===false){this.makeError(respObj.message,row);}else{this.makeError(respObj,row);}
this.fireEvent("submitFailed",{},this,formObj,fieldControls);},scope:this},beforeSubmit:{fn:function(formObj){return this.fireEvent("beforeSubmit",row,this,formObj);},scope:this},validationFailed:{fn:function(formObj,fieldControls){this.fireEvent("validationFailed",formObj,fieldControls);},scope:this}});}},cancelAll:function(){for(var i=0;i<this.rows.length;i++){if(!this.rows[i].submitted){if(this.rows[i].isAdd){Runner.util.inlineEditing.InlineAdd.prototype.cancelButtonHn.call(this,this.rows[i]);i--;}else{this.pageObj.inlineEdit.cancelButtonHn(this.rows[i]);}}
if(this.pageObj.inlineEdit.isUseLocking){this.pageObj.inlineEdit.locking.UnlockRecordInline(this.pageObj.inlineEdit.getKeysForLocking(this.rows[i]));}}
this.toggleMassRecButt();},submit:function(row){this.initForm(row);row.basicForm.submit();},saveAll:function(){var allVals=[],allKeys=[],allRowIds=[];for(var i=0;i<this.rows.length;i++){allVals.push(this.rows[i].data);allKeys.push(this.rows[i].keys);allRowIds.push(this.rows[i].id);if(this.rows[i].submitted===false){return false;}}
this.fireEvent('rowsEdited',allVals,this.fNames,allKeys,allRowIds);return true;},cancelButtonHn:function(){$('div.shiny_box').hide();},getControls:function(row,hideRevertButt,hideSaveButt){var inlineObject=this;var reqParams={rndval:Math.random(),editType:"inline",id:row.id,mainMPageType:Runner.pages.PageSettings.getTableData(this.tName,"mainMPageType")||"",isNeedSettings:!Runner.pages.PageSettings.checkSettings(this.tName)||this.loadSettings,table:Runner.pages.PageSettings.getShortTName(this.lookupTable),field:Runner.goodFieldName(this.lookupField),category:this.categoryValue};this.fireEvent('beforeRequestControls',this,row,reqParams);if(row.keys){var i=0;for(var key in row.keys){i++;reqParams['editid'+i]=escape(row.keys[key]);}}
$.getJSON(this.ajaxRequestUrl,reqParams,function(ctrlsJSON){if(ctrlsJSON.success||ctrlsJSON.success!==false){if(inlineObject.loadSettings&&ctrlsJSON.settings){Runner.pages.PageSettings.addSettings(inlineObject.tName,ctrlsJSON.settings,false);}
inlineObject.makeRowEditable(row,ctrlsJSON);}else{inlineObject.makeError(ctrlsJSON.message,row);}
if(inlineObject.isUseLocking){inlineObject.initLocking(row,ctrlsJSON);}
inlineObject.getEditBlock(row,hideRevertButt,hideSaveButt);inlineObject.fireEvent('afterInit',inlineObject.pageObj,row.id);});},initLocking:function(row,ctrlsJSON){if(this.pageType!=Runner.pages.constants.PAGE_EDIT)
return;this.locking=new Runner.Locking({tName:this.tName,pageId:this.id,pageType:this.pageType});var enableCtrls=ctrlsJSON.enableCtrls;if(enableCtrls==undefined){enableCtrls=ctrlsJSON.settings['tableSettings'][this.tName]['enableCtrls'];}
var confirmTime=ctrlsJSON.confirmTime;if(confirmTime==undefined){confirmTime=ctrlsJSON.settings['tableSettings'][this.tName]['confirmTime'];}
if(enableCtrls){var sKeys=this.getKeysForLocking(row),inlineObj=this;window['timeid'+this.id]=setInterval(function(){inlineObj.locking.ConfirmLock(sKeys);},confirmTime*1000);}},makeRowEditable:function(row,ctrlsJSON){for(var i=0;i<this.fNames.length;i++){$('#edit'+row.id+'_'+Runner.goodFieldName(this.fNames[i])).html(ctrlsJSON['html'][this.fNames[i]]);}
var ctrlsMap=ctrlsJSON.controlsMap[this.tName][this.pageType][row.id].controls,ctrlsArr=[];for(var i=0;i<ctrlsMap.length;i++){if(!this.fNames.isInArray(ctrlsMap[i].fieldName)){continue;}
ctrlsMap[i].table=this.tName;ctrlsArr.push(Runner.controls.ControlFabric(ctrlsMap[i]));}
for(var i=0;i<ctrlsArr.length;i++){if(!ctrlsArr[i].isLookupWizard){continue;}
if(ctrlsArr[i].parentFieldName&&ctrlsArr[i].skipDependencies!==true){var parentCtrl=Runner.controls.ControlManager.getAt(this.tName,row.id,ctrlsArr[i].parentFieldName);ctrlsArr[i].setParentCtrl(parentCtrl);if(parentCtrl&&parentCtrl.isLookupWizard){parentCtrl.addDependentCtrls([ctrlsArr[i]]);}}}
Runner.pages.RunnerPage.prototype.initToolTips.call(this.pageObj,ctrlsJSON.controlsMap[this.tName][this.pageType][row.id].toolTips,this.tName);this.fireEvent('createControls',row,ctrlsArr);var showFirstFocus=true;if(this.pageObj.pageMode=="listdetails"){if(Runner.pages.PageManager.getAt(this.pageObj.masterTName,this.pageObj.parId).pageType=="add"){showFirstFocus=false;}}
if(showFirstFocus){Runner.pages.RunnerPage.prototype.setFirstFocus.call(this.pageObj,row.id);}},getSaveLink:function(row,hideSaveButt){if(row.saveLink&&row.saveLink.length&&hideSaveButt!==true){row.saveLink.show();return row.saveLink;}else if(hideSaveButt===true){return false;}
var link=document.createElement('A');$(link).attr('title',Runner.lang.constants.TEXT_SAVE).addClass('saveEditing').attr('href','').attr('id','saveLink'+row.id);if(hideSaveButt===true){$(link).css('display','none');}
var imgButt=document.createElement('IMG');$(imgButt).attr('src',"images/ok.gif").attr('border','0').appendTo(link);$(imgButt).bind("click",{inlineObj:this,row:row},function(e){Runner.Event.prototype.stopEvent(e);var row=e.data.row,inlineObj=e.data.inlineObj;$('div.shiny_box').hide();inlineObj.submit(row);inlineObj.toggleMassRecButt();inlineObj.resetSelectAll();});return row.saveLink=$(link);},getCancelLink:function(row,hideRevertButt){if(row.cancelLink&&row.cancelLink.length&&hideRevertButt!==true){row.cancelLink.show();return row.cancelLink;}else if(hideRevertButt===true){return false;}
var link=document.createElement('A');$(link).attr('title',Runner.lang.constants.TEXT_CANCEL).addClass('revertEditing').attr('href','').attr('id','revertLink'+row.id);if(hideRevertButt===true){$(link).css('display','none');}
var imgButt=document.createElement('IMG');$(imgButt).attr('src',"images/cancel.gif").attr('border','0').appendTo(link).bind("click",{inlineObj:this,row:row},function(e){Runner.Event.prototype.stopEvent(e);var inlineObj=e.data.inlineObj;inlineObj.cancelButtonHn(e.data.row);inlineObj.toggleMassRecButt();inlineObj.resetSelectAll();if(inlineObj.isUseLocking){inlineObj.locking.UnlockRecordInline(inlineObj.getKeysForLocking(row));}
if(inlineObj.isUseIbox){init_ibox();}});return row.cancelLink=$(link);},getEditBlock:function(row,hideRevertButt,hideSaveButt){if(!row.saveLink||!row.saveLink.length||!row.cancelLink||!row.cancelLink.length){if(row.iEditLink.length){row.iEditLink.after(this.getCancelLink(row,hideRevertButt)).after(this.getSaveLink(row,hideSaveButt));}else{var span;for(var i=0;i<this.fNames.length;i++){span=$('#edit'+row.id+'_'+Runner.goodFieldName(this.fNames[i]));if(span.length){span.prepend(this.getCancelLink(row,hideRevertButt)).prepend(this.getSaveLink(row,hideSaveButt));break;}}}}else{this.getCancelLink(row,hideRevertButt);this.getSaveLink(row,hideSaveButt);}},getKeysForLocking:function(row){var sKeys="";for(var key in row.keys){sKeys+=row.keys[key]+"&";}
sKeys=sKeys.substring(0,sKeys.length-1);return sKeys;},revertRow:function(row){Runner.controls.ControlManager.unregister(this.tName,row.id);this.fireEvent('revertRow',row);},removeRowData:function(row,ind){if(row.basicForm&&row.basicForm.destructor){row.basicForm.destructor();}
if(row.row){row.row.remove();}
return this.rows.splice(ind||this.getRowInd(row),1);},getRowInd:function(row){for(var i=0;i<this.rows.length;i++){if(this.rows[i].id===row.id){return i;}}
return-1;},getRowById:function(rowId){for(var i=0;i<this.rows.length;i++){if(this.rows[i].id===rowId){return this.rows[i];}}
return false;},makeError:function(msg,row){row.errorMess=msg;if(!row.errorDiv){var root=this.pageObj.gridElem;if(!root){return false;}
var span=$("span[id^=edit"+row.id+"_]:eq(0)",root);span.append("<div class=runner-error><a href=# id=\"error_"+row.id+"\" style=\"white-space:nowrap;\">"+Runner.lang.constants.TEXT_INLINE_ERROR+" >></a></div>");row.errorDiv=span.find("div");if(!this.errCont){$(document.body).append("<div class=\"runner-inline-error runner-error\"></div>");this.errCont=$("div.runner-inline-error").hide();}
var inlineObj=this;$("#error_"+row.id).bind("mouseover",function(e){inlineObj.errCont.html(row.errorMess);inlineObj.errCont.show();var errorPos=Runner.getPosition(this);errorPos.left+=errorPos.width;errorPos.top+=errorPos.height;inlineObj.errCont.css("top",errorPos.top+"px").show().css("left",errorPos.left+"px").css("z-index",100).css("position","absolute");});$("#error_"+row.id).bind("mouseout",function(e){inlineObj.errCont.hide();});}
this.errCont.html(msg);},afterSubmit:function(row,newData){this.fireEvent("beforeProcessNewRow",row,newData.vals,newData.fields,newData.keys);row.data=Runner.apply({},newData.vals);row.keys=newData.keys;row.rowVals=newData.rawVals;Runner.controls.ControlManager.unregister(this.tName,row.id);if(row.checkBox.length&&!newData.noKeys){var checkBoxVal="";for(var key in newData.keys){checkBoxVal+=newData.keys[key]+"&";}
checkBoxVal=checkBoxVal.substring(0,checkBoxVal.length-1);row.checkBox.val(checkBoxVal).show();row.checkBox[0].checked=false;this.changeLinksKeys(row);}
this.setValuesIntoSpans(row);if(newData.noKeys!==true){this.showRowButtons(row);}
row.submitted=true;row.isAdd=false;this.fireEvent('afterSubmit',newData.vals,newData.fields,newData.keys,row.id,newData);if(row.basicForm){setTimeout(function(){row.basicForm.destructor();row.basicForm=null;},0);}
if(this.rows.length==1){this.pageObj.hideBrick("message");}
if(this.isUseIbox){init_ibox();}},setValuesIntoSpans:function(row){this.fireEvent("beforeSetVals",row,this.fNames,row.data);for(var i=0;i<this.fNames.length;i++){if(typeof row.data[this.fNames[i]]=='undefined'){row.data[this.fNames[i]]="";}
var span=$('#edit'+row.id+'_'+Runner.goodFieldName(this.fNames[i]));$(span).html(row.data[this.fNames[i]]);for(var j=0;j<this.totalFields.length;j++){if(this.totalFields[j].fName==this.fNames[i]){if(row.rowVals&&row.rowVals[this.fNames[i]]){$(span).attr('val',row.rowVals[this.fNames[i]]);}else{$(span).attr('val',"");}
break;}}
if(Runner.pages.PageSettings.getFieldData(this.tName,this.fNames[i],'viewFormat')!=Runner.controls.constants.FORMAT_MAP){var images=$('#edit'+row.id+'_'+Runner.goodFieldName(this.fNames[i])).find('img'),imagesHref=$('#edit'+row.id+'_'+Runner.goodFieldName(this.fNames[i])).find('a'),href,src;for(var j=0;j<images.length;j++){src=$(images[j]).attr('src');href=$(imagesHref[j]).attr('href');if(src&&src.indexOf('?')!=-1){$(images[j]).attr('src',(src+"&rndVal="+Math.random()));}else{$(images[j]).attr('src',(src+"?rndVal="+Math.random()));}
if(href&&href.indexOf('?')!=-1){$(imagesHref[j]).attr('href',(href+"&rndVal="+Math.random()));}else{$(imagesHref[j]).attr('href',(href+"?rndVal="+Math.random()));}}}
if(row.data[this.fNames[i]].indexOf('<')!=-1){if($(row.data[this.fNames[i]]).attr('type')=="video/flash"){flowplayer($(row.data[this.fNames[i]]).attr('id'),"include/video/flowplayer-3.2.3.swf",{clip:{autoPlay:false,autoBuffering:false,url:escape($(row.data[this.fNames[i]]).attr("href"))}});}}
if($('#edit'+row.id+'_'+Runner.goodFieldName(this.fNames[i])).find('a[type="audio/mpeg"]').length){var audioLink=$('#edit'+row.id+'_'+Runner.goodFieldName(this.fNames[i])).find('a[type="audio/mpeg"]'),link="";var lastInd=document.location.href.lastIndexOf("/");var addHref=document.location.href.substr(0,lastInd+1);if(addHref.substr(7,9)=='localhost'){addHref=addHref.replace('localhost','127.0.0.1');}
link=audioLink.attr("href");if(link.substr(0,4)!="http"){audioLink.attr("href",(addHref+link));}else if(Runner.isIE&&link.substr(0,4)=="http"){link=link.replace('localhost','127.0.0.1');audioLink.attr("href",(link));}
YAHOO.MediaPlayer.addTracks($('#edit'+row.id+'_'+Runner.goodFieldName(this.fNames[i])).get(0),null,false);}}
return row.data;},getValuesFromSpan:function(row){row.data={};for(var i=0;i<this.fNames.length;i++){row.data[this.fNames[i]]=$('#edit'+row.id+'_'+Runner.goodFieldName(this.fNames[i])).html();}
return row.data;},getValueFromSpan:function(row,fName){if(row.rowVals&&row.rowVals[fName]){var val=row.rowVals[fName];}else{var val=$('#edit'+row.id+'_'+Runner.goodFieldName(fName)).attr('val');if(!val){val=row.data[fName];}}
return val;},initCopyLink:function(link,row){if(Runner.pages.PageSettings.getTableData(this.tName,"showAddInPopup")){var editObj=this;$(link).bind("click",function(e){var eventParams={tName:editObj.tName,pageType:Runner.pages.constants.PAGE_ADD,pageId:-1,destroyOnClose:true,parentPage:editObj,modal:true,keys:row.keys,keyPref:"copyid",baseParams:{parId:editObj.id,table:editObj.tName,editType:Runner.pages.constants.ADD_POPUP},afterSave:{fn:function(respObj,formObj,fieldControls,page){if(respObj.success){this.addRowToGrid(respObj);}else{$('#message_block'+page.id+' div.message').html(respObj.message);return false;}},scope:editObj}};Runner.Event.prototype.stopEvent(e);Runner.pages.PageManager.openPage(eventParams);});}
return link;},changeLinksKeys:function(row){var newUrl=Runner.pages.getUrl(this.tName,Runner.pages.constants.PAGE_VIEW,row.keys,'editid')
$(row.viewLink).attr('href',newUrl);var newUrl=Runner.pages.getUrl(this.tName,Runner.pages.constants.PAGE_EDIT,row.keys,'editid')
$(row.editLink).attr('href',newUrl);var newUrl=Runner.pages.getUrl(this.tName,Runner.pages.constants.PAGE_ADD,row.keys,'copyid')
$(row.copyLink).attr('href',newUrl);},initViewLink:function(link,row){if(Runner.pages.PageSettings.getTableData(this.tName,"showViewInPopup")&&!Runner.isMobile){var inlineObj=this;$(link).bind("click",function(e){Runner.Event.prototype.stopEvent(e);var eventParams={tName:inlineObj.tName,pageType:Runner.pages.constants.PAGE_VIEW,pageId:-1,destroyOnClose:true,keys:row.keys,modal:true,baseParams:{parId:inlineObj.id,table:escape(inlineObj.tName)}};Runner.pages.PageManager.openPage(eventParams);});}
return link;},initEditLink:function(link,row){if(Runner.pages.PageSettings.getTableData(this.tName,"showEditInPopup")&&!Runner.isMobile){var inlineObj=this;$(link).bind("click",function(e){Runner.Event.prototype.stopEvent(e);var eventParams={tName:inlineObj.tName,pageType:Runner.pages.constants.PAGE_EDIT,pageId:-1,destroyOnClose:true,keys:row.keys,modal:true,baseParams:{parId:inlineObj.id,rowId:row.id,table:escape(inlineObj.tName),editType:Runner.pages.constants.EDIT_POPUP},afterSave:{fn:function(respObj,formObj,fieldControls,editPageObj){if(respObj.success){this.afterSubmit(row,respObj);}else if(respObj.lockMessage){$('#system_div'+editPageObj.id).html(respObj.lockMessage).css('display','block');return false;}else{$('#message_block'+editPageObj.id+' div.message').html(respObj.message);$('div.bd').animate({scrollTop:0});return false;}},scope:inlineObj}};Runner.pages.PageManager.openPage(eventParams);});}
return link;},initInlineEditLink:function(link,row){var newUrl=Runner.pages.getUrl(this.tName,Runner.pages.constants.PAGE_EDIT,row.keys,'editid')
$(link).attr('href',newUrl);link.bind("click",{inlineObj:this,row:row},function(e){Runner.Event.prototype.stopEvent(e);var row=e.data.row,inlineObj=e.data.inlineObj;if(inlineObj.inlineEditObj){inlineObj.inlineEditObj.inlineEdit(row);}else{inlineObj.inlineEdit(row);}});return link;},toggleMassRecButt:function(){if(!this.isRowsEditing()){this.saveAllButt.hide().parent().hide();this.cancelAllButt.hide().parent().hide();this.massRecButtEditMode=false;}else{this.saveAllButt.show().parent().show();this.cancelAllButt.show().parent().show();this.massRecButtEditMode=true;}},isRowsEditing:function(){for(var i=0;i<this.rows.length;i++){if(this.rows[i].submitted!=undefined&&!this.rows[i].submitted){return true;}}
return false;},validate:function(){var ctrls,vRes=true;for(var i=0;i<this.rows.length;i++){ctrls=Runner.controls.ControlManager.getAt(this.tName,this.rows[i].id);for(var j=0;j<ctrls.length;j++){if(!ctrls[j].validate().result){vRes=false;}}}
return vRes;},addRowToGrid:function(data){var newAddRow=this.prepareRow(data.vals,true);this.getEditBlock(newAddRow);this.afterSubmit(newAddRow,data);},initRow:function(row){row.submitted=true;row.data={};row.saveLink=false;row.cancelLink=false;row.checkBox=$('#check'+this.id+'_'+row.id);row.copyLink=this.initCopyLink($('#copyLink'+row.id),row);row.iEditLink=this.initInlineEditLink($('#iEditLink'+row.id),row);row.editLink=this.initEditLink($('#editLink'+row.id),row);row.viewLink=this.initViewLink($('#viewLink'+row.id),row);},hideRowButtons:function(row){row.viewLink.hide();row.copyLink.hide();row.editLink.hide();row.iEditLink.hide();row.checkBox.hide();},showRowButtons:function(row){row.viewLink.show();row.copyLink.show();row.editLink.show();row.iEditLink.show();row.checkBox.show();if(row.saveLink){row.saveLink.hide();}
if(row.cancelLink){row.cancelLink.hide();}},prepareRow:function(vals,submitted){var grid=this.pageObj.gridElem;if(this.rows.length===0){grid.show();$("thead tr",grid).removeClass('runner-hiddenelem');$("tfoot tr",grid).removeClass('runner-hiddenelem');this.editAllButt.parent().show();this.saveAllButt.parent().show();this.cancelAllButt.parent().show();$("#print_selected"+this.id).parent().show();$("#export_selected"+this.id).parent().show();$("#delete_selected"+this.id).parent().show();}
var newAddRow={row:$(".gridRowAdd",grid).clone(true),id:Runner.genId(),data:vals,isAdd:true};var pageId=this.id;$("*",newAddRow.row).each(function(j){if(this.id=="editLink_add"+pageId){this.id="editLink"+newAddRow.id;$(this).hide();}else if(this.id=="copyLink_add"+pageId){this.id="copyLink"+newAddRow.id;$(this).hide();}else if(this.id=="check_add"+pageId){this.id="check"+pageId+"_"+newAddRow.id;$(this).hide();}else if(this.id=="viewLink_add"+pageId){this.id="viewLink"+newAddRow.id;$(this).hide();}else if(this.id=="inlineEdit_add"+pageId){this.id="iEditLink"+newAddRow.id;$(this).hide();}else if(this.id.substr(0,7)=="master_"&&this.id.substr(this.id.length-4-pageId.toString().length)=="_add"+pageId){this.id=this.id.substr(0,this.id.length-4-pageId.toString().length)+"_"+newAddRow.id;$(this).hide();}else if(this.id.substr(this.id.length-8-pageId.toString().length)=="_preview"+pageId){this.id=this.id.substr(0,this.id.length-pageId.toString().length)+newAddRow.id;var cntDet=$('span[id^=cntDet]',this);if($(cntDet).length){var cntDetId=$(cntDet).attr('id');cntDetId+=newAddRow.id;$(cntDet).attr('id',cntDetId);}
$(this).hide();}else if(this.id.substr(0,4+pageId.toString().length)=="add"+pageId+"_"){this.id="edit"+newAddRow.id+'_'+this.id.substr(4+pageId.toString().length);}});this.rows.push(newAddRow);newAddRow.row.removeClass('gridRowAdd runner-hiddenelem');newAddRow.row.attr("id",this.rowPref+newAddRow.id);newAddRow.row.insertAfter($(".gridRowAdd",grid));if(!newAddRow.row.next().hasClass("interlaced")){newAddRow.row.addClass("interlaced");}
newAddRow.row.show();this.initRow(newAddRow);newAddRow.submitted=false||submitted;return newAddRow;},checkRowMasterKeys:function(row,newMasterKeys){if(typeof this.pageObj.dpObjs!='undefined')
$.each(this.pageObj.dpObjs,function(ind,obj){var isKeysChanged=false;if(row.masterKeys==undefined){row.masterKeys=newMasterKeys;isKeysChanged=true;}else
$.each(newMasterKeys[obj.tName],function(kInd,kObj){if(newMasterKeys[obj.tName][kInd]!=row.masterKeys[obj.tName][kInd]){isKeysChanged=true;return false;}});if(isKeysChanged){obj.getChildRecNum(newMasterKeys[obj.tName],row.id);row.masterKeys[obj.tName]=newMasterKeys[obj.tName];if($('#master_'+obj.shortTName+'_'+row.id).length>0)
$('#master_'+obj.shortTName+'_'+row.id).attr('href',Runner.pages.getUrl(obj.tName,Runner.pages.constants.PAGE_LIST,row.masterKeys[obj.tName],'masterkey'));obj.closeDetailsById(row.id);}
else
obj.getChildRecNum(row.masterKeys[obj.tName]);});}});Runner.util.inlineEditing.InlineAdd=Runner.extend(Runner.util.inlineEditing.InlineEditor,{constructor:function(cfg){this.pageType='add';Runner.util.inlineEditing.InlineAdd.superclass.constructor.call(this,cfg);this.pageType=Runner.pages.constants.PAGE_ADD;this.ajaxRequestUrl=this.shortTName+"_"+Runner.pages.constants.PAGE_ADD+".php";this.submitUrl=this.shortTName+'_'+Runner.pages.constants.PAGE_ADD+".php";this.submitUrl+="?ferror=1&inline=1&";this.addEvents("beforeSetVals");},init:function(){Runner.util.inlineEditing.InlineAdd.superclass.init.call(this);},initAddButton:function(){$("#inlineAdd"+this.id).bind("click",{inlineAddObj:this},function(e){Runner.Event.prototype.stopEvent(e);e.data.inlineAddObj.inlineAdd();});},initButtons:function(){Runner.util.inlineEditing.InlineAdd.superclass.initButtons.call(this);this.initAddButton();},cancelButtonHn:function(row){this.removeRowData(row);Runner.util.inlineEditing.InlineAdd.superclass.cancelButtonHn.call(this);Runner.controls.ControlManager.unregister(this.tName,row.id);},revertRow:function(row){Runner.util.inlineEditing.InlineAdd.superclass.revertRow.call(this,row);this.removeRowData(row);},saveAll:function(){if(Runner.util.inlineEditing.InlineAdd.superclass.saveAll.call(this)){return true;}
for(var i=0;i<this.rows.length;i++){if(!this.rows[i].submitted&&this.rows[i].isAdd){this.submit(this.rows[i]);}}},afterSubmit:function(row,newData){Runner.util.inlineEditing.InlineAdd.superclass.afterSubmit.call(this,row,newData);if(row.cancelLink){row.cancelLink.remove();row.cancelLink=null;}
if(row.saveLink){row.saveLink.remove();row.saveLink=null;}
if(newData.detKeys!=undefined){this.checkRowMasterKeys(row,newData.detKeys);}
var allVals=[],allKeys=[],allRowIds=[];for(var i=0;i<this.rows.length;i++){allVals.push(this.rows[i].data);allKeys.push(this.rows[i].keys);allRowIds.push(this.rows[i].id);if(this.rows[i].submitted===false){return;}}
this.fireEvent('rowsEdited',allVals,newData.fields,allKeys,allRowIds);},toggleMassRecButt:function(){Runner.util.inlineEditing.InlineAdd.superclass.toggleMassRecButt.call(this);if(!this.isRowsEditing()){if(this.massRecButtEditMode){this.editAllButt.parent().hide();}else{this.editAllButt.parent().show();}}},inlineAdd:function(hideRevertButt,hideSaveButt){if(typeof hideRevertButt=="undefined"){hideRevertButt=this.hideRevertButt;}
if(typeof hideSaveButt=="undefined"){hideSaveButt=this.hideSaveButt;}
if(this.rows.length==0){var nF=$("span[name=notfound_message"+this.id+"]");var mB=$("#message_block"+this.id);if($(mB,nF).length){$(mB).empty();}else{this.pageObj.hideBrick("message");}}
var newAddRow=this.prepareRow({},false);this.toggleMassRecButt();this.hideRowButtons(newAddRow);this.getControls(newAddRow,hideRevertButt,hideSaveButt);}});Runner.util.inlineEditing.InlineEdit=Runner.extend(Runner.util.inlineEditing.InlineEditor,{constructor:function(cfg){Runner.util.inlineEditing.InlineEdit.superclass.constructor.call(this,cfg);this.ajaxRequestUrl=this.shortTName+"_"+Runner.pages.constants.PAGE_EDIT+".php";this.pageType=Runner.pages.constants.PAGE_EDIT;this.submitUrl=this.shortTName+'_'+Runner.pages.constants.PAGE_EDIT+".php";this.addEvents("beforeEditRow");},init:function(){Runner.util.inlineEditing.InlineEdit.superclass.init.call(this);this.initRows();},initRows:function(){for(var i=0;i<this.rows.length;i++){this.initRow(this.rows[i]);}
if(this.isUseLocking){this.showErrorForLockingRecords();}},initInlineRowEditors:function(){for(var i=0;i<this.rows.length;i++){this.getInlineButtBlock(this.rows[i]);}},initButtons:function(){Runner.util.inlineEditing.InlineEdit.superclass.initButtons.call(this);this.initEditAll();},initEditAll:function(){var inlineObj=this;this.editAllButt.unbind("click").bind("click",function(e){Runner.Event.prototype.stopEvent(e);var selBoxesArr=new Array(),isEditOwn=Runner.pages.PageSettings.getTableData(inlineObj.tName,"isEditOwn");$('input[type=checkbox][id^=check'+inlineObj.id+'_]').each(function(){if($(this).prop("checked")){if(isEditOwn&&!$('#iEditLink'+$(this).attr('id').substr($(this).attr('id').lastIndexOf('_')+1)).length){$(this).prop("checked",false);return true;}
selBoxesArr.push($(this));}});var row,isEdit=false,checkBox,selBoxes=selBoxesArr;for(var i=0;i<selBoxes.length;i++){for(var j=0;j<inlineObj.rows.length;j++){checkBox=inlineObj.rows[j].checkBox;if($(checkBox[0]).attr('id')==$(selBoxes[i]).attr('id')){row=inlineObj.rows[j];inlineObj.inlineEdit(row);if(!inlineObj.rows[i].submitted&&!inlineObj.rows[i].isAdd){isEdit=true;}}}}
if(isEdit){inlineObj.toggleMassRecButt();}});},reInit:function(gridRows){Runner.util.inlineEditing.InlineEdit.superclass.reInit.call(this,gridRows);this.initRows();},inlineEdit:function(row,hideRevertButt,hideSaveButt){if(typeof hideRevertButt=="undefined"){hideRevertButt=this.hideRevertButt;}
if(typeof hideSaveButt=="undefined"){hideSaveButt=this.hideSaveButt;}
this.fireEvent("beforeEditRow",row);row.submitted=false;this.toggleMassRecButt();this.getValuesFromSpan(row);this.hideRowButtons(row);this.getControls(row,hideRevertButt,hideSaveButt);},editRecByInd:function(ind){var row=false;for(var i=0;i<this.rows.length;i++){if(this.rows[i].id==ind){row=this.rows[i];break;}}
if(row){this.inlineEdit(row);return true;}
return false;},editAllRecs:function(){for(var i=0;i<this.rows.length;i++){this.inlineEdit(this.rows[i]);}},getRecsId:function(){var recsId={};for(var i=0;i<this.rows.length;i++){recsId[i+1]=this.rows[i].id;}
return recsId;},revertRow:function(row){row.submitted=true;row.errorDiv=false;if(row.checkBox.length){row.checkBox[0].checked=false;}
Runner.util.inlineEditing.InlineEdit.superclass.revertRow.call(this,row);this.showRowButtons(row);this.setValuesIntoSpans(row);row.checkBox.show();},initForm:function(row){Runner.util.inlineEditing.InlineEdit.superclass.initForm.call(this,row);row.basicForm.baseParams={a:'edited',editType:'inline',id:row.id};row.basicForm.submitUrl+="?ferror=1";var i=0;for(var key in row.keys){i++;row.basicForm.baseParams["editid"+i]=row.keys[key];}},cancelButtonHn:function(row){this.revertRow(row);Runner.util.inlineEditing.InlineEdit.superclass.cancelButtonHn.call(this);},toggleMassRecButt:function(){Runner.util.inlineEditing.InlineEdit.superclass.toggleMassRecButt.call(this);if(this.massRecButtEditMode){this.editAllButt.parent().hide();}else{this.editAllButt.parent().show();}},afterSubmit:function(row,newData){Runner.util.inlineEditing.InlineEdit.superclass.afterSubmit.call(this,row,newData);if(Runner.pages.PageSettings.getTableData(this.tName,"detailTables")!=undefined){this.checkRowMasterKeys(row,newData.detKeys);}
var allVals=[],allKeys=[],allRowIds=[];for(var i=0;i<this.rows.length;i++){allVals.push(this.rows[i].data);allKeys.push(this.rows[i].keys);allRowIds.push(this.rows[i].id);if(this.rows[i].submitted===false){return;}}
this.fireEvent('rowsEdited',allVals,newData.fields,allKeys,allRowIds);},saveAll:function(){if(Runner.util.inlineEditing.InlineEdit.superclass.saveAll.call(this)){return true;}
for(var i=0;i<this.rows.length;i++){if(!this.rows[i].submitted&&!this.rows[i].isAdd){this.submit(this.rows[i]);}}},showErrorForLockingRecords:function(){var lockingRecords=Runner.pages.PageSettings.getTableData(this.tName,'lockRecIds');if(!lockingRecords.length){return;}
for(var i=0,l=lockingRecords.length;i<l;i++){this.makeError("Record can't be delete. It's editing by another user.",this.getRowById(lockingRecords[i]));$('input[id=check'+this.id+'_'+lockingRecords[i]+']',this.pageObj.gridElem).prop('checked',true);}}});Runner.namespace('Runner.pages');Runner.pages.constants={PAGE_LIST:"list",PAGE_ADD:"add",PAGE_INLINE_ADD:"inline_add",PAGE_EDIT:"edit",PAGE_INLINE_EDIT:"inline_edit",PAGE_VIEW:"view",PAGE_SEARCH:"search",PAGE_REPORT:"report",PAGE_CHART:"chart",PAGE_PRINT:"print",PAGE_EXPORT:"export",PAGE_IMPORT:"import",PAGE_ADMIN_MEMBERS:"admin_members",PAGE_ADMIN_RIGHTS:"admin_rights",PAGE_MASTER_INFO_LIST:"masterlist",PAGE_MASTER_INFO_PRINT:"masterprint",PAGE_REGISTER:"register",PAGE_MENU:"menu",PAGE_REMIND:"remind",PAGE_CHANGEPASS:"changepass",PAGE_LOGIN:"login",LIST_SIMPLE:0,LIST_LOOKUP:1,LIST_DETAILS:3,LIST_AJAX:4,RIGHTS_PAGE:5,MEMBERS_PAGE:6,ADD_SIMPLE:0,ADD_INLINE:1,ADD_ONTHEFLY:2,ADD_MASTER:3,ADD_POPUP:4,EDIT_SIMPLE:0,EDIT_INLINE:1,EDIT_ONTHEFLY:2,EDIT_POPUP:3,MODE_AJAX:"ajax",MODE_SIMPLE:"",MODE_LOOKUP:"lookup",MODE_LIST_DETAILS:"listdetails",DP_POPUP:0,DP_INLINE:1,DP_NONE:2};Runner.pages.Defaults=function(){this.globalSettings={debugMode:false,isMobile:false,s508:false};this.tableSettings={ajaxSuggest:true,confirmTime:250,copy:false,defaultMembership:[],defaultRights:[],detailTables:{},dpParams:[],enableCtrls:true,events:{},firstTime:0,fieldSettings:{},hasEvents:false,isEditOwn:false,isInlineAdd:false,isInlineEdit:false,isMobileIOS:false,isShowDetails:false,isUseAudio:false,isUseButtons:false,isUseCK:false,isUseDP:false,isUseHighlite:false,isUseIbox:false,isUsePopUp:false,isUseResize:false,isUseToolTips:false,isUseVideo:false,isVertLayout:false,keys:{},listFields:[],listIcons:false,locking:false,lockRecIds:[],mainMPageType:"",masterPageType:"",masterTable:"",maxPages:1,nextKeys:{},pageCSS:"",pageLayout:"",pageMode:0,pageNumber:0,pageSkinStyle:"",passFieldName:'password',permissions:{},prevKeys:{},recsPerRowList:1,rightsGroups:[],rightsTables:[],shortTNames:[],showAddInPopup:false,showEditInPopup:false,showRows:false,showViewInPopup:false,sKeys:"",strCaption:"",strKey:[],totalFields:[],usersList:[],view:false};this.fieldSettings={autoCompleteFieldsAdd:[],autoCompleteFieldsEdit:[],categoryField:false,dateEditType:Runner.controls.constants.EDIT_DATE_SIMPLE,depLookups:[],dispField:"",editFormat:Runner.controls.constants.EDIT_FORMAT_NONE,freeInput:false,initialYear:100,isDisabled:false,isHidden:false,isUseTimeStamp:false,lastYear:10,lcType:Runner.controls.constants.LCT_DROPDOWN,linkField:"",lookupTable:"",nHeight:200,nWidth:100,RTEType:"",selectSize:1,showTime:false,strName:"",timePick:{},validation:null,viewFormat:Runner.controls.constants.FORMAT_NONE};var self=this,SOURCE_GLOBAL='g',SOURCE_TABLE='t',SOURCE_FIELD='f',getSettings=function(source,settingName){var sourceName=source==SOURCE_GLOBAL?'globalSettings':source==SOURCE_TABLE?'tableSettings':'fieldSettings';if(self[sourceName][settingName]!=undefined)
return self[sourceName][settingName];else
return null;};this.getGlobalSettings=function(settingName){return getSettings(SOURCE_GLOBAL,settingName);};this.getTableSettings=function(settingName){return getSettings(SOURCE_TABLE,settingName);};this.getFieldSettings=function(settingName){return getSettings(SOURCE_FIELD,settingName);};this.getValidationSettings=function(){return{regExp:null,validationArr:[]};};};Runner.pages.Defaults=new Runner.pages.Defaults();Runner.pages.PageManager=function(){var tables={},beforeUnloadPool=[];if(window.onunload){beforeUnloadPool.push(window.onBeforeUnload,window,[]);}
window.onunload=function(){window.Runner.pages.PageManager.callUnload();}
return{register:function(pageController){if(!pageController){return false;}
var pageTable=pageController.tName;if(!tables[pageTable]){tables[pageTable]={};}
var pageId=pageController.pageId;tables[pageTable][pageId]=pageController;return true;},getAt:function(tName,pageId){if(!tables[tName]){return false;}
if(!tables[tName][pageId]){return false;}
return tables[tName][pageId];},getById:function(pageId){if(typeof pageId=="undefined"){return false;}
for(var tName in tables){if(typeof tables[tName][pageId]!="undefined"){return tables[tName][pageId];}}
return false;},unregister:function(tName,pageId){if(!tables[tName]){return false;}
if(!pageId){for(var id in tables[tName]){this.unregister(tName,id);}
delete tables[tName];}else{if(tables[tName][pageId].destructor){tables[tName][pageId].destructor();}
Runner.pages.PageControlsMap.removeMap(tName,tables[tName][pageId].pageType,pageId);delete tables[tName][pageId];}
return true;},initPages:function(){var controlsMap=Runner.pages.PageControlsMap.getMap(),cfg;for(var tName in controlsMap){for(var pageType in controlsMap[tName]){for(var pageId in controlsMap[tName][pageType]){cfg={tName:tName,pageType:pageType,pageId:pageId,controlsMap:controlsMap[tName][pageType][pageId],pageMode:Runner.pages.PageSettings.getTableData(tName,"pageMode")};this.initPage(cfg);}}}
this.initPages=Runner.emptyFn;Runner.stopLoading();},initPage:function(cfg){var page=Runner.pages.PageFabric(cfg);if(!page.fly){page.init();}else{page.initFlyPage();}
return page;},openPage:function(pageParams){if(this.getAt(pageParams.tName,pageParams.pageId)){var page=this.getAt(pageParams.tName,pageParams.pageId);page.show();return pageParams.pageId;}
pageParams.pageId=Runner.genId();var reqParams={rndval:Math.random(),id:pageParams.pageId,onFly:1,isNeedSettings:true};Runner.apply(reqParams,pageParams.baseParams);var pageManager=this,ajaxRequestUrl=Runner.pages.getUrl(pageParams.tName,pageParams.pageType,pageParams.keys,pageParams.keyPref);$.getJSON(ajaxRequestUrl,reqParams,function(ctrlsJSON){Runner.pages.PageSettings.addSettings('',ctrlsJSON.settings);Runner.pages.PageControlsMap.addMap(pageParams.tName,pageParams.pageType,pageParams.pageId,ctrlsJSON.controlsMap);var cfg={tName:pageParams.tName,pageType:pageParams.pageType,editType:pageParams.editType||pageParams.baseParams.editType,pageId:pageParams.pageId,controlsMap:ctrlsJSON.controlsMap[pageParams.tName][pageParams.pageType][pageParams.pageId],headerCont:ctrlsJSON.headerCont||"<span>&nbsp;</span>",bodyCont:ctrlsJSON.html?("<div class=\"runner-pagewrapper "
+Runner.pages.PageSettings.getTableData(pageParams.tName,"pageSkinStyle")+"\">"+ctrlsJSON.html+"</div>"):"<span>&nbsp;</span>",fotterCont:ctrlsJSON.fotterCont||"<span>&nbsp;</span>",fly:true,submitUrl:ajaxRequestUrl};Runner.apply(cfg,pageParams);pageManager.initPage(cfg);Runner.setIdCounter(ctrlsJSON.idStartFrom);});return reqParams.id},addUnloadHn:function(hn,scope,args){if(typeof hn!='function'){return false;}
beforeUnloadPool.push({fn:hn,scope:scope||window,args:args||[]});return true;},callUnload:function(){var scope,args;for(var i=0;i<beforeUnloadPool.length;i++){scope=beforeUnloadPool[i].scope;args=beforeUnloadPool[i].args;beforeUnloadPool[i].fn.apply(scope,args);}
for(var tName in tables){this.unregister(tName);}}}}();Runner.namespace('Runner.pages');Runner.pages.PageControlsMap=function(){window.controlsMap=window.controlsMap||{};if(window.console&&!$.browser.msie)
console.log(controlsMap,'controlsMap');return{addMap:function(tName,pageType,pageId,map){if(!tName||!pageType||typeof pageId=='undefined'){return false;}
if(!controlsMap[tName]){controlsMap[tName]={};}
if(!controlsMap[tName][pageType]){controlsMap[tName][pageType]={};}
controlsMap[tName][pageType][pageId]=map[tName][pageType][pageId];},getMap:function(tName,pageType,pageId){if(!tName){return controlsMap;}
if(!pageType){return controlsMap[tName];}
if(typeof pageId=='undefined'){return controlsMap[tName][pageType];}
return controlsMap[tName][pageType][pageId];},removeMap:function(tName,pageType,pageId){if(!tName||!pageType||typeof pageId=="undefined"){return false;}
if(!controlsMap[tName]){return false;}
if(!controlsMap[tName][pageType]){return false;}
delete controlsMap[tName][pageType][pageId];return true;}};}();Runner.pages.PageSettings=function(){window.settings=window.settings||{tables:{}};if(window.console&&!$.browser.msie)
console.log(window.settings,'window.settings');Runner.setIdCounter(settings['global'].idStartFrom);Runner.debugMode=settings['global'].debugMode;Runner.charSet=settings['global'].charSet;Runner.isMobile=settings['global'].isMobile;this.getSettings=function(tName,fName){if(!tName){return settings;}
if(!fName){return settings.tableSettings[tName];}
return settings.tableSettings[tName]['fieldSettings'][fName];};};Runner.pages.PageSettings=Runner.extend(Runner.pages.PageSettings,{checkSettings:function(tName,fName){var settings=this.getSettings(tName,fName);if(settings){return true;}else{return false;}},loadSettings:function(tName,pageType){},addPageEvent:function(tName,pType,evName,evHn){if(!settings.tableSettings[tName]){settings.tableSettings[tName]={};}
if(!settings.tableSettings[tName]["events"]){settings.tableSettings[tName]["events"]={};}
if(!settings.tableSettings[tName]["events"][pType]){settings.tableSettings[tName]["events"][pType]={};}
if(!settings.tableSettings[tName]["events"][pType][evName]){settings.tableSettings[tName]["events"][pType][evName]=[];}
settings.tableSettings[tName]["events"][pType][evName].push({hn:evHn});},addSettings:function(tName,addSettings,forceRewrite){if(!addSettings){return false;}
var settings=this.getSettings();Runner.setIdCounter(settings['global'].idStartFrom);Runner.apply(settings.global.shortTNames,addSettings.global.shortTNames);if(forceRewrite===true){settings.tableSettings[tName]=addSettings.tableSettings[tName];return;}
if(!tName){Runner.deepCopy(settings.tableSettings,addSettings.tableSettings);}else{settings.tableSettings[tName]=settings.tableSettings[tName]||{};Runner.deepCopy(settings.tableSettings[tName],addSettings.tableSettings[tName]);}
return true;},getViewType:function(tName,fName){if(typeof settings.tableSettings[tName]["fieldSettings"][fName]!='undefined'&&typeof settings.tableSettings[tName]["fieldSettings"][fName]["viewFormat"]!='undefined'){return settings.tableSettings[tName]["fieldSettings"][fName]["viewFormat"];}else{return Runner.pages.Defaults.getFieldSettings('viewFormat');}},getEditFormat:function(tName,fName){if(typeof settings.tableSettings[tName]["fieldSettings"][fName]!='undefined'&&typeof settings.tableSettings[tName]["fieldSettings"][fName]["editFormat"]!='undefined'){return settings.tableSettings[tName]["fieldSettings"][fName]["editFormat"];}else{return Runner.pages.Defaults.getFieldSettings('editFormat');}},getShortTName:function(tName){if(!tName){return"";}
return settings.global.shortTNames[tName]||settings.tableSettings[tName].shortTName||"";},getValidations:function(tName,fName){if(typeof settings.tableSettings[tName]["fieldSettings"][fName]!='undefined'&&typeof settings.tableSettings[tName]["fieldSettings"][fName]["validation"]!='undefined'){return settings.tableSettings[tName]["fieldSettings"][fName]["validation"];}else{return Runner.pages.Defaults.getValidationSettings();}},getDisabledStatus:function(tName,fName){if(typeof settings.tableSettings[tName]["fieldSettings"][fName]!='undefined'&&typeof settings.tableSettings[tName]["fieldSettings"][fName]["isDisabled"]!='undefined'){return settings.tableSettings[tName]["fieldSettings"][fName]["isDisabled"];}else{return Runner.pages.Defaults.getFieldSettings('isDisabled');}},getHiddenStatus:function(tName,fName){if(typeof settings.tableSettings[tName]["fieldSettings"][fName]!='undefined'&&typeof settings.tableSettings[tName]["fieldSettings"][fName]["isHidden"]!='undefined'){return settings.tableSettings[tName]["fieldSettings"][fName]["isHidden"];}else{return Runner.pages.Defaults.getFieldSettings('isHidden');}},getCategoryField:function(tName,fName){if(typeof settings.tableSettings[tName]["fieldSettings"][fName]!='undefined'&&typeof settings.tableSettings[tName]["fieldSettings"][fName]["categoryField"]!='undefined'){return settings.tableSettings[tName]["fieldSettings"][fName]["categoryField"];}else{return Runner.pages.Defaults.getFieldSettings('categoryField');}},getLookupTable:function(tName,fName){if(typeof settings.tableSettings[tName]["fieldSettings"][fName]!='undefined'&&typeof settings.tableSettings[tName]["fieldSettings"][fName]["lookupTable"]!='undefined'){return settings.tableSettings[tName]["fieldSettings"][fName]["lookupTable"];}else{return"";}},getLookupSize:function(tName,fName){if(typeof settings.tableSettings[tName]["fieldSettings"][fName]!='undefined'&&typeof settings.tableSettings[tName]["fieldSettings"][fName]["selectSize"]!='undefined'){return settings.tableSettings[tName]["fieldSettings"][fName]["selectSize"];}else{return Runner.pages.Defaults.getFieldSettings('selectSize');}},getLCT:function(tName,fName){if(typeof settings.tableSettings[tName]["fieldSettings"][fName]!='undefined'&&typeof settings.tableSettings[tName]["fieldSettings"][fName]["lcType"]!='undefined'){return settings.tableSettings[tName]["fieldSettings"][fName]["lcType"];}else{return Runner.pages.Defaults.getFieldSettings('lcType');}},getTableData:function(tName,key){if(typeof settings.tableSettings[tName]!='undefined'&&typeof settings.tableSettings[tName][key]!='undefined'){return this.returnData(settings.tableSettings[tName][key]);}else{return this.returnData(Runner.pages.Defaults.getTableSettings(key));}},getFieldData:function(tName,fName,key){if(typeof settings.tableSettings[tName]["fieldSettings"][fName]!='undefined'&&typeof settings.tableSettings[tName]["fieldSettings"][fName][key]!='undefined'){return this.returnData(settings.tableSettings[tName]["fieldSettings"][fName][key]);}else{return this.returnData(Runner.pages.Defaults.getFieldSettings(key));}},getRTECKDim:function(tName){if(typeof settings.tableSettings[tName]!='undefined'){var fieldSet=settings.tableSettings[tName]["fieldSettings"];for(var field in fieldSet){if(fieldSet[field].RTEType=='RTECK'){return{nWidth:fieldSet[field].nWidth,nHeight:fieldSet[field].nHeight};}}}
return false;},getGlobalData:function(key){if(settings['global'][key]!=undefined)
return this.returnData(settings['global'][key]);else
return this.returnData(Runner.pages.Defaults.getGlobalSettings(key));},returnData:function(data){if(Runner.isArray(data)){return data.slice(0);}else if(typeof data=="object"&&data!=null){var F=function(){};F.prototype=data;return new F();}else{return data;}}});Runner.pages.PageSettings=new Runner.pages.PageSettings();Runner.pages.PageFabric=function(baseCfg){var cfg={};Runner.apply(cfg,baseCfg);switch(cfg.pageType){case Runner.pages.constants.PAGE_LIST:if(Runner.isMobile){if(cfg.fly){return new Runner.pages.ListPageFly(cfg);}
else{return new Runner.pages.ListPageMobile(cfg);}}else{if(cfg.fly){return new Runner.pages.ListPageFly(cfg);}else if(cfg.pageMode==Runner.pages.constants.LIST_AJAX){return new Runner.pages.ListPageAjax(cfg);}else if(cfg.pageMode==Runner.pages.constants.MODE_LIST_DETAILS){return new Runner.pages.ListPageDP(cfg);}else if(cfg.pageMode==Runner.pages.constants.RIGHTS_PAGE){return new Runner.pages.RightsPage(cfg);}else if(cfg.pageMode==Runner.pages.constants.MEMBERS_PAGE){return new Runner.pages.MembersPage(cfg);}else{return new Runner.pages.ListPage(cfg);}}
break;case Runner.pages.constants.PAGE_ADD:if(cfg.editType==Runner.pages.constants.ADD_ONTHEFLY){return new Runner.pages.AddPageFly(cfg);}else{return new Runner.pages.AddPage(cfg);}
break;case Runner.pages.constants.PAGE_EDIT:return new Runner.pages.EditPage(cfg);break;case Runner.pages.constants.PAGE_VIEW:return new Runner.pages.ViewPage(cfg);break;case Runner.pages.constants.PAGE_SEARCH:return new Runner.pages.SearchPage(cfg);break;case Runner.pages.constants.PAGE_REPORT:if(Runner.isMobile)
return new Runner.pages.ReportPageMobile(cfg);else
return new Runner.pages.ReportPage(cfg);break;case Runner.pages.constants.PAGE_CHART:if(Runner.isMobile)
return new Runner.pages.ChartPageMobile(cfg);else
return new Runner.pages.ChartPage(cfg);break;case Runner.pages.constants.PAGE_REGISTER:return new Runner.pages.RegisterPage(cfg);break;case Runner.pages.constants.PAGE_EXPORT:return new Runner.pages.ExportPage(cfg);break;case Runner.pages.constants.PAGE_IMPORT:return new Runner.pages.ImportPage(cfg);break;default:cfg.createAsDefault=true;return new Runner.pages.RunnerPage(cfg);break;}};Runner.pages.getUrl=function(tName,pageType,keys,keyPref){var url=Runner.pages.PageSettings.getShortTName(tName)+"_"+pageType+".php",i=0,key;keyPref=keyPref||"editid";for(key in keys){url+="?";break;}
for(key in keys){i++;url+=keyPref+i+"="+escape(keys[key])+"&";}
for(key in keys){url=url.substring(0,url.length-1);break;}
return url;};Runner.pages.RunnerPage=Runner.extend(Runner.util.Observable,{tName:'',pageType:'',parentPage:null,modal:false,pageId:-1,controlsMap:null,fly:false,headerCont:"",bodyCont:"",fotterCont:"",win:null,pageCont:null,bricksForReload:[],createAsDefault:false,useAsGlobal:false,destroyOnClose:false,afterClose:null,shortTName:"",useLocking:false,bricksForMobileFly:[],constructor:function(cfg){Runner.apply(this,cfg);Runner.pages.PageManager.register(this);this.addEvents('beforeInit','afterInit','filesLoaded','afterClose');this.id=this.pageId;this.shortTName=Runner.pages.PageSettings.getShortTName(this.tName);this.useLocking=Runner.pages.PageSettings.getTableData(this.tName,"locking");if(this.afterInit){this.on({'afterInit':this.afterInit});}
this.pageCont=document.body;},destructor:function(){if(this.win){this.win.destroy();}
else if((Runner.isMobile)&&(this.fly)){this.destructorMobile();}
this.purgeListeners();Runner.controls.ControlManager.unregister(this.tName,this.pageId);},destructorMobile:function(){this.replaceBrickHTMLWith('flypanel_mobile','');for(var i=0,l=this.bricksForMobileFly.length;i<l;i++){this.showBrick(this.bricksForMobileFly[i].name);}
this.hideBricks(["flypanel_mobile"]);},init:function(){this.fireEvent('beforeInit',this);if(Runner.pages.PageSettings.getTableData(this.tName,"isUseIbox")&&window.init_ibox){init_ibox();}
$('body').addClass("yui-skin-sam");this.initMenu();this.initEvents();this.initControls();this.initLookups();this.setFirstFocus();this.initRunnerButtons();this.initCSS();if(this.createAsDefault){this.fireEvent('afterInit',this,this.id);}},initCSS:function(){if(this.fly||this.pageMode==Runner.pages.constants.MODE_LIST_DETAILS){if(Runner.pages.PageSettings.getTableData(this.tName,"pageCSS")){Runner.util.ScriptLoader.loadCSS([Runner.pages.PageSettings.getTableData(this.tName,"pageCSS")],true);Runner.util.ScriptLoader.loadCSS([Runner.pages.PageSettings.getTableData(this.tName,"pageLayout")]);}}},initRunnerButtonByClass:function(el){var btnFrame=$(el).closest('span.runner-btnframe');if(btnFrame.length){$(el).bind({mouseenter:function(){btnFrame.addClass("hover");},mouseleave:function(){btnFrame.removeClass("hover press");},mousedown:function(){btnFrame.addClass("press");}});}},addDisabledClass:function(el){$(el).closest('span.runner-btnframe').addClass('disabled');},delDisabledClass:function(el){$(el).closest('span.runner-btnframe').removeClass('disabled');$(el).attr('type','');this.initRunnerButtonByClass(el);},isDisabledButton:function(el){if($(el).closest('span.runner-btnframe').hasClass('disabled'))
return true;else
return false;},initRunnerButtons:function(){var pageObj=this;$(".runner-button").each(function(){if($(this).attr('type')=='disabled')
pageObj.addDisabledClass(this);else
pageObj.initRunnerButtonByClass(this);});$(".runner-button-img").each(function(){if($(this).attr('type')=='disabled')
pageObj.addDisabledClass(this);else
pageObj.initRunnerButtonByClass(this);});},initToolTips:function(toolTips,tName){tName=tName||this.tName;if(!Runner.pages.PageSettings.getTableData(this.tName,"isUseToolTips")){return false;}
if(!$('#shiny_box').length){var div=document.createElement('DIV');$(div).css('display','none').attr('id','shiny_box').addClass('shiny_box').addClass('_hintBox').appendTo(document.body);$(document.createElement('DIV')).addClass('shiny_box_body').addClass('runner-panel').appendTo(div);}
toolTips=toolTips||this.controlsMap.toolTips||[];var ctrls=Runner.controls.ControlManager.getAt(tName);for(var i=0;i<ctrls.length;i++){if(ctrls[i]&&typeof toolTips[ctrls[i].fieldName]=='string'){ctrls[i].initToolTip(toolTips[ctrls[i].fieldName],this);}}
return true;},initMenu:function()
{if($(".runner-hmenu").length&&!$(".runner-hmenu:first").prop("initialized")){Runner.menu.Horizontal.prototype.init();}
if($(".runner-vmenu.simple").length&&!$(".runner-vmenu.simple:first").prop("initialized")){Runner.menu.SimpleVmenu.prototype.init();}
if($(".runner-vmenu.tree").length&&!$(".runner-vmenu.tree:first").prop("initialized")){Runner.menu.TreeLikeVmenu.prototype.init();}
if($(".runner-quickjump").length&&!$(".runner-quickjump:first").prop("initialized")){Runner.menu.QuickJump.prototype.init();}},initVideo:function(videoMap){if(!Runner.pages.PageSettings.getTableData(this.tName,"isUseVideo")){return false;}
videoMap=videoMap||this.controlsMap.video;for(var i=0;i<videoMap.length;i++){if($("#"+videoMap[i]).length){flowplayer(videoMap[i],"include/video/flowplayer-3.2.3.swf",{clip:{autoPlay:false,autoBuffering:false,url:escape($("#"+videoMap[i]).attr("href"))}});}}},initAudio:function(){if(!Runner.pages.PageSettings.getTableData(this.tName,"isUseAudio")){return false;}
var initAudio=function(){this.preprocessAudioLinks();if(!YAHOO.mediaplayer.loadPlayerScript.bCalled){YAHOO.mediaplayer.loadPlayerScript();}else{if(this.gridElem){YAHOO.MediaPlayer.addTracks(this.gridElem.get(0),null,false);}else{var bricksArr=this.getBrickObjs('viewfields');for(var i=0;i<bricksArr.length;i++){YAHOO.MediaPlayer.addTracks(bricksArr[i].elem.get(0),null,false);}}}};if(window.GlobalYmpLoader){GlobalYmpLoader.onLoad(initAudio,this);}},preprocessAudioLinks:function(){var audioLinks=$(".htrack",this.pageCont);var lastInd=document.location.href.lastIndexOf("/");var addHref=document.location.href.substr(0,lastInd+1);if(addHref.substr(7,9)=='localhost'){addHref=addHref.replace('localhost','127.0.0.1');}
for(var i=0;i<audioLinks.length;i++){var link=$(audioLinks[i]).attr("href");if(link.substr(0,4)=="http"){var fixedLink=link.replace('http://localhost','http://127.0.0.1');if(link!=fixedLink){$(audioLinks[i]).attr("href",fixedLink);}}
else{$(audioLinks[i]).attr("href",(addHref+link));}}
return audioLinks.length;},initFlyPage:function(){if(Runner.isMobile)
this.initFlyMobile();else
this.initFly();this.loadFiles();},loadFiles:function(){this.initCustomButtons();if(Runner.pages.PageSettings.getTableData(this.tName,"isUseCK")){Runner.util.ScriptLoader.addJS(["plugins/ckeditor/ckeditor.js"]);}
if(Runner.pages.PageSettings.getTableData(this.tName,"isUseIbox")){Runner.util.ScriptLoader.addJS(["include/ibox.js"]);Runner.util.ScriptLoader.loadCSS(["include/ibox"]);}
if(Runner.pages.PageSettings.getTableData(this.tName,"isUseVideo")){Runner.util.ScriptLoader.addJS(["include/video/flowplayer-3.2.3.min.js"]);}
if(Runner.pages.PageSettings.getTableData(this.tName,"isUseAudio")){Runner.util.ScriptLoader.addJS(['include/runnerJS/ymp.js']);}
if(Runner.pages.PageSettings.getTableData(this.tName,"hasEvents")){Runner.util.ScriptLoader.addJS(["include/runnerJS/events/pageevents_"+this.shortTName+".js"]);}
if(Runner.pages.PageSettings.getTableData(this.tName,"isUseResize")){Runner.util.ScriptLoader.addJS(['include/runnerJS/RunnerResizeGrid.js']);Runner.util.ScriptLoader.loadCSS(['include/stylesheets']);}
if(Runner.pages.PageSettings.getTableData(this.tName,"isUseGoogleMap")){var GoogleMapCfg=Runner.pages.PageSettings.getTableData(this.tName,"googleMapCfg");Runner.util.ScriptLoader.addJS(['include/runnerJS/gmap.js']);}
if(Runner.pages.PageSettings.getTableData(this.tName,"isUseToolTips")){if(Runner.isMobile){Runner.util.ScriptLoader.addJS(["include/dimensions.mobile.js"]);}
else{Runner.util.ScriptLoader.addJS(["include/dimensions.js"]);}
Runner.util.ScriptLoader.loadCSS(["include/tooltip"]);}
var fSett=Runner.pages.PageSettings.getTableData(this.tName,"fieldSettings",{});for(var fName in fSett){if(fSett[fName].timePick){Runner.util.ScriptLoader.addJS(["include/ui.js"]);Runner.util.ScriptLoader.addJS(["include/jquery.utils.js"],"include/ui.js");Runner.util.ScriptLoader.addJS(["include/ui.dropslide.js"],"include/jquery.utils.js");Runner.util.ScriptLoader.addJS(["include/jquery.timepickr.js"],"include/ui.dropslide.js");Runner.util.ScriptLoader.loadCSS(["include/ui.dropslide"]);Runner.util.ScriptLoader.loadCSS(["include/ui.timepickr"]);Runner.util.ScriptLoader.loadCSS(["include/ui.theme"]);}
if(fSett[fName].editFormat==Runner.controls.constants.EDIT_FORMAT_DATE&&(fSett[fName].dateEditType==Runner.controls.constants.EDIT_DATE_SIMPLE_DP||fSett[fName].dateEditType==Runner.controls.constants.EDIT_DATE_DD_DP)){if(Runner.pages.PageSettings.getGlobalData("debugMode")){Runner.util.ScriptLoader.addJS(["include/yui/calendar.js"],"include/yui/container.js","include/yui/event.js");}
Runner.util.ScriptLoader.loadCSS(["include/yui/calendar"]);Runner.util.ScriptLoader.loadCSS(["include/yui/calendar-skin"]);Runner.util.ScriptLoader.loadCSS(["include/yui/container"]);Runner.util.ScriptLoader.loadCSS(["include/yui/container-skin"]);Runner.util.ScriptLoader.loadCSS(["include/yui/resize"]);}}
Runner.util.ScriptLoader.on('filesLoaded',this.init,this,{single:true});Runner.util.ScriptLoader.load();},calcPageDimensions:function(html)
{var divContainer=$('<div></div>');$(html).appendTo(divContainer);divContainer.css('position','absolute');divContainer.css('left','-10000px');divContainer.css('top','-10000px');divContainer.appendTo('body');var yuiPanelWidth=divContainer.width()+30;var yuiPanelHeight=divContainer.height()+70;var div_content=$('.yui-content',divContainer);if(div_content.height()!=null){yuiPanelHeight=yuiPanelHeight-div_content.height()+$('div',div_content).height()+10;}
divContainer.remove();var winDim=Runner.getWindowDimensions();var minWidgetMargin=30;if(winDim.width-2*minWidgetMargin<yuiPanelWidth){yuiPanelWidth=winDim.width-2*minWidgetMargin;yuiPanelHeight+=15;}
if(winDim.height-2*minWidgetMargin<yuiPanelHeight){yuiPanelHeight=winDim.height-2*minWidgetMargin;yuiPanelWidth+=10;}
if(yuiPanelWidth<300)
yuiPanelWidth=300;if($.browser.msie){var ckDim=Runner.pages.PageSettings.getRTECKDim(this.tName);if(ckDim){if(yuiPanelHeight<yuiPanelHeight+ckDim.nHeight){yuiPanelHeight+=ckDim.nHeight;}}}
return{width:yuiPanelWidth,height:yuiPanelHeight};},initFlyMobile:function(){if(!this.fly){return false;}
var bodyContDOM=$(this.bodyCont);this.bricksForMobileFly=this.getBrickObjs('',false,true);this.replaceBrickContentHTMLWith("flypanel_mobile",this.bodyCont);for(var i=0,l=this.bricksForMobileFly.length;i<l;i++){this.hideBrick(this.bricksForMobileFly[i].name);}
var pageObj=this;$('#closefly').bind('click',function(e){var tName=pageObj.tName,pageId=pageObj.pageId;Runner.pages.PageManager.unregister(tName,pageId);});this.showBricks(["flypanel_mobile"]);},initFly:function(){if(!this.fly){return false;}
if(this.afterClose){this.on({'afterClose':this.afterClose});}
var bodyContDOM=$(this.bodyCont);var styleDOM=bodyContDOM.filter('style');styleDOM.appendTo('head');var panelSize=this.calcPageDimensions(this.bodyCont);this.pageCont=document.createElement("DIV");this.win=new YAHOO.widget.Panel(this.pageCont,{draggable:true,height:panelSize.height+"px",width:panelSize.width+"px",autofillheight:"body",constraintoviewport:false,modal:this.modal,fixedcenter:true});this.win.setBody(this.bodyCont);this.win.setHeader(this.headerCont);this.win.setFooter(this.fotterCont);this.win.render(document.body);this.win.bringToTop();this.win.subscribe('drag',function(eventName,args,newScope){this.bringToTop();});var resize=new YAHOO.util.Resize(this.pageCont,{handles:["br"],autoRatio:false,minWidth:300,minHeight:100,status:false});resize.on("beforeResize",function(){var loadDiv=$(".runner-loading");if(loadDiv.length)
return false;return true;});resize.on("startResize",function(args){if(this.cfg.getProperty("constraintoviewport")){var D=YAHOO.util.Dom;var clientRegion=D.getClientRegion();var elRegion=D.getRegion(this.element);resize.set("maxWidth",clientRegion.right-elRegion.left-YAHOO.widget.Overlay.VIEWPORT_OFFSET);resize.set("maxHeight",clientRegion.bottom-elRegion.top-YAHOO.widget.Overlay.VIEWPORT_OFFSET);}else{resize.set("maxWidth",null);resize.set("maxHeight",null);}},this.win,true);resize.on("resize",function(args){var panelHeight=args.height;this.cfg.setProperty("height",panelHeight+"px");var panelWidth=args.width;this.cfg.setProperty("width",panelWidth+"px");},this.win,true);if(this.destroyOnClose){this.on('afterClose',function(e){var tName=this.tName,pageId=this.pageId;setTimeout(function(){Runner.pages.PageManager.unregister(tName,pageId);},5);},this);}
this.win.subscribe('hide',function(){this.fireEvent('afterClose',this);},this,this);return true;},show:function(){if(!this.win){return this.initFly();}
this.win.show();return true;},close:function(){if(!this.win){return false}
this.win.hide();return true;},initEvents:function(){var tName=this.tName;if(this.createAsDefault){tName='global';}
var events=Runner.pages.PageSettings.getTableData(tName,"events",{}),eventHnArr,i;for(var pType in events){if(pType!=this.pageType){continue;}
for(var evName in events[pType]){eventHnArr=events[pType][evName];for(i=0;i<eventHnArr.length;i++){this.on(evName,eventHnArr[i].hn,eventHnArr[i].scope||this);}}}},addSettings:function(settings){Runner.pages.PageSettings.addSettings(settings,this.tName,this.pageType);},initControls:function(){this.controlsMap.controls=this.controlsMap.controls||[];for(var i=0;i<this.controlsMap.controls.length;i++){this.controlsMap.controls[i].table=this.tName;var ctrl=Runner.controls.ControlFabric(this.controlsMap.controls[i]);}},initLookups:function(){var pageCtrls=Runner.controls.ControlManager.getAt(this.tName,this.pageId);for(var i=0;i<pageCtrls.length;i++){if(!pageCtrls[i].isLookupWizard){continue;}
if(pageCtrls[i].parentFieldName&&pageCtrls[i].skipDependencies!==true){var parentCtrl=Runner.controls.ControlManager.getAt(this.tName,this.pageId,pageCtrls[i].parentFieldName);pageCtrls[i].setParentCtrl(parentCtrl);if(parentCtrl&&parentCtrl.isLookupWizard){parentCtrl.addDependentCtrls([pageCtrls[i]]);}}}},initTabs:function(){if(!this.controlsMap.tabs||!this.controlsMap.sections){return false;}
this.tabs={};var tabs=this.controlsMap.tabs;for(var tabGroup in tabs){this.tabs[tabGroup]=new YAHOO.widget.TabView(tabGroup);}
var sections=this.controlsMap.sections;for(var secId in sections){(function(secId){$("#"+secId+"Butt").bind("click",function(e){if($(this).attr("src")=='images/minus.gif'){$("#"+secId).hide();$(this).attr("src",'images/plus.gif');}else{$("#"+secId).show();$(this).attr("src",'images/minus.gif');}});})(secId);}},initCustomButtons:function(){if(!Runner.pages.PageSettings.getTableData(this.tName,"isUseButtons")){return false;}
Runner.util.ScriptLoader.addJS(['include/json.js']);if(Runner.debugMode===true){Runner.util.ScriptLoader.addJS(['include/runnerJS/RunnerEvent.js']);Runner.util.ScriptLoader.addJS(['include/runnerJS/button.js'],'include/runnerJS/RunnerEvent.js');Runner.util.ScriptLoader.addJS(['include/runnerJS/events/pageevents_'+this.shortTName+'.js'],'include/runnerJS/button.js');}else{Runner.util.ScriptLoader.addJS(['include/runnerJS/RunnerControls.js']);Runner.util.ScriptLoader.addJS(['include/runnerJS/events/pageevents_'+this.shortTName+'.js'],'include/runnerJS/RunnerControls.js');}},setFirstFocus:function(id){var controls="",contin=false,ctrls=Runner.controls.ControlManager.getAt(this.tName);$("span[id^=edit"+(id!=undefined?id:this.id)+"_]").each(function(){if(!contin){for(var i=0,l=ctrls.length;i<l;i++){if(ctrls[i]!=undefined){if(ctrls[i].spanContId==this.id&&$(this).css("display")!="none"&&ctrls[i].inputType!="hidden"){ctrls[i].setFocus();contin=true;}}}}});},getSelBoxes:function(id){var selBoxes=new Array();$('input[type=checkbox][id^=check'+id+'_]').each(function(){if(this.checked){selBoxes.push(this);}});return selBoxes;},cloneFormElements:function(elems){var cloneElems=new Array();$(elems).each(function(i,n){if(n.type=="checkbox"&&!n.checked)
return;var cln=$('<input type=hidden>');cln.attr('name',$(n).attr('name'));cln.val($(n).val());cloneElems.push(cln);});return cloneElems;},hideBricks:function(arrOfNames){for(var i=0,l=arrOfNames.length;i<l;i++){this.hideBrick(arrOfNames[i]);}},hideBrick:function(name){var brickObjs=this.getBrickObjs(name);for(var i=0,l=brickObjs.length;i<l;i++){brickObjs[i].hide();}},showBricks:function(arrOfNames){for(var i=0,l=arrOfNames.length;i<l;i++){this.showBrick(arrOfNames[i]);}},showBrick:function(name){var brickObjs=this.getBrickObjs(name);for(var i=0,l=brickObjs.length;i<l;i++){brickObjs[i].show();}},getBricksObjs:function(arrOfNames){var bricksObjs={};for(var i=0,l=arrOfNames.length;i<l;i++){bricksObjs[arrOfNames[i]]=this.getBrickObjs(arrOfNames[i]);}
return bricksObjs;},getBrickObjs:function(name,pageCont,all){all=all||false;name=name||'';pageCont=pageCont||this.pageCont;var crit=all?'[class*=runner-b-]':'.runner-b-'+name;dpPar=$(pageCont).closest('td.runner-dpinline'),flyWin=$(pageCont).closest('div.yui-panel-container')
brickObjs=[];$(crit,pageCont).each(function(){if(!flyWin.length&&$(this).closest('div.yui-panel-container').length)
return;if(!dpPar.length&&$(this).closest('td.runner-dpinline').length)
return;if(dpPar.length&&$(this).closest('td.runner-dpinline')[0]!=dpPar[0])
return;brickObjs.push(new Runner.bricks.Brick({name:name,elem:$(this)}));});return brickObjs;},getBrickElem:function(name){var bricksArr=this.getBrickObjs(name);if(!bricksArr.length){return false;}else{return bricksArr[0].elem}},getBrickGridElem:function(){return this.getBrickElem('grid');},getBrickContentsElem:function(name){var bricksArr=this.getBrickObjs(name);if(!bricksArr.length){return false;}else{return bricksArr[0].contentElem;}},getBricksHtml:function(pageCont){var bricksHtml={};if(!pageCont){pageCont=this.pageCont;}
for(i=0,l=this.bricksForReload.length;i<l;i++){bricksHtml[this.bricksForReload[i]]=$('.runner-b-'+this.bricksForReload[i],pageCont).html();}
return bricksHtml;},replaceBricksWith:function(newBricks){for(var name in newBricks){this.replaceBrickWith(name,newBricks[name]);}},replaceBrickWith:function(name,newBrick){var brickObjs=this.getBrickObjs(name);for(var i=0,l=brickObjs.length;i<l;i++){brickObjs[i].replaceWith(newBrick);}},replaceBricksHTMLWith:function(newBricksHTML){for(var name in newBricksHTML){this.replaceBrickHTMLWith(name,newBricksHTML[name]);}},replaceBrickHTMLWith:function(name,newHTML){var brickObjs=this.getBrickObjs(name);for(var i=0,l=brickObjs.length;i<l;i++){brickObjs[i].replaceHTMLWith(newHTML);}},replaceBricksContentsWith:function(newBricksContents){for(var name in newBricksContents){this.replaceBrickContentWith(name,newBricksContents[name]);}},replaceBrickContentWith:function(name,newContent){var brickObjs=this.getBrickObjs(name);for(var i=0,l=brickObjs.length;i<l;i++){brickObjs[i].replaceContentWith(newContent);}},replaceBricksContentsHTMLWith:function(newContentsHTML){for(var name in newContentsHTML){this.replaceBrickContentHTMLWith(name,newContentsHTML[name]);}},replaceBrickContentHTMLWith:function(name,newHTML){var brickObjs=this.getBrickObjs(name);for(var i=0,l=brickObjs.length;i<l;i++){brickObjs[i].replaceContentHTMLWith(newHTML);}}});Runner.pages.SearchPage=Runner.extend(Runner.pages.RunnerPage,{constructor:function(cfg){Runner.pages.SearchPage.superclass.constructor.call(this,cfg);},init:function(){Runner.pages.SearchPage.superclass.init.call(this);this.initButtons();this.initSearch();this.fireEvent('afterInit',this,this.id);},initButtons:function(){var pageObj=this;$("#searchButton"+this.id).bind("click",function(e){pageObj.searchController.submitSearch();});$("#resetButton"+this.id).bind("click",function(e){pageObj.searchController.clearCtrls();});$("#backButton"+this.id).bind("click",function(e){pageObj.searchController.returnSubmit();});},initSearch:function(){this.searchController=new Runner.search.SearchForm({id:this.pageId,tName:this.tName,fNamesArr:this.controlsMap.search.allSearchFields,shortTName:this.shortTName,usedSrch:this.controlsMap.search.isUsedSearch,searchType:'advanced',panelSearchFields:this.controlsMap.search.panelSearchFields,pageType:this.controlsMap.search.submitPageType,baseParams:this.controlsMap.search.baseParams||{},useSuggest:Runner.pages.PageSettings.getTableData(this.tName,"ajaxSuggest"),shortTName:Runner.pages.PageSettings.getShortTName(this.tName)});this.searchController.init(this.controlsMap.search.searchBlocks);}});Runner.pages.ViewPage=Runner.extend(Runner.pages.RunnerPage,{keys:null,prevKeys:null,nextKeys:null,pageType:Runner.pages.constants.PAGE_VIEW,constructor:function(cfg){Runner.pages.ViewPage.superclass.constructor.call(this,cfg);this.keys=cfg.keys||Runner.pages.PageSettings.getTableData(this.tName,'keys');this.prevKeys=Runner.pages.PageSettings.getTableData(this.tName,'prevKeys');this.nextKeys=Runner.pages.PageSettings.getTableData(this.tName,'nextKeys');window.recKeysObj=this.keys;},init:function(){Runner.pages.ViewPage.superclass.init.call(this);this.initMap();this.initButtons();if(!Runner.isMobile)
this.initDetails();this.initTabs();this.initAudio();this.initVideo();this.fireEvent('afterInit',this,this.id);},initFly:function(){if(Runner.pages.ViewPage.superclass.initFly.call(this)){var images=$(this.win.body).find('img[src*="imager.php"]'),src;for(var j=0;j<images.length;j++){src=$(images[j]).attr('src');if(src&&src.indexOf('?')!=-1){$(images[j]).attr('src',(src+"&rndVal="+Math.random()));}else{$(images[j]).attr('src',(src+"?rndVal="+Math.random()));}}}},initButtons:function(){var pageObj=this;$("#nextButton"+this.id).bind("click",function(e){window.location.href=Runner.pages.getUrl(pageObj.tName,pageObj.pageType,pageObj.nextKeys);});$("#prevButton"+this.id).bind("click",function(e){window.location.href=Runner.pages.getUrl(pageObj.tName,pageObj.pageType,pageObj.prevKeys);});$("#backButton"+this.id).bind("click",function(e){Runner.Event.prototype.stopEvent(e);window.location.href=Runner.pages.getUrl(pageObj.tName,Runner.pages.constants.PAGE_LIST,{})+"?a=return";});},initMap:function(){if(!this.controlsMap.gMaps||!this.controlsMap.gMaps.isUseGoogleMap){return false;}
var initMaps=function(){this.mapManager=new Runner.controls.MapManager(this.controlsMap.gMaps);this.mapManager.init();}
if(window.GlobalGmapLoader){GlobalGmapLoader.onLoad(initMaps,this);}},initDetails:function(id){if(typeof id=="undefined"){id=this.pageId;}
this.dpObjs={};if(Runner.pages.PageSettings.getTableData(this.tName,"isShowDetails")){var dpTablesParams=this.controlsMap.dpTablesParams;for(var i=0;i<dpTablesParams.length;i++){this.dpObjs[dpTablesParams[i].tName]=new Runner.util.details.ViewDP({id:dpTablesParams[i].id,masterTName:this.tName,tName:dpTablesParams[i].tName,parId:this.id,controlsMap:this.controlsMap.dControlsMap[dpTablesParams[i].tName]});this.dpObjs[dpTablesParams[i].tName].init();}}}});Runner.pages.EditorPage=Runner.extend(Runner.pages.RunnerPage,{baseParams:null,tabs:null,submited:false,form:null,constructor:function(cfg){Runner.pages.EditorPage.superclass.constructor.call(this,cfg);this.baseParams=cfg.baseParams||{};this.baseParams['id']=this.id;this.baseParams["editType"]=this.baseParams["editType"]||this.editType;this.submitUrl=Runner.pages.PageSettings.getShortTName(this.tName)+"_"+this.pageType+".php";this.addEvents("beforeSave","afterSave");if(this.fly){this.baseParams['onFly']=1;}},destructor:function(){Runner.pages.EditorPage.superclass.destructor.call(this);if(this.form){this.form.destructor();this.form=null;}},init:function(){Runner.pages.EditorPage.superclass.init.call(this);if(this.beforeSave){this.on({'beforeSave':this.beforeSave});}
if(this.afterSave){this.on({'afterSave':this.afterSave});}
this.initButtons();this.initTabs();this.setFirstFocus();this.initToolTips();if(!Runner.isMobile){setTimeout(function(){$('div.shiny_box').hide();},0);}},close:function(){Runner.pages.EditorPage.superclass.close.call(this);$('div.shiny_box').hide();},initButtons:function(){var pageObj=this;if(!Runner.pages.PageSettings.getTableData(this.tName,"isMobileIOS"))
$("#saveButton"+this.id).bind("click",function(){if(!pageObj.isDisabledButton($("#saveButton"+pageObj.id)))
pageObj.saveHn();});else
$("#saveButton"+this.id).bind("click",function(){$("#editForm"+pageObj.id).submit();});},getForm:function(){var isShowDetails=Runner.pages.PageSettings.getTableData(this.tName,"isShowDetails");this.form=this.form||new Runner.form.BasicForm({submitUrl:this.submitUrl,standardSubmit:!this.fly,isFileUpload:true,method:'POST',id:this.pageId,baseParams:this.baseParams,fieldControls:Runner.controls.ControlManager.getAt(this.tName,this.pageId),useMultipart:true,submitFailed:{fn:function(response,formObj,fieldControls){if(response==-1){formObj.clearForm();this.showError("<< "+Runner.lang.constants.TEXT_INLINE_ERROR+" >>");}
this.fireEvent("afterSave",{success:false,html:response},formObj,fieldControls,this);},scope:this},beforeSubmit:{fn:function(formObj){return this.fireEvent("beforeSave",formObj,formObj.fieldControls,this);},scope:this},validationFailed:{fn:function(formObj,fieldControls,failedControlsArr){var fNamesArr=[];for(var i=0;i<failedControlsArr.length;i++){fNamesArr.push(failedControlsArr[i].fieldName);}
this.openFieldTabsSections(fNamesArr);return false;},scope:this}});return this.form;},saveHn:function(){var form=this.getForm();form.submit();},openFieldTabsSections:function(fNamesArr){if(!Runner.isArray(this.controlsMap.sections)){var sections=this.controlsMap.sections;for(var secId in sections){for(var i=0;i<fNamesArr.length;i++){if(sections[secId].isInArray(fNamesArr[i])){$("#"+secId).show();$("#"+secId+"Butt").attr("src",'images/minus.gif');break;}}}}
if(!Runner.isArray(this.controlsMap.tabs)){var tabs=this.controlsMap.tabs,tabInd=0,selected=false;for(var tabGroup in tabs){tabInd=0;selected=false;for(var tab in tabs[tabGroup]){for(var i=0;i<fNamesArr.length;i++){if(tabs[tabGroup][tab].isInArray(fNamesArr[i])){this.tabs[tabGroup].selectTab(tabInd);selected=true;break;}}
if(selected){break;}
tabInd++;}}}},showError:function(txt,appendTxt){if(!txt.length){return;}
var mes=$('.runner-cc',this.getBrickElem('message'));if(mes.length){if(appendTxt){mes.append(txt);}else{mes.empty().html(txt);}}else{var mtb=$("div.main_table_border");mtb.prepend('<div id="message_block'+this.id+'" class="downedit">'+txt+'</div>');}}});Runner.pages.AddPageFly=Runner.extend(Runner.pages.EditorPage,{pageType:Runner.pages.constants.PAGE_ADD,fName:"",parentFieldName:"",editType:Runner.pages.constants.ADD_ONTHEFLY,constructor:function(cfg){Runner.pages.AddPageFly.superclass.constructor.call(this,cfg);this.baseParams["a"]="added";this.submitUrl+="?ferror=1&fly=1&";},init:function(){Runner.pages.AddPageFly.superclass.init.call(this);this.fireEvent('afterInit',this,this.id);},initButtons:function(){Runner.pages.AddPage.superclass.initButtons.call(this);$("#cancelButton"+this.id).bind("click",{page:this},function(e){Runner.Event.prototype.stopEvent(e);e.data.page.close();});},getForm:function(){Runner.pages.AddPageFly.superclass.getForm.call(this);this.form.on('successSubmit',function(respObj,basicForm,fieldControls){var evRes=this.fireEvent("afterSave",respObj,basicForm,fieldControls,this);if(evRes!==false){this.close();}},this);return this.form;}});Runner.pages.AddPage=Runner.extend(Runner.pages.EditorPage,{pageType:Runner.pages.constants.PAGE_ADD,baseParams:null,showInPopUp:false,detailKeys:null,constructor:function(cfg){Runner.pages.AddPage.superclass.constructor.call(this,cfg);this.baseParams['a']="added";this.showInPopUp=Runner.pages.PageSettings.getTableData(this.tName,"showAddInPopup")&&!Runner.isMobile;this.submitUrl+="?ferror=1&";if(this.showInPopUp&&!Runner.isMobile){this.submitUrl+="fly=1&";}},init:function(){Runner.pages.AddPage.superclass.init.call(this);if(!Runner.isMobile)
this.initDetails();this.fireEvent('afterInit',this,this.id);},initDetails:function(id){if(typeof id=="undefined"){id=this.pageId;}
this.dpObjs={};if(Runner.pages.PageSettings.getTableData(this.tName,"isShowDetails")){var dpTablesParams=this.controlsMap.dpTablesParams;for(var i=0;i<dpTablesParams.length;i++){this.dpObjs[dpTablesParams[i].tName]=new Runner.util.details.AddDP({id:dpTablesParams[i].id,masterTName:this.tName,tName:dpTablesParams[i].tName,useChildCount:this.fly==true,controlsMap:this.controlsMap.dControlsMap[dpTablesParams[i].tName],parId:this.id,saveFailed:{fn:function(detObj,respObj,formObj){var failedTables=[],firstIncId;for(var tName in this.dpObjs){if(this.dpObjs[tName].submitMade){failedTables.push(tName);firstIncId=firstIncId||this.dpObjs[tName].id;}else{return;}}
this.form.makeReadonly();var messArr=[],url=document.URL,pos=url.indexOf("#dt"+firstIncId),msg,txt;if(pos==-1){url=url+"#dt"+firstIncId;}
for(var i=0;i<failedTables.length;i++){msg=Runner.lang.constants.TEXT_DETAIL_NOT_SAVED.replace('%s',failedTables[i]);txt="<div class='message mes_not'><<< "+msg+" >>> <br><a href='"+url+"' >"+Runner.lang.constants.TEXT_DETAIL_GOTO+" "+failedTables[i]+"</a></div>";messArr.push(txt);}
this.showError(messArr.join(""));},scope:this}});this.dpObjs[dpTablesParams[i].tName].init();this.dpObjs[dpTablesParams[i].tName].submitSucceded=false;this.dpObjs[dpTablesParams[i].tName].on('detailsSaved',function(detObj,allVals,fields,allKeys,allRowIds){for(var tName in this.dpObjs){if(!this.dpObjs[tName].submitSucceded){return;}}
if(!this.fly){if(this.afterAddId){var rUrl=Runner.pages.getUrl(this.tName,this.pageType,{});window.location.href=rUrl+((rUrl.indexOf('?')==-1)?"?":"&")+'afteradd='+this.afterAddId;}else{window.location.href=Runner.pages.getUrl(this.tName,this.pageType,{});}}else{var parObj=Runner.pages.PageManager.getAt(this.baseParams.table,this.baseParams.parId);for(var tName in parObj.dpObjs)
parObj.dpObjs[tName].getChildRecNum(this.detailKeys[tName]);this.close();}},this);}}},initButtons:function(){Runner.pages.AddPage.superclass.initButtons.call(this);$("#backButton"+this.id).bind("click",{page:this},function(e){Runner.Event.prototype.stopEvent(e);window.location.href=Runner.pages.PageSettings.getShortTName(e.data.page.tName)+'_'+Runner.pages.constants.PAGE_LIST+'.php?a=return';});$("#cancelButton"+this.id).bind("click",{page:this},function(e){Runner.Event.prototype.stopEvent(e);e.data.page.close();});},saveHn:function(){if(!this.masterSaved){Runner.pages.AddPage.superclass.saveHn.call(this);return;}
for(var tName in this.dpObjs){this.dpObjs[tName].saveDetails(this.mKeys[tName]);}},afterAddRequest:function(){$.post(this.submitUrl,{'afteradd':this.afterAddId});},getForm:function(){var form=Runner.pages.AddPage.superclass.getForm.call(this);var isShowDetails=Runner.pages.PageSettings.getTableData(this.tName,"isShowDetails");form.standardSubmit=!isShowDetails&&!this.fly||Runner.isMobile;if(isShowDetails&&this.editType!=Runner.pages.constants.ADD_ONTHEFLY&&!Runner.isMobile){form.baseParams['editType']=Runner.pages.constants.ADD_MASTER;form.on('beforeSubmit',function(basicForm){var valRes=basicForm.validate();if(!valRes){return false;}
for(var tName in this.dpObjs){if((this.dpObjs[tName].inlineAdd&&!this.dpObjs[tName].inlineAdd.inlineAddChangeContent)&&!this.dpObjs[tName].validate()){valRes=false;}}
return valRes;},this);form.on('successSubmit',function(respObj,basicForm,fieldControls){if(respObj.success){this.detailKeys=respObj.detKeys;this.masterSaved=true;this.mKeys=respObj.mKeys;this.afterAddId=respObj.afterAddId?respObj.afterAddId:null;for(var tName in this.dpObjs){this.dpObjs[tName].saveDetails(respObj.mKeys[tName]);}}else{this.showError(respObj.error);if(respObj.hideCaptha){$('.captcha_block').remove();}
if(respObj.captha===false){var captchaErrDiv=$('#edit'+this.id+'_captcha_0').find('div.error');if(captchaErrDiv.length){captchaErrDiv.empty().html(Runner.lang.constants.TEXT_INVALID_CAPTCHA_CODE);}else{$('#edit'+this.id+'_captcha_0').append('<div class=\"error\">'+Runner.lang.constants.TEXT_INVALID_CAPTCHA_CODE+'</div>');}}else{$('#edit'+this.id+'_captcha_0').find('div.error').remove();}}},this);}
if(typeof form.triedToSubmit=='undefined')
form.on('successSubmit',function(respObj,basicForm,fieldControls){var evRes=this.fireEvent("afterSave",respObj,basicForm,fieldControls,this);if(evRes!==false&&(!isShowDetails||Runner.isMobile)){this.close();}},this);return form;}});Runner.pages.EditPage=Runner.extend(Runner.pages.EditorPage,{keys:null,prevKeys:null,nextKeys:null,pageType:Runner.pages.constants.PAGE_EDIT,details:null,constructor:function(cfg){Runner.pages.EditPage.superclass.constructor.call(this,cfg);this.keys=cfg.keys||Runner.pages.PageSettings.getTableData(this.tName,'keys');this.sKeys=Runner.pages.PageSettings.getTableData(this.tName,"sKeys","");this.prevKeys=Runner.pages.PageSettings.getTableData(this.tName,'prevKeys');this.nextKeys=Runner.pages.PageSettings.getTableData(this.tName,'nextKeys');this.shortTName=Runner.pages.PageSettings.getShortTName(this.tName);this.baseParams['a']="edited";this.submitUrl+="?ferror=1&";if(this.fly){this.submitUrl+="fly=1&";}
window.recKeysObj=this.keys;var i=0;for(var key in this.keys){i++;this.baseParams["editid"+i]=this.keys[key];this.submitUrl+="editid"+i+"="+this.keys[key]+'&';}},init:function(){Runner.pages.EditPage.superclass.init.call(this);this.initCtrlEvents();if(!Runner.isMobile)
this.initDetails();this.initLocking();this.fireEvent('afterInit',this,this.id);},initButtons:function(){Runner.pages.EditPage.superclass.initButtons.call(this);var pageObj=this;$("#resetButton"+this.id).bind("click",function(e){pageObj.delDisabledClass($('#prevButton'+pageObj.id));pageObj.delDisabledClass($('#nextButton'+pageObj.id));Runner.controls.ControlManager.resetControlsForTable(pageObj.tName);}).bind("mouseover",function(e){this.focus();});$("#nextButton"+this.id).bind("click",function(e){if(pageObj.isDisabledButton(this)){Runner.Event.prototype.stopEvent(e);return false;}
if(pageObj.useLocking){pageObj.locking.UnlockRecord(pageObj.sKeys,'',function(){pageObj.nextButtonHref.call(pageObj)});}else{pageObj.nextButtonHref();}});$("#prevButton"+this.id).bind("click",function(e){if(pageObj.isDisabledButton(this)){Runner.Event.prototype.stopEvent(e);return false;}
if(pageObj.useLocking){pageObj.locking.UnlockRecord(pageObj.sKeys,'',function(){pageObj.prevButtonHref.call(pageObj)});}else{pageObj.prevButtonHref();}});$("#backButton"+this.id).bind("click",function(e){Runner.Event.prototype.stopEvent(e);if(pageObj.useLocking){pageObj.locking.UnlockRecord(pageObj.sKeys,'',function(){pageObj.backButtonHref.call(pageObj)});}else{pageObj.backButtonHref();}});},nextButtonHref:function(){window.location.href=Runner.pages.getUrl(this.tName,this.pageType,this.nextKeys);},prevButtonHref:function(){window.location.href=Runner.pages.getUrl(this.tName,this.pageType,this.prevKeys);},backButtonHref:function(){window.location.href=this.shortTName+'_'+Runner.pages.constants.PAGE_LIST+'.php?a=return';},initCtrlEvents:function(){var ctrls=Runner.controls.ControlManager.getAt(this.tName,this.pageId),cntrlType,eventName='change',singleFire=false,delay=0;for(var i=0;i<ctrls.length;i++){cntrlType=ctrls[i].getControlType(),eventName='change',singleFire=false,delay=0;if(cntrlType=='checkbox'||cntrlType=='radio'){eventName='click';}else if(cntrlType=='text'||cntrlType=='password'||cntrlType=='textarea'){eventName='keyup';delay=60;ctrls[i].on('change',this.prevNextButtonHandler,{single:true,timeout:0,scope:this});}else if(cntrlType=='RTE'){eventName='blur';delay=5000;}
ctrls[i].on(eventName,this.prevNextButtonHandler,{single:singleFire,timeout:delay,scope:this});}},prevNextButtonHandler:function(e){var pageObj=Runner.pages.PageManager.getAt(this.table,this.id);if(arguments.length>1&&typeof arguments[1]=='object'&&arguments[1].enableNextButtons===false){return true;}
if(e&&(e.type=='keyup'||e.type=='keypress'||e.type=='keydown')){if(e.keyCode>=33&&e.keyCode<=40||e.keyCode==9)
return true;}
pageObj.addDisabledClass($('#prevButton'+this.id));pageObj.addDisabledClass($('#nextButton'+this.id));return true;},initLocking:function(){if(this.useLocking){this.locking=new Runner.Locking({tName:this.tName,pageId:this.id,pageType:this.pageType});var pageObj=this;this.on("afterClose",function(e){pageObj.locking.UnlockRecord(pageObj.sKeys,'','');},this);window['timeid'+this.id]=setInterval(function(){pageObj.locking.ConfirmLock(pageObj.sKeys);},Runner.pages.PageSettings.getTableData(pageObj.tName,"confirmTime")*1000);}},initDetails:function(id){if(typeof id=="undefined"){id=this.pageId;}
this.dpObjs={};if(Runner.pages.PageSettings.getTableData(this.tName,"isShowDetails")){var dpTablesParams=this.controlsMap.dpTablesParams;for(var i=0;i<dpTablesParams.length;i++){this.dpObjs[dpTablesParams[i].tName]=new Runner.util.details.EditDP({id:dpTablesParams[i].id,parId:this.id,tName:dpTablesParams[i].tName,masterTName:this.tName,childRecNum:0,controlsMap:this.controlsMap.dControlsMap[dpTablesParams[i].tName],useChildCount:this.fly==true,saveFailed:{fn:function(detObj,respObj,formObj){var failedTables=[],firstIncId;for(var tName in this.dpObjs){if(this.dpObjs[tName].submitMade){failedTables.push(tName);firstIncId=firstIncId||this.dpObjs[tName].id;}else{return;}}
var messArr=[],url=document.URL,pos=url.indexOf("#dt"+firstIncId),msg,txt;if(pos==-1){url=url+"#dt"+firstIncId;}
for(var i=0;i<failedTables.length;i++){msg=Runner.lang.constants.TEXT_DETAIL_NOT_SAVED.replace('%s',failedTables[i]);txt="<div class='message mes_not'><<< "+msg+" >>> <br><a href='"+url+"' >"+Runner.lang.constants.TEXT_DETAIL_GOTO+" "+failedTables[i]+"</a></div>";messArr.push(txt);}
this.showError(messArr.join(""));},scope:this}});this.dpObjs[dpTablesParams[i].tName].init();}}},getForm:function(){var form=Runner.pages.AddPage.superclass.getForm.call(this);var isShowDetails=Runner.pages.PageSettings.getTableData(this.tName,"isShowDetails");if(isShowDetails&&this.editType!=Runner.pages.constants.ADD_ONTHEFLY){form.on('validationFailed',function(formObj,fieldControls,faildControls){var failedFNamesArr=[];for(var i=0;i<faildControls.length;i++){failedFNamesArr.push(faildControls[i].fieldName);}
this.openFieldTabsSections(failedFNamesArr);});form.on('successSubmit',function(respObj,basicForm,fieldControls){basicForm.destructor();this.form=null;if(respObj.success){if(!this.fly){window.location.href=window.location.href;}}else{}},this);}
if(typeof form.triedToSubmit=='undefined')
form.on('successSubmit',function(respObj,basicForm,fieldControls){var evRes=this.fireEvent("afterSave",respObj,basicForm,fieldControls,this);if(evRes!==false){this.close();}},this);return form;},saveHn:function(){if(Runner.pages.PageSettings.getTableData(this.tName,"isShowDetails")&&!Runner.isMobile){this.form=this.getForm();if(this.form.validate()){var hn=function(detObj,allVals,fields,allKeys,allRowIds){for(var tName in this.dpObjs){if(!this.dpObjs[tName].submitMade){return;}}
Runner.pages.EditPage.superclass.saveHn.call(this);};for(var tName in this.dpObjs){this.dpObjs[tName].on('detailsSaved',hn,this,{single:true});this.dpObjs[tName].saveDetails();}}}else{Runner.pages.EditPage.superclass.saveHn.call(this);}}});Runner.pages.DataPageWithSearch=Runner.extend(Runner.pages.RunnerPage,{shortTName:"",searchController:null,constructor:function(cfg){Runner.pages.DataPageWithSearch.superclass.constructor.call(this,cfg);this.shortTName=Runner.pages.PageSettings.getShortTName(this.tName);},init:function(){Runner.pages.DataPageWithSearch.superclass.init.call(this);this.initPagination();this.initSearch();this.initAudio();this.initVideo();this.initAdvSearch();this.initPrintFrLink();this.initPrintAll();this.initExcelLink();this.initWordLink();this.initPDFLink();},largeTextOpenerDelegate:function(e){var target=Runner.Event.prototype.getTarget(e);if(target.nodeName!="A"||!$(target).attr("query")){return false;}
Runner.Event.prototype.stopEvent(e);var query=$(target).attr("query");var winId=Runner.genId();var fullTextWin=new YAHOO.widget.Panel("fullText"+winId,{draggable:true,height:"400px",width:"500px",fixedcenter:true});$.get(query,{id:this.id,rndVal:Math.random()},function(respObj){respObj=JSON.parse(respObj);if(respObj.success){fullTextWin.setBody(respObj.textCont);}else{fullTextWin.setBody(respObj.error||"Server error");}
fullTextWin.render(document.body);fullTextWin.bringToTop();fullTextWin.subscribe('drag',function(eventName,args,newScope){this.bringToTop();});var resize=new YAHOO.util.Resize("fullText"+winId,{handles:["br"],autoRatio:false,minWidth:300,minHeight:100,status:false});resize.on("startResize",function(args){if(this.cfg.getProperty("constraintoviewport")){var D=YAHOO.util.Dom;var clientRegion=D.getClientRegion();var elRegion=D.getRegion(this.element);resize.set("maxWidth",clientRegion.right-elRegion.left-YAHOO.widget.Overlay.VIEWPORT_OFFSET);resize.set("maxHeight",clientRegion.bottom-elRegion.top-YAHOO.widget.Overlay.VIEWPORT_OFFSET);}else{resize.set("maxWidth",null);resize.set("maxHeight",null);}},fullTextWin,true);resize.on("resize",function(args){var panelHeight=args.height;this.cfg.setProperty("height",panelHeight+"px");var panelWidth=args.width;this.cfg.setProperty("width",panelWidth+"px");},fullTextWin,true);});fullTextWin.setHeader("&nbsp;");fullTextWin.setFooter("&nbsp;");},initSearch:function(){if(!this.controlsMap.search){return false;}
this.searchController=new Runner.search.SearchController({id:this.pageId,tName:this.tName,fNamesArr:this.controlsMap.search.allSearchFields,shortTName:this.shortTName,usedSrch:this.controlsMap.search.usedSrch,panelSearchFields:this.controlsMap.search.panelSearchFields,useSuggest:Runner.pages.PageSettings.getTableData(this.tName,"ajaxSuggest"),pageType:this.pageType});this.searchController.init(this.controlsMap.search.searchBlocks);},initPagination:function(){$("table[name=paginationTable"+this.pageId+"]").bind("click",{pageObj:this},function(e){Runner.Event.prototype.stopEvent(e);var target=Runner.Event.prototype.getTarget(e);if(target.nodeName!="A"){return false;}
var pageNum=$(target).attr("pageNum"),pageObj=e.data.pageObj;var url=Runner.pages.getUrl(pageObj.tName,pageObj.pageType,{})+"?goto="+pageNum;window.location.href=url;});},initAdvSearch:function(){var pageObj=this;$("#advButton"+this.pageId).bind("click",function(e){window.location.href=pageObj.shortTName+"_search.php";});},initPrintFrLink:function(){var pageObj=this;$("#print_"+this.pageId).bind("click",function(e){window.open(pageObj.shortTName+"_print.php",'wPrint');});},initPrintAll:function(){var pageObj=this;$("#printAll_"+this.pageId).bind("click",function(e){window.open(pageObj.shortTName+"_print.php?all=1",'wPrint');});},initExcelLink:function(){var pageObj=this;$("#export_to_excel"+this.pageId).bind("click",function(e){window.location.href=pageObj.shortTName+"_print.php?all=1&format=excel";});},initWordLink:function(){var pageObj=this;$("#export_to_word"+this.pageId).bind("click",function(e){window.location.href=pageObj.shortTName+"_print.php?all=1&format=word";});},initPDFLink:function(){var pageObj=this;$("#export_to_pdf"+this.pageId).bind("click",function(e){window.location.href=pageObj.shortTName+"_print.php?all=1&format=pdf";});}});Runner.pages.ListPageCommon=Runner.extend(Runner.pages.DataPageWithSearch,{gridElem:null,constructor:function(cfg){Runner.pages.ListPageCommon.superclass.constructor.call(this,cfg);this.permis=Runner.pages.PageSettings.getTableData(this.tName,"permissions");},init:function(){this.initGridElem();this.initResize();Runner.pages.ListPageCommon.superclass.init.call(this);this.initGridHover();this.initHeaderCheckBox();this.initSelectAll();this.initInline();this.initMaps();},initGridElem:function(){this.gridElem=this.getBrickGridElem();$(this.gridElem).unbind("click").bind("click",this.gridClickHn.createDelegate(this,[],true));},gridClickHn:function(e){this.largeTextOpenerDelegate(e);},initResize:function(){if(Runner.isMobile){return false;}
if(Runner.pages.PageSettings.getTableData(this.tName,"isUseResize")){if(!this.resizeGrid){this.resizeGrid=new Runner.resize.Grid({tName:this.tName,pageId:this.pageId});}
this.resizeGrid.init();this.initGridElem();}},initHeaderCheckBox:function(pageId){pageId=pageId||this.id;$('.chooseAll'+pageId).unbind("click").bind("click",function(e){var that=this;$('input[type=checkbox][id^=check'+pageId+'_]').each(function(){this.checked=that.checked;});$('input[type=checkbox][id^=chooseAll_'+pageId+']').each(function(){this.checked=that.checked;});if(e.stopImmediatePropagation){e.stopImmediatePropagation();}});},initSelectAll:function(){var pageObj=this,selectAll=$('#select_all'+this.id);if(!selectAll.length){return false;}
selectAll[0].checkAllStatus=false;selectAll.bind("click",function(e){var that=this;this.checkAllStatus=!this.checkAllStatus;$('input[type=checkbox][id^=check'+pageObj.id+'_]').each(function(){this.checked=that.checkAllStatus;});if(e.stopImmediatePropagation){e.stopImmediatePropagation();}});},initGridHover:function(){if(!this.gridElem)
return false;if(Runner.pages.PageSettings.getTableData(this.tName,"isUseHighlite")==false){return false;}
this.gridElem.bind('mouseover',function(e){if($.browser.msie){$('select').mouseover(function(event){event.stopPropagation();});}
var target=Runner.Event.prototype.getTarget(e);while(target.nodeName!="TABLE"){if(target.nodeName=="TR"&&!$(target).hasClass("footer")){$(target).addClass('hovered');break;}else{target=target.parentNode;}}});this.gridElem.bind('mouseout',function(e){if($.browser.msie){$('select').mouseout(function(event){event.stopPropagation();});}
var target=Runner.Event.prototype.getTarget(e);while(target.nodeName!="TABLE"){if(target.nodeName=="TR"&&!$(target).hasClass("footer")){$(target).removeClass('hovered');break;}else{target=target.parentNode;}}});},initMaps:function(){if(!this.controlsMap.gMaps||!this.controlsMap.gMaps.isUseGoogleMap){return false;}
var initMaps=function(){this.mapManager=new Runner.controls.MapManager(this.controlsMap.gMaps);this.mapManager.init();if(this.inlineEdit){this.inlineEdit.on('afterSubmit',function(vals,fields,keys,recId){for(var i=0;i<fields.length;i++){if(this.isFieldIsMap(fields[i])){var mapDiv=this.getMapDiv("FIELD_MAP",recId,fields[i]);var span=$("#edit"+recId+"_"+fields[i]);span.html('');$(mapDiv).appendTo(span);this.initMap(mapDiv.id);}else if(this.isFieldCenterLink(fields[i])){var mapCenterLink=this.getCenterLink(recId,vals[fields[i]],this.isFieldCenterLink(fields[i]));var span=$("#edit"+recId+"_"+fields[i]);span.html('');$(mapCenterLink).appendTo(span);this.initCenterLink($(mapCenterLink));}}
this.updateAfterEdit(recId,vals);},this.mapManager);}
if(this.inlineAdd){this.inlineAdd.on('afterSubmit',function(vals,fields,keys,recId){var j=0,viewQuery="";for(key in keys){j++;viewQuery+="editid"+i+"="+keys[key];}
var recordVals={viewKey:viewQuery,recId:recId};Runner.apply(recordVals,vals);this.updateAfterAdd(recId,vals);for(var i=0;i<fields.length;i++){if(this.isFieldIsMap(fields[i])){var mapDiv=this.getMapDiv("FIELD_MAP",recId,fields[i]);var span=$("#edit"+recId+"_"+fields[i]);span.html('');$(mapDiv).appendTo(span);this.initMap(mapDiv.id);this.refreshMaps(recId,viewQuery);}else if(this.isFieldCenterLink(fields[i])){var mapCenterLink=this.getCenterLink(recId,vals[fields[i]],this.isFieldCenterLink(fields[i]));var span=$("#edit"+recId+"_"+fields[i]);span.html('');$(mapCenterLink).appendTo(span);this.initCenterLink($(mapCenterLink));}}},this.mapManager);}}
if(GlobalGmapLoader){GlobalGmapLoader.onLoad(initMaps,this);}}});Runner.pages.ListPageFly=Runner.extend(Runner.pages.ListPageCommon,{lookupCtrl:null,lookupBaseParams:null,constructor:function(cfg){Runner.pages.ListPageFly.superclass.constructor.call(this,cfg);this.listFields=Runner.pages.PageSettings.getTableData(this.tName,'listFields');this.bricksForReload=["grid","pagination","message"];this.on("afterInit",function(pageObj){this.lookupCtrl.lookupVals=this.controlsMap.lookupVals;this.lookupCtrl.initLinks(this.pageId);this.lookupCtrl.lookupSelectField=this.controlsMap.lookupSelectField;this.lookupCtrl.dispFieldAlias=this.controlsMap.dispFieldAlias;this.lookupCtrl.linkField=this.controlsMap.linkField;this.lookupCtrl.dispField=this.controlsMap.dispField;},this);var categoryValue='';if(this.lookupCtrl.parentCtrl){categoryValue=this.lookupCtrl.parentCtrl.getValue();}
this.lookupBaseParams={parId:this.lookupCtrl.pageId,table:this.lookupCtrl.table,field:this.lookupCtrl.fieldName,mode:"lookup",category:categoryValue,control:"control",editMode:this.lookupCtrl.mode,id:this.pageId};},destructor:function(){Runner.pages.ListPageFly.superclass.destructor.call(this);this.win=null;this.pageCont=null;this.lookupCtrl.pageId=-1;},init:function(){Runner.pages.ListPageFly.superclass.init.call(this);if(Runner.isMobile){this.showBricks(["search","cancelbutton_mobile"]);}
this.initSorting();this.fireEvent('afterInit',this,this.id);},initResize:Runner.emptyFn,initSearch:function(){this.searchController=new Runner.search.SearchController({id:this.pageId,tName:this.tName,fNamesArr:this.controlsMap.search.allSearchFields,shortTName:this.shortTName,usedSrch:this.controlsMap.search.usedSrch,panelSearchFields:this.controlsMap.search.panelSearchFields,ajaxSubmit:true,useSuggest:false,pageType:this.pageType});this.searchController.init(this.controlsMap.search.searchBlocks);this.searchController.srchForm.baseParams=this.lookupBaseParams;if(!Runner.isMobile){this.searchController.srchForm.on("beforeSubmit",function(form){Runner.runLoading(this.id,this.win.body);},this);}
this.searchController.on('afterSearch',function(respObj,srchController,srchForm){Runner.stopLoading();this.pageReloadHn(respObj);if(this.searchController.usedSrch){this.searchController.showShowAll();}else{this.searchController.hideShowAll();}},this);this.searchController.srchForm.on('submitFailed',function(){Runner.stopLoading();},this);},initInline:function(){if(Runner.pages.PageSettings.getTableData(this.tName,"isInlineAdd")&&this.permis['add']){this.inlineAdd=new Runner.util.inlineEditing.InlineAdd({tName:this.tName,shortTName:this.shortTName,id:this.pageId,fNames:this.listFields,rows:this.controlsMap.gridRows,inlineEditObj:this.inlineEdit,totalFields:[],lookupField:this.lookupCtrl.fieldName});if(this.lookupCtrl.parentCtrl){this.inlineAdd.categoryValue=this.lookupCtrl.parentCtrl.getValue();this.inlineAdd.lookupTable=this.lookupCtrl.parentCtrl.table;this.inlineAdd.loadSettings=true;}
this.inlineAdd.init();this.inlineAdd.on("beforeSetVals",function(row,fields,data){if(data[this.lookupCtrl.dispFieldAlias]){data[this.lookupCtrl.dispFieldAlias]='<a href="#" type="lookupSelect'+this.searchController.srchForm.baseParams.id+'">'+data[this.lookupCtrl.dispFieldAlias]+'</a>';}else if(data[this.lookupCtrl.dispField]){data[this.lookupCtrl.dispField]='<a href="#" type="lookupSelect'+this.searchController.srchForm.baseParams.id+'">'+data[this.lookupCtrl.dispField]+'</a>';}},this);this.inlineAdd.on("afterSubmit",function(vals,fields,keys){var newInd=this.lookupCtrl.addLookupVal(vals[this.lookupCtrl.linkField],vals[this.lookupCtrl.dispFieldAlias]||vals[this.lookupCtrl.dispField]);var links=$('a[type="lookupSelect'+this.searchController.srchForm.baseParams.id+'"]');if(links.length){var link=$(links[0]);this.lookupCtrl.initLink(link,newInd);}},this);}},initSorting:function(){for(var i=0;i<this.listFields.length;i++){$("#order_"+Runner.goodFieldName(this.listFields[i])+"_"+this.pageId).bind("click",{pageObj:this},function(e){Runner.Event.prototype.stopEvent(e);var pageObj=e.data.pageObj;if(!Runner.isMobile)
Runner.runLoading(this.id,pageObj.gridElem);$.ajax({url:this.href,type:"GET",success:function(respObj){pageObj.pageReloadHn.call(pageObj,respObj)},dataType:"json"});});}},initPagination:function(){$("table[name=paginationTable"+this.pageId+"]").bind("click",{pageObj:this},function(e){Runner.Event.prototype.stopEvent(e);var pageObj=e.data.pageObj;if(!Runner.isMobile)
Runner.runLoading(this.id,pageObj.gridElem);var target=Runner.Event.prototype.getTarget(e);if(target.nodeName!="A"){return false;}
var pageNum=$(target).attr("pageNum"),url=Runner.pages.getUrl(pageObj.tName,pageObj.pageType,{})+"?goto="+pageNum;$.ajax({url:url,type:"GET",success:function(respObj){pageObj.pageReloadHn.call(pageObj,respObj)},dataType:"json",data:pageObj.lookupBaseParams});});},pageReloadHn:function(respObj){Runner.stopLoading();if(respObj.success){Runner.setIdCounter(respObj.idStartFrom);this.replaceBricksHTMLWith(this.getBricksHtml(respObj.html));this.controlsMap=respObj["controlsMap"][this.tName][this.pageType][this.pageId];this.lookupCtrl.lookupVals=respObj.controlsMap[this.tName][this.pageType][this.pageId].lookupVals;this.lookupCtrl.initLinks(this.pageId);this.initGridElem();this.initPagination();this.initSorting();var gMaps=this.controlsMap.gMaps;if(this.mapManager&&gMaps&&gMaps.isUseGoogleMap){this.mapManager.init(gMaps.mapsData);}
if(this.inlineAdd){this.inlineAdd.reInit(this.controlsMap.gridRows);}
this.searchController.usedSrch=respObj.controlsMap[this.tName][this.pageType][this.pageId].search.usedSrch;if(this.searchController.usedSrch)
this.searchController.showShowAll();else
this.searchController.hideShowAll();if(YAHOO.mediaplayer&&YAHOO.mediaplayer.loadPlayerScript.bCalled&&audioLinksCount>0){if(this.gridElem){YAHOO.MediaPlayer.addTracks(this.gridElem.get(0),null,false);}else{var bricksArr=this.getBrickObjs('viewfields');for(var i=0;i<bricksArr.length;i++){YAHOO.MediaPlayer.addTracks(bricksArr[i],null,false);}}}}else{this.win.setBody("REQUEST FAILED");}}});Runner.pages.ListPage=Runner.extend(Runner.pages.ListPageCommon,{inlineEdit:null,inlineAdd:null,pageType:Runner.pages.constants.PAGE_LIST,mapManager:null,multipleHint:null,existMultipleHint:false,constructor:function(cfg){Runner.pages.ListPage.superclass.constructor.call(this,cfg);this.listFields=Runner.pages.PageSettings.getTableData(this.tName,'listFields');this.multipleHint=$(".runner-sorthint",document.body);this.isUseInlineEdit=Runner.pages.PageSettings.getTableData(this.tName,"isInlineEdit");},destructor:function(){for(var tName in this.dpObjs){this.dpObjs[tName].destructor();}
Runner.pages.ListPage.superclass.destructor.call(this);},init:function(){Runner.pages.ListPage.superclass.init.call(this);this.initButtons();this.initSorting();this.initDetails();this.initPopupLinks();this.initSection508();this.fireEvent('afterInit',this,this.id);},initSection508:function(){if(Runner.pages.PageSettings.getGlobalData("s508")){this.s508Obj=new Runner.s508({pageId:this.id,gridObj:this.gridElem,pageURL:Runner.pages.getUrl(this.tName,this.pageType,{}),maxPages:Runner.pages.PageSettings.getTableData(this.tName,"maxPages"),isUseInlineEdit:(this.isUseInlineEdit&&this.permis['edit'])});this.s508Obj.init();}},initInline:function(){var showAddInPopup=Runner.pages.PageSettings.getTableData(this.tName,"showAddInPopup")&&!Runner.isMobile,showEditInPopup=Runner.pages.PageSettings.getTableData(this.tName,"showEditInPopup")&&!Runner.isMobile,showViewInPopup=Runner.pages.PageSettings.getTableData(this.tName,"showViewInPopup")&&!Runner.isMobile;if(this.isUseInlineEdit&&this.permis['edit']||showAddInPopup||showEditInPopup||showViewInPopup){this.inlineEdit=new Runner.util.inlineEditing.InlineEdit({id:this.pageId,tName:this.tName,shortTName:this.shortTName,fNames:this.listFields,rows:this.controlsMap.gridRows,loadSettings:true});this.inlineEdit.init();}
if(Runner.pages.PageSettings.getTableData(this.tName,"isInlineAdd")&&this.permis['add']||showAddInPopup||showEditInPopup||showViewInPopup){this.inlineAdd=new Runner.util.inlineEditing.InlineAdd({id:this.pageId,tName:this.tName,shortTName:this.shortTName,fNames:this.listFields,rows:this.controlsMap.gridRows,inlineEditObj:this.inlineEdit,loadSettings:true});this.inlineAdd.init();this.inlineAdd.on("afterSubmit",function(vals,fields,keys,id,resp){var detailsBricks=this.getBrickObjs('details_found');$.each(detailsBricks,function(ind,brick){$('.runner-details_found_count',brick.elem[0]).each(function(dind,detail){var dfStr=$(detail).html();if(!parseInt(dfStr))
$(detail).html('1');else
$(detail).html(parseInt(dfStr)+1);});});if(resp.noKeys!==true){for(var tName in this.dpObjs){this.dpObjs[tName].addRow({id:id,masterKeys:resp.detKeys[tName],keys:keys});this.dpObjs[tName].getChildRecNum(resp.detKeys[tName]);}
var detTables=Runner.pages.PageSettings.getTableData(this.tName,"detailTables");for(var tName in detTables){$("#master_"+Runner.pages.PageSettings.getShortTName(tName)+"_"+id).show();}
return true;}},this);}},initDetails:function(){this.dpObjs={};var pageObj=this;if(Runner.pages.PageSettings.getTableData(this.tName,"detailTables")!=undefined){var detTables=Runner.pages.PageSettings.getTableData(this.tName,"detailTables"),isAlreadyInitPopup=false,dpParams={id:this.id,parId:this.parId||this.id,masterTName:this.tName};for(var tName in detTables){dpParams.tName=tName;dpParams.rows=this.controlsMap.gridRows.slice(0);if(detTables[tName].listShowType==Runner.pages.constants.DP_POPUP){this.dpObjs[tName]=new Runner.util.details.DPPopUp(dpParams);this.dpObjs[tName].init();if(!isAlreadyInitPopup){var dpObj=pageObj.dpObjs[tName];$('.runner-details-popup').bind('mouseover',function(){dpObj.showPopup();}).bind('mouseout',function(){dpObj.hidePopup();});isAlreadyInitPopup=true;}}else{this.dpObjs[tName]=new Runner.util.details.ListDP(dpParams);this.dpObjs[tName].init();this.dpObjs[tName].on('beforeShowDetails',function(dpObj,row){for(var tName in detTables){this.dpObjs[tName].closeDetailsByInd(row.rowInd);}},this);}}}},initButtons:function(){this.initDeleteButton();this.initRecordBlock();this.initExportLink();this.initPrintLink();this.initAddButton();this.initAdminButton();},initPopupLinks:function(){if(Runner.isMobile)
return;var pageObj=this,detTables=Runner.pages.PageSettings.getTableData(pageObj.tName,"detailTables"),masterMouseOver=function(){var startSub=$(this).attr('id').indexOf('_')+1,endSub=$(this).attr('id').lastIndexOf('_'),shortTName=$(this).attr('id').substr(startSub,endSub-startSub),tName='',row=null,rowId=$(this).attr('id').substr(endSub+1),requestUrl=shortTName+'_detailspreview.php?mastertable='+pageObj.tName;for(var detTName in detTables){if(Runner.pages.PageSettings.getShortTName(detTName)==shortTName){tName=detTName;break;}}
if(tName==''){return;}
$.each(pageObj.dpObjs[tName].rows,function(index,tRow){if(tRow.id==rowId){row=tRow;return false;}});if(row==null){return;}
$.each(row.masterKeys,function(mKey,mKeyValue){requestUrl+='&'+mKey+'='+(mKeyValue||"");});pageObj.dpObjs[tName].showPopup(this,requestUrl);};if(this.dpObjs!=undefined){$.each(this.dpObjs,function(tName,tObj){if(detTables[tName].listShowType==Runner.pages.constants.DP_NONE){return true;}
$("a[id^=\"master_"+tObj.shortTName+"\"]",pageObj.getBrickElem('grid')).each(function(ind,link){$(link).unbind('mouseover').unbind('mouseout').bind('mouseover',masterMouseOver).bind('mouseout',function(){tObj.hidePopup();});});});}},getEditRows:function(rowId){var rows=this.controlsMap.gridRows;for(var i=0;i<rows.length;i++){if((rows[i].id==rowId)&&(rows[i].isEditOwnRow)){return true;}}
return false;},initDeleteButton:function(){var pageObj=this,submitUrl=this.shortTName+"_"+this.pageType+".php";$("#delete_selected"+this.id).unbind("click").bind("click",function(e){var selBoxes=pageObj.getSelBoxes(pageObj.id);if(Runner.pages.PageSettings.getTableData(pageObj.tName,"isEditOwn")){var tempBoxes=[];$(selBoxes).each(function(index,checkBox){if(!pageObj.getEditRows($(checkBox).attr('id').substr($(checkBox).attr('id').lastIndexOf('_')+1))){$(checkBox).prop("checked",false);return true;}
tempBoxes.push(checkBox);});selBoxes=tempBoxes;}
if(selBoxes.length==0||!confirm(Runner.lang.constants.TEXT_DELETE_CONFIRM)){return false;}
var form=new Runner.form.BasicForm({standardSubmit:true,submitUrl:submitUrl,method:'POST',id:pageObj.id,baseParams:{"a":'delete'},addElems:pageObj.cloneFormElements(selBoxes)});form.submit();form.destructor();});},initExportLink:function(){var pageObj=this,submitUrl=this.shortTName+"_"+Runner.pages.constants.PAGE_EXPORT+".php";$("#export_selected"+this.id).unbind("click").bind("click",function(e){var selBoxes=pageObj.getSelBoxes(pageObj.id);if(selBoxes.length==0){return false;}
var form=new Runner.form.BasicForm({standardSubmit:true,submitUrl:submitUrl,target:'_blank',method:'POST',id:pageObj.id,addElems:pageObj.cloneFormElements(selBoxes),baseParams:{a:"export"}});form.submit();form.destructor();});},initPrintLink:function(){var pageObj=this,submitUrl=this.shortTName+"_"+Runner.pages.constants.PAGE_PRINT+".php";$("#print_selected"+this.id).unbind("click").bind("click",function(e){var selBoxes=pageObj.getSelBoxes(pageObj.id);if(selBoxes.length==0){return false;}
var form=new Runner.form.BasicForm({standardSubmit:true,submitUrl:submitUrl,target:'_blank',method:'POST',id:pageObj.id,addElems:pageObj.cloneFormElements(selBoxes),baseParams:{a:"print"}});form.submit();form.destructor();});},initRecordBlock:function(){var submitUrl=Runner.pages.getUrl(this.tName,this.pageType,{});$("#recordspp"+this.id).bind("change",function(e){document.location=submitUrl+'?pagesize='+this.options[this.selectedIndex].value;});},initAddButton:function(){var pageObj=this;if(Runner.pages.PageSettings.getTableData(this.tName,"showAddInPopup")&&!Runner.isMobile){$("#addButton"+this.id).unbind("click").bind("click",function(e){var eventParams={tName:pageObj.tName,pageType:Runner.pages.constants.PAGE_ADD,pageId:-1,destroyOnClose:true,parentPage:pageObj,modal:true,editType:Runner.pages.constants.ADD_POPUP,baseParams:{parId:pageObj.id,table:pageObj.tName,editType:Runner.pages.constants.ADD_POPUP},afterSave:{fn:function(respObj,formObj,fieldControls,addPageObj){if(respObj.success){pageObj.inlineAdd.addRowToGrid(respObj);}else{if(respObj.message){$('#message_block'+addPageObj.id).html(respObj.message);}else if(respObj.html!="-1"){addPageObj.win.setBody(respObj.html);}
$('div.bd').animate({scrollTop:0});return false;}},scope:pageObj}};Runner.Event.prototype.stopEvent(e);Runner.pages.PageManager.openPage(eventParams);});}else{$("#addButton"+this.id).bind("click",function(e){document.location=Runner.pages.getUrl(pageObj.tName,Runner.pages.constants.PAGE_ADD,{});});}},initAdminButton:function(){$("#exitAdminArea"+this.id).bind("click",function(e){document.location="menu.php";});$("#adminArea"+this.id).bind("click",function(e){document.location="admin_rights_list.php";});},initSorting:function(){var pageObj=this;for(var i=0;i<this.listFields.length;i++){$("#order_"+Runner.goodFieldName(this.listFields[i])+"_"+this.id).mouseout(function(){pageObj.delSortHint.call(pageObj);}).mousemove(function(e){pageObj.moveSortHint.call(pageObj,e);}).mouseover(function(e){pageObj.addSortHint.call(pageObj,e);}).mousedown(function(e){pageObj.multipleSortUrl(e,this.href,false);});}},multipleSortUrl:function(event,pageUrl,useAjax){var ctrlPressed=0;if(parseInt(navigator.appVersion)>3){if(navigator.appName=="Netscape"){var ua=navigator.userAgent;var isFirefox=(ua!=null&&(ua.indexOf("Firefox/")!=-1||ua.indexOf("Chrome/")!=-1));if((!isFirefox&&getNNVersionNumber()>=6)||isFirefox){ctrlPressed=event.ctrlKey;}else{ctrlPressed=((event.modifiers+32).toString(2).substring(3,6).charAt(1)=="1");}}else{ctrlPressed=event.ctrlKey;}
if(ctrlPressed){pageUrl+='&ctrl=1';if(useAjax){return pageUrl;}else{var newPage="<scr"+"ipt language=\"JavaScript\">setTimeout(\'window.location.href=\""+pageUrl+"&ctrl=1\"\', 1);</scr"+"ipt>";document.write(newPage);document.close();}
return false;}}
return'';},addSortHint:function(e){this.existMultipleHint=true;this.showSortHint(e);},setCoordinatesSortHint:function(e){var scrollX,scrollY,winDim=Runner.getWindowDimensions(),hintY=e.y||e.pageY,hintX=e.x||e.pageX;if($.browser.msie){scrollX=document.documentElement.scrollLeft;scrollY=document.documentElement.scrollTop;}else{scrollX=window.pageXOffset;scrollY=window.pageYOffset;}
if(hintX+this.multipleHint.width()>winDim.width+scrollX){hintX-=this.multipleHint.width();}
hintY+=20;if(hintY+this.multipleHint.height()>winDim.height+scrollY){hintY-=this.multipleHint.height();}
this.multipleHint.css("left",""+hintX+"px");this.multipleHint.css("top",""+hintY+"px");},showSortHint:function(e){if(!this.multipleHint.length){$(document.body).append('<span class="runner-sorthint"><b>'+Runner.lang.constants.TEXT_CTRL_CLICK+'</b></span>');this.multipleHint=$(".runner-sorthint");}
this.setCoordinatesSortHint(e);if(this.existMultipleHint){this.multipleHint.css("display","block");}},delSortHint:function(){if(this.multipleHint.length){this.multipleHint.css("display","none");this.existMultipleHint=false;}},moveSortHint:function(e){if(this.multipleHint.length){if(this.multipleHint.css('display')!="block"){return false;}
this.setCoordinatesSortHint(e);}}});Runner.pages.ListPageAjax=Runner.extend(Runner.pages.ListPage,{ajaxBaseParams:null,constructor:function(cfg){Runner.pages.ListPageAjax.superclass.constructor.call(this,cfg);this.listFields=Runner.pages.PageSettings.getTableData(this.tName,'listFields');this.ajaxBaseParams={mode:"ajax",id:this.pageId};this.bricksForReload=["details_found","page_of","grid","pagination","message"];},initSearch:function(){Runner.pages.ListPageAjax.superclass.initSearch.call(this);this.searchController.ajaxSubmit=true;this.searchController.srchForm.standardSubmit=false;this.searchController.srchForm.baseParams=this.ajaxBaseParams;var pageObj=this;this.searchController.srchForm.on("beforeSubmit",function(form){Runner.runLoading(this.id,this.gridElem);},this);this.searchController.on('afterSearch',function(respObj,srchController,srchForm){Runner.stopLoading();this.pageReloadHn(respObj);if(this.searchController.usedSrch){this.searchController.showShowAll();}else{this.searchController.hideShowAll();}},this);this.searchController.srchForm.on('submitFailed',function(){Runner.stopLoading();},this);},initRecordBlock:function(){$("#recordspp"+this.id).bind("change",{pageObj:this},function(e){var pageObj=e.data.pageObj,recsPP=$("#recordspp"+pageObj.id).val();Runner.runLoading(pageObj.id,pageObj.gridElem);$.ajax({url:Runner.pages.getUrl(pageObj.tName,pageObj.pageType,{})+"?pagesize="+recsPP,type:"GET",success:function(respObj){pageObj.pageReloadHn.call(pageObj,respObj);},dataType:"json",data:pageObj.ajaxBaseParams});});},initSorting:function(){var pageObj=this;for(var i=0;i<this.listFields.length;i++){$("#order_"+Runner.goodFieldName(this.listFields[i])+"_"+this.id).mouseout(function(){pageObj.delSortHint.call(pageObj);}).mousemove(function(e){pageObj.moveSortHint.call(pageObj,e);}).mouseover(function(e){pageObj.addSortHint.call(pageObj,e);}).mousedown(function(e){Runner.Event.prototype.stopEvent(e);Runner.runLoading(pageObj.id,pageObj.gridElem);$.ajax({url:pageObj.multipleSortUrl(e,this.href,true)||this.href,type:"GET",success:function(respObj){pageObj.pageReloadHn.call(pageObj,respObj)},dataType:"json",data:pageObj.ajaxBaseParams});}).click(function(e){Runner.Event.prototype.stopEvent(e);});}},initDeleteButton:function(){$("#delete_selected"+this.id).bind("click",{pageObj:this},function(e){Runner.Event.prototype.stopEvent(e);var pageObj=e.data.pageObj;Runner.runLoading(pageObj.id,pageObj.gridElem);var selBoxes=pageObj.getSelBoxes(pageObj.id);if(selBoxes.length==0||!confirm(Runner.lang.constants.TEXT_DELETE_CONFIRM)){Runner.stopLoading();return false;}
var form=new Runner.form.BasicForm({submitUrl:Runner.pages.getUrl(pageObj.tName,pageObj.pageType,{})+"?"+$(selBoxes).serialize(),standardSubmit:false,method:'POST',baseParams:Runner.apply({a:'delete'},pageObj.ajaxBaseParams),successSubmit:{fn:function(respObj,formObj,fieldControls){pageObj.pageReloadHn.call(pageObj,respObj);},scope:this}});form.submit();});},initPagination:function(){if(this.getBrickElem('pagination')){this.getBrickElem('pagination').bind("click",{pageObj:this},function(e){var pageObj=e.data.pageObj;Runner.Event.prototype.stopEvent(e);Runner.runLoading(pageObj.id,pageObj.gridElem);var target=Runner.Event.prototype.getTarget(e);if(target.nodeName!="A"){return false;}
$.ajax({url:Runner.pages.getUrl(pageObj.tName,pageObj.pageType,{})+"?goto="+$(target).attr("pageNum"),type:"GET",success:function(respObj){pageObj.pageReloadHn.call(pageObj,respObj)},dataType:"json",data:pageObj.ajaxBaseParams});});}},pageReloadHn:function(respObj){Runner.stopLoading();if(respObj.success){Runner.setIdCounter(respObj.idStartFrom);Runner.pages.PageSettings.addSettings(this.tName,respObj.settings,false);this.replaceBricksHTMLWith(this.getBricksHtml(respObj.html));this.controlsMap.gridRows=respObj["controlsMap"][this.tName][this.pageType][this.id].gridRows;if(this.controlsMap.gridRows.length){this.hideBrick("message");var rowIdStartFrom=this.controlsMap.gridRows[0].id;}else{this.showBrick("message");}
if(respObj.usermessage)
this.showBrick("message");if(Runner.pages.PageSettings.getTableData(this.tName,"showRows")){$("#edit_selected"+this.pageId).parent().show();$("#print_selected"+this.pageId).parent().show();$("#export_selected"+this.pageId).parent().show();$("#delete_selected"+this.pageId).parent().show();}
this.initGridElem();this.initResize();this.initDetails();this.initPopupLinks();this.initSorting();this.initHeaderCheckBox()
if(this.inlineAdd){this.inlineAdd.reInit(this.controlsMap.gridRows);}
if(this.inlineEdit){this.inlineEdit.reInit(this.controlsMap.gridRows);}
this.searchController.usedSrch=respObj.controlsMap[this.tName][this.pageType][this.id].search.usedSrch;if(this.searchController.usedSrch){this.searchController.showShowAll();}
var gMaps=respObj.controlsMap[this.tName][this.pageType][this.id].gMaps;if(this.mapManager&&gMaps&&gMaps.isUseGoogleMap){this.mapManager.init(gMaps.mapsData);}
if(Runner.pages.PageSettings.getTableData(this.tName,"isUseIbox")&&this.pageType!=Runner.pages.constants.PAGE_ADD&&this.pageType!=Runner.pages.constants.PAGE_EDIT&&this.pageType!=Runner.pages.constants.PAGE_REGISTER){init_ibox();}
if(YAHOO.mediaplayer&&YAHOO.mediaplayer.loadPlayerScript.bCalled&&this.preprocessAudioLinks()>0){if(this.gridElem){YAHOO.MediaPlayer.addTracks(this.gridElem.get(0),null,true);}else{var bricksArr=this.getBrickObjs('viewfields');for(var i=0;i<bricksArr.length;i++){YAHOO.MediaPlayer.addTracks(bricksArr[i],null,false);}}}
this.initVideo(respObj.controlsMap[this.tName][this.pageType][this.id].video);this.fireEvent('afterInit',this,this.pageId);}else{this.replaceBrickContentHTMLWith('message','Submit failed!');}}});Runner.pages.ListPageDP=Runner.extend(Runner.pages.ListPage,{baseParams:null,detCont:null,proceedToUrl:"",useChildCount:true,masterKeys:null,hideSaveButt:false,constructor:function(cfg){Runner.pages.ListPageDP.superclass.constructor.call(this,cfg);this.pageCont=$('#detailPreview'+this.id);this.addEvents("beforeSaveDetails","afterSaveDetails","afterDeleteDetails");this.baseParams=this.baseParams||{id:this.pageId};Runner.apply(this.baseParams,this.controlsMap.masterKeys);},init:function(){this.init=function(){Runner.pages.ListPageDP.superclass.init.call(this);if(this.beforeSaveDetails){this.on({'beforeSaveDetails':this.beforeSaveDetails});}
if(this.afterSaveDetails){this.on({'afterSaveDetails':this.afterSaveDetails});}
if(this.afterDeleteDetails){this.on({'afterDeleteDetails':this.afterDeleteDetails});}
if(this.saveFailed){this.on({'saveFailed':this.saveFailed});}}
this.loadFiles();},initSearch:Runner.emptyFn,initDeleteButton:function(){var submitUrl=this.shortTName+"_"+this.pageType+".php";var pageObj=this;$("#delete_selected"+this.id).unbind("click").bind("click",function(e){var selBoxes=pageObj.getSelBoxes(pageObj.id);if(selBoxes.length==0||!confirm(Runner.lang.constants.TEXT_DELETE_CONFIRM)){return false;}
var form=new Runner.form.BasicForm({standardSubmit:false,submitUrl:submitUrl+"?"+$(selBoxes).serialize(),method:'POST',id:pageObj.id,baseParams:Runner.apply({a:'delete',mode:Runner.pages.constants.MODE_LIST_DETAILS},pageObj.baseParams),successSubmit:{fn:function(respObj,formObj,fieldControls){this.fireEvent("afterDeleteDetails");this.pageReloadHn(respObj);formObj.destructor();},scope:pageObj}});form.submit();return false;});},initInline:function(){Runner.pages.ListPageDP.superclass.initInline.call(this);if(this.inlineAdd){this.inlineAdd.stopErrorNotification=true;this.inlineAdd.hideSaveButt=this.hideSaveButt;this.inlineAdd.on("beforeSubmit",function(row,inlineObj,formObj){Runner.apply(formObj.baseParams,this.masterKeys);return this.fireEvent("beforeSave",row,inlineObj,formObj);},this);this.inlineAdd.on("rowsEdited",function(allVals,fields,allKeys,allRowIds){if((this.inlineEdit&&(this.inlineEdit.recordsSaved||!this.inlineEdit.isRowsEditing()))||!this.inlineEdit){this.inlineAdd.recordsSaved=false;if(this.inlineEdit){this.inlineEdit.recordsSaved=false;}
this.fireEvent("afterSaveDetails",allVals,fields,allKeys,allRowIds);}else if(this.inlineEdit){this.inlineAdd.recordsSaved=true;}},this);this.inlineAdd.on("submitFailed",function(respObj,hnScope,formObj,fieldControls){this.fireEvent("saveFailed",respObj,formObj,fieldControls);},this);this.inlineAdd.on("beforeRequestControls",function(inlineObj,inlineEditRow,reqParams){Runner.apply(reqParams,this.masterKeys);},this);}
if(this.inlineEdit){this.inlineEdit.stopErrorNotification=true;this.inlineEdit.hideSaveButt=this.hideSaveButt;this.inlineEdit.on("beforeSubmit",function(row,inlineObj,formObj){Runner.apply(formObj.baseParams,this.masterKeys);return this.fireEvent("beforeSave",row,inlineObj,formObj);},this);this.inlineEdit.on("rowsEdited",function(allVals,fields,allKeys,allRowIds){if((this.inlineAdd&&(this.inlineAdd.recordsSaved||!this.inlineAdd.isRowsEditing()))||!this.inlineAdd){if(this.inlineAdd){this.inlineAdd.recordsSaved=false;}
this.inlineEdit.recordsSaved=false;this.fireEvent("afterSaveDetails",allVals,fields,allKeys,allRowIds);}else if(this.inlineAdd){this.inlineAdd.recordsSaved=true;}},this);this.inlineEdit.on("submitFailed",function(respObj,hnScope,formObj,fieldControls){this.fireEvent("saveFailed",respObj,formObj,fieldControls);},this);this.inlineEdit.on("beforeRequestControls",function(inlineObj,inlineEditRow,reqParams){Runner.apply(reqParams,this.masterKeys);},this);}},saveAll:function(mKeys){if(this.inlineAdd){if(mKeys){Runner.apply(this.inlineAdd.baseParams,mKeys);this.inlineAdd.baseParams['mastertable']=this.masterTName;}
this.inlineAdd.saveAll();}
if(this.inlineEdit){if(mKeys){Runner.apply(this.inlineAdd.baseParams,mKeys);this.inlineAdd.baseParams['mastertable']=this.masterTName;}
this.inlineEdit.saveAll();}},initSorting:function(){var pageObj=this;for(var i=0;i<this.listFields.length;i++){$("#order_"+Runner.goodFieldName(this.listFields[i])+"_"+this.id).mouseout(function(){pageObj.delSortHint.call(pageObj);}).mousemove(function(e){pageObj.moveSortHint.call(pageObj,e);}).mouseover(function(e){pageObj.addSortHint.call(pageObj,e);}).mousedown(function(e){Runner.Event.prototype.stopEvent(e);var url=pageObj.multipleSortUrl(e,this.href,true)||this.href;Runner.runLoading(pageObj.id,pageObj.detCont[0]);$.ajax({url:url,type:"GET",success:function(respObj){pageObj.pageReloadHn.call(pageObj,respObj)},dataType:"json",data:pageObj.baseParams});}).click(function(e){Runner.Event.prototype.stopEvent(e);});}},initPagination:function(){$("table[name=paginationTable"+this.id+"]").bind("click",{pageObj:this},function(e){Runner.Event.prototype.stopEvent(e);var pageObj=e.data.pageObj;var target=Runner.Event.prototype.getTarget(e);if(target.nodeName!="A"){return false;}
Runner.runLoading(this.id,pageObj.detCont[0]);var pageNum=$(target).attr("pageNum");var url=Runner.pages.getUrl(pageObj.tName,pageObj.pageType,{})+"?goto="+pageNum;$.ajax({url:url,type:"GET",success:function(respObj){pageObj.pageReloadHn.call(pageObj,respObj)},dataType:"json",data:pageObj.baseParams});});},pageReloadHn:function(respObj){Runner.stopLoading();if(respObj.success){Runner.setIdCounter(respObj.idStartFrom);this.detCont.html(respObj.html);this.controlsMap=respObj["controlsMap"][this.tName][this.pageType][this.pageId];if(this.controlsMap.gridRows.length){this.hideBrick("message");}else{this.showBrick("message");}
if(respObj.delMess){this.showBrick("message");}
this.initGridElem();this.initResize();this.initDetails();this.initPopupLinks();this.initPagination();this.initSelectAll();if(this.inlineAdd){this.inlineAdd.reInit(this.controlsMap.gridRows);}
if(this.inlineEdit){this.inlineEdit.reInit(this.controlsMap.gridRows);}
this.initHeaderCheckBox()
this.initSorting();this.initRunnerButtons();this.initDeleteButton();this.initGridHover();var gMaps=this.controlsMap.gMaps;if(this.mapManager&&gMaps&&gMaps.isUseGoogleMap){this.mapManager.init(gMaps.mapsData);}
if(Runner.pages.PageSettings.getTableData(this.tName,"isUseIbox")&&this.pageType!=Runner.pages.constants.PAGE_ADD&&this.pageType!=Runner.pages.constants.PAGE_EDIT&&this.pageType!=Runner.pages.constants.PAGE_REGISTER){init_ibox();}
var audioLinksCount=this.preprocessAudioLinks();if(YAHOO.mediaplayer&&YAHOO.mediaplayer.loadPlayerScript.bCalled&&audioLinksCount>0){if(this.gridElem){YAHOO.MediaPlayer.addTracks(this.gridElem.get(0),null,false);}else{var bricksArr=this.getBrickObjs('viewfields');for(var i=0;i<bricksArr.length;i++){YAHOO.MediaPlayer.addTracks(bricksArr[i],null,false);}}}
this.initVideo(this.controlsMap.video);}else{$("#message_block"+this.id).html("Submit failed!");}}});Runner.pages.ListPageMobile=Runner.extend(Runner.pages.ListPage,{morePanel:null,menuPanel:null,srchOptDivMobile:null,bricksArr:null,bricksArrList:null,constructor:function(cfg){Runner.pages.ListPageMobile.superclass.constructor.call(this,cfg);this.morePanel=$("#more"+this.id);this.menuPanel=$("#menu_mobile_"+this.id);this.srchOptDivMobile=$(".searchOptions",this.pageCont);this.bricksArr=["masterinfo_mobile","vmenu_mobile","tableinfo_mobile","search_mobile","vmenu","searchpanel","backbutton","morelink_mobile","message","grid","pagination","languages","loggedas","details_found","page_of","recsperpage","fulltext_mobile","search","cancelbutton_mobile"];this.bricksArrList=["masterinfo_mobile","vmenu_mobile","tableinfo_mobile","search_mobile","morelink_mobile","message","grid","pagination","languages","loggedas","details_found","page_of","recsperpage"]},init:function(){Runner.pages.ListPageMobile.superclass.init.call(this);this.srchOptDivMobile.show();window.location.hash="#list";var pageObj=this;if(window.addEventListener){window.addEventListener('hashchange',pageObj.handler,false);}else if(window.attachEvent){window.attachEvent('onhashchange',pageObj.handler);}},handler:function(){if(window.location.hash=='#search'){$("#search_mobile_button").click();}
if(window.location.hash=='#menu'){$("#menu_button").click();}
if(window.location.hash=='#list'){$("#backbutton").click();}},initMoreButton:function(id){if(typeof id=="undefined"){id=this.id;}
var pageObj=this;$("#morebutton").unbind("click").bind("click",function(e){if(pageObj.morePanel.css("display")=="none"){pageObj.morePanel.css("left",e.clientX-pageObj.morePanel.width()+5);pageObj.morePanel.css("top",e.clientY+5);pageObj.morePanel.css("display","block");}
return false;});},initMenuMobileButton:function(id){if(typeof id=="undefined"){id=this.id;}
var pageObj=this;$("#menu_button").unbind("click").bind("click",function(e){pageObj.hideBricks(pageObj.bricksArr);pageObj.showBricks(["vmenu","backbutton"]);});},initMoreClosePanel:function(id){if(typeof id=="undefined"){id=this.id;}
var pageObj=this;$("#more_close").unbind("click").bind("click",function(e){if(pageObj.morePanel.css("display")=="block"){pageObj.morePanel.css("display","none");}
return false;});},initBackButton:function(id){var pageObj=this;$("#backbutton").unbind("click").bind("click",function(e){pageObj.hideBricks(pageObj.bricksArr);pageObj.showBricks(pageObj.bricksArrList);});},initSearchPanelButton:function(id){if(typeof id=="undefined"){id=this.id;}
var pageObj=this;$("#search_mobile_button").unbind("click").bind("click",function(e){pageObj.hideBricks(pageObj.bricksArr);pageObj.showBricks(["searchpanel","backbutton"]);});},initRowClick:function(id){if(typeof id=="undefined"){id=this.id;}
var pageObj=this;$("tr[id^=gridRow] td").not('td[ieditcont=checkBox], td[name=details]').unbind("click").bind("click",function(e){var target=Runner.Event.prototype.getTarget(e);if(target.nodeName!="A"||!$(target).attr("query")){var trId=this.parentNode.id;$("div[id^=gridRow][name=flybutton]").each(function(){if(this.id==trId&&$(this).css("display")=="none"){$(this).css("left",e.pageX+5);$(this).css("top",e.pageY+5);$(this).css("display","block");}
else{$(this).css("display","none");}});}});},largeTextOpenerDelegate:function(e){var pageObj=this;var target=Runner.Event.prototype.getTarget(e);if(target.nodeName!="A"||!$(target).attr("query")){return false;}
Runner.Event.prototype.stopEvent(e);var query=$(target).attr("query");$.get(query,{id:this.id,rndVal:Math.random()},function(respObj){respObj=JSON.parse(respObj);var brickContent="<div class=\"runner-fulltext-content\">";if(respObj.success){brickContent+=respObj.textCont;}else{brickContent+=respObj.error||"Server error";}
brickContent+="</div>";pageObj.replaceBrickContentHTMLWith("fulltext_mobile",brickContent);pageObj.hideBricks(pageObj.bricksArr);pageObj.showBricks(["fulltext_mobile","backbutton"]);});},initButtons:function(){Runner.pages.ListPageMobile.superclass.initButtons.call(this);this.initMoreButton();this.initMenuMobileButton();this.initMoreClosePanel();this.initSearchPanelButton();this.initRowClick();this.initBackButton();}});Runner.pages.ReportPageMobile=Runner.extend(Runner.pages.ListPageMobile,{pageType:Runner.pages.constants.PAGE_REPORT,constructor:function(cfg){Runner.pages.ReportPageMobile.superclass.constructor.call(this,cfg);this.bricksArr=["masterinfo_mobile","vmenu_mobile","tableinfo_mobile","search_mobile","vmenu","searchpanel","backbutton","message","report","pagination","languages","loggedas","fulltext_mobile"];this.bricksArrList=["masterinfo_mobile","vmenu_mobile","tableinfo_mobile","search_mobile","message","report","pagination","languages","loggedas"];},init:function(){Runner.pages.ReportPageMobile.superclass.init.call(this);this.fireEvent('afterInit',this,this.id);$(this.getBrickElem('report')).bind("click",this.reportClickHn.createDelegate(this,[],true));},reportClickHn:function(e){this.largeTextOpenerDelegate(e);},getPaginationLink:function(pageNum,linkText,cls){return'<a href="#" pageNum="'+pageNum+'" '+(cls?'class="pag_n"':'')+' style="text-decoration: none;">'+linkText+'</a>';},initAdvSearch:function(){pageObj=this;$("#advButton"+this.pageId).bind("click",function(e){window.location.href=pageObj.shortTName+"_search.php?"+pageObj.initCrossTableParams();});},initCrossTableParams:function(){},initRowClick:Runner.emptyFn,initButtons:function(){this.initMenuMobileButton();this.initSearchPanelButton();this.initBackButton();}});Runner.pages.ReportPage=Runner.extend(Runner.pages.DataPageWithSearch,{pageType:Runner.pages.constants.PAGE_REPORT,init:function(){Runner.pages.ReportPage.superclass.init.call(this);this.fireEvent('afterInit',this,this.id);$(this.getBrickElem('report')).bind("click",this.reportClickHn.createDelegate(this,[],true));},reportClickHn:function(e){this.largeTextOpenerDelegate(e);},constructor:function(cfg){Runner.pages.ReportPage.superclass.constructor.call(this,cfg);},getPaginationLink:function(pageNum,linkText,cls){return'<a href="#" pageNum="'+pageNum+'" '+(cls?'class="pag_n"':'')+' style="text-decoration: none;">'+linkText+'</a>';},initAdvSearch:function(){pageObj=this;$("#advButton"+this.pageId).bind("click",function(e){window.location.href=pageObj.shortTName+"_search.php?"+pageObj.initCrossTableParams();});},initPrintFrLink:function(){pageObj=this;$("#print_"+this.pageId).bind("click",function(e){window.open(pageObj.shortTName+"_print.php?"+pageObj.initCrossTableParams(),'wPrint');});},initExcelLink:function(){pageObj=this;$("#export_to_excel"+this.pageId).bind("click",function(e){window.location.href=pageObj.shortTName+"_print.php?all=1&format=excel&"+pageObj.initCrossTableParams();});},initWordLink:function(){pageObj=this;$("#export_to_word"+this.pageId).bind("click",function(e){window.location.href=pageObj.shortTName+"_print.php?all=1&format=word&"+pageObj.initCrossTableParams();});},initPDFLink:function(){pageObj=this;$("#export_to_pdf"+this.pageId).bind("click",function(e){window.open(pageObj.shortTName+"_print.php?all=1&format=pdf&"+pageObj.initCrossTableParams(),'wPrint');});},initCrossTableParams:function(){advAttr="";shref="";shref=window.location.href;pos=shref.indexOf("&axis_x",0);if(pos>=0)
{shref=shref.substr(0,pos);pos2=shref.indexOf("a=",0);if(pos2>=0)
shref=shref.substr(pos2);}
if($("#select_group_x")[0])
{axis_x=$("#select_group_x")[0].value;axis_y=$("#select_group_y")[0].value;field=$("#select_data")[0].value;grfunc_value=0;grfunc=$("input[name=group_func]");for(i=0;i<grfunc.length;i++)
{if(grfunc[i].checked)
grfunc_value=grfunc[i].value;}
advAttr="axis_x="+axis_x+"&axis_y="+axis_y+"&field="+field+"&group_func="+grfunc_value+"&"+shref;}
return advAttr;}});Runner.pages.ChartPageMobile=Runner.extend(Runner.pages.ListPageMobile,{pageType:Runner.pages.constants.PAGE_CHART,init:function(){Runner.pages.ChartPageMobile.superclass.init.call(this);this.fireEvent('afterInit',this,this.id);},constructor:function(cfg){Runner.pages.ChartPageMobile.superclass.constructor.call(this,cfg);this.bricksArr=["masterinfo_mobile","vmenu_mobile","charttableinfo_mobile","search_mobile","vmenu","searchpanel","backbutton","message","chart","languages","loggedas"];this.bricksArrList=["masterinfo_mobile","vmenu_mobile","charttableinfo_mobile","search_mobile","message","chart","languages","loggedas"];},initButtons:function(){this.initMenuMobileButton();this.initSearchPanelButton();this.initBackButton();}});Runner.pages.ChartPage=Runner.extend(Runner.pages.DataPageWithSearch,{pageType:Runner.pages.constants.PAGE_CHART,init:function(){Runner.pages.ChartPage.superclass.init.call(this);this.fireEvent('afterInit',this,this.id);},constructor:function(cfg){Runner.pages.ChartPage.superclass.constructor.call(this,cfg);}});Runner.pages.CheckboxesPage=Runner.extend(Runner.pages.ListPage,{disableCounter:0,columnHeaders:null,rowHeaders:null,ajaxActions:null,cbxPostfix:'',rowCbxPrefix:'',groups:[''],realValues:null,defaultValues:{},constructor:function(cfg){this.ajaxActions={};this.columnHeaders=[];Runner.pages.CheckboxesPage.superclass.constructor.call(this,cfg);},init:function(){Runner.pages.CheckboxesPage.superclass.init.call(this);this.realValues=Runner.pages.PageSettings.getTableData(this.tName,"realValues");this.initGeneralControls();},initGeneralControls:function(){var pageObj=this;$('#saveBtn').click(function(){if(pageObj.isDisabledButton(this)){Runner.Event.prototype.stopEvent(e);return false;}
pageObj.saveStateToDB(pageObj.saveCheckboxesState());return false;});$('#resetBtn').click(function(e){if(pageObj.isDisabledButton(this)){Runner.Event.prototype.stopEvent(e);return false;}
pageObj.resetCheckboxes();return false;});},initOrdinaryCheckboxes:function(checkbox){var pageObj=this,saveState=function(){pageObj.checkRowAndColumn();};if(checkbox!=undefined)
$(checkbox).click(saveState);else
for(var g=0;g<pageObj.groups.length;g++){$.each(pageObj.rowHeaders,function(rIndex,rValue){var cbName='_'+rIndex+'_'+pageObj.groups[g];$.each(pageObj.columnHeaders,function(key,cheader){if($('#cb'+cheader+cbName).attr('id')!=undefined)
$('#cb'+cheader+cbName).click(saveState);});});}},initRowCheckboxes:function(){var pageObj=this,rowclick=function(){var chkBox=this;$.each(pageObj.columnHeaders,function(key,cheader){$('#cb'+cheader+'_'+$(chkBox).attr('id')+'_'+pageObj.cbxPostfix).each(function(){if(this.style.display!='none')
this.checked=$(chkBox).prop('checked');});});pageObj.checkRowAndColumn();};$('input:checkbox[name^="'+this.rowCbxPrefix+'"]').each(function(){$(this).click(rowclick);});},initHeadCheckboxes:function(){var pageObj=this,headclick=function(){var chkBox=this;$('input[id^='+$(chkBox).attr('id')+'_]').each(function(){if($(this).css('display')!='none')
$(this).prop('checked',$(chkBox).prop('checked'));});pageObj.checkRowAndColumn();};$.each(this.columnHeaders,function(key,cheader){$('#cb'+cheader).click(headclick);});},makeArrayWithIndexes:function(inputArray){var resultArray=new Object();$.each(inputArray,function(ind,element){resultArray[ind]=element;});return resultArray;},saveStateToDB:function(valuesSet){var pageObj=this;$('input:checkbox').prop('disabled',true);this.disableControls(true);$.ajax({url:'ug_group.php',type:"POST",data:{rndval:Math.random(),state:JSON.stringify(valuesSet),realValues:JSON.stringify(pageObj.rowHeaders),a:this.ajaxActions.saveState},dataType:"json",success:function(respObj){if(!respObj.success){pageObj.replaceBrickContentHTMLWith('message',respObj.error);pageObj.showBrick('message');}
else{pageObj.hideBrick('message');pageObj.defaultValues=pageObj.saveCheckboxesState();}
$('input:checkbox').prop('disabled',false);pageObj.disableControls(false);}});},checkRowAndColumn:function(){if(this.disableCounter>1)
return;var pageObj=this,colsState=[],rowsState=[];for(var i=0;i<this.columnHeaders.length;i++){$.each(this.rowHeaders,function(rIndex,rValue){if(colsState[i]==undefined)
colsState[i]=[pageObj.columnHeaders[i],true];if(rowsState[rIndex]==undefined)
rowsState[rIndex]=true;var cbxName='#cb'+pageObj.columnHeaders[i]+'_'+rIndex+'_'+pageObj.cbxPostfix;if($(cbxName).attr('id')!=undefined&&!$(cbxName).prop('checked'))
colsState[i][1]=rowsState[rIndex]=false;});}
$.each(colsState,function(key,cstate){$('#cb'+cstate[0]).prop('checked',this[1]);});$.each(rowsState,function(key,rstate){$('input:checkbox[name="'+pageObj.rowCbxPrefix+key+'"]:eq(0)').prop('checked',rstate);});}});Runner.pages.MembersPage=Runner.extend(Runner.pages.CheckboxesPage,{pageType:Runner.pages.constants.PAGE_ADMIN_MEMBERS,constructor:function(cfg){Runner.pages.MembersPage.superclass.constructor.call(this,cfg);this.rowHeaders=this.makeArrayWithIndexes(Runner.pages.PageSettings.getTableData(this.tName,"usersList"));this.columnHeaders=Runner.pages.PageSettings.getTableData(this.tName,"rightsGroups");this.rowCbxPrefix='user_';this.ajaxActions={saveOne:'saveMembership',saveRow:'saveMembershipRow',saveState:'saveMembership',saveColumn:'saveMembershipColumn'};},init:function(){Runner.pages.MembersPage.superclass.init.call(this);this.initOrdinaryCheckboxes();this.initRowCheckboxes();this.initHeadCheckboxes();this.defaultValues=this.saveCheckboxesState();},initButtons:function(){Runner.pages.MembersPage.superclass.initButtons.call(this);},saveCheckboxesState:function(){var pageObj=this,result={};$.each(pageObj.rowHeaders,function(ukey,user){$.each(pageObj.columnHeaders,function(key,group){if($('#cb'+group+'_'+ukey+'_').prop('checked')){if(result[group]==undefined)
result[group]=[];result[group].push(ukey);}});});return result;},resetCheckboxes:function(){$('input:checkbox').prop('checked',false);$.each(this.defaultValues,function(group,users){$.each(users,function(key,user){$('#cb'+group+'_'+user+'_').prop('checked',true);});});this.checkRowAndColumn();},disableControls:function(isDisable){this.disableCounter+=isDisable?1:-1;if(isDisable){this.addDisabledClass($('#resetBtn'));$('#resetBtn').prop('disabled',isDisable);}
else{if(this.disableCounter==0){this.delDisabledClass($('#resetBtn'));$('#resetBtn').prop('disabled',isDisable);}}}});Runner.pages.RightsPage=Runner.extend(Runner.pages.CheckboxesPage,{pageType:Runner.pages.constants.PAGE_ADMIN_RIGHTS,TEXT_AA_ADD_NEW_GROUP:'',TEXT_AA_RENAMEGROUP:'',renameidx:-1,groups:null,masks:[],constructor:function(cfg){Runner.pages.RightsPage.superclass.constructor.call(this,cfg);this.groups=Runner.pages.PageSettings.getTableData(this.tName,"rightsGroups");this.rowHeaders=this.makeArrayWithIndexes(Runner.pages.PageSettings.getTableData(this.tName,"rightsTables"));this.columnHeaders=['add','edt','del','lst','exp','imp','adm'];this.rowCbxPrefix='table_';this.ajaxActions={saveOne:'saveRight',saveRow:'saveRightRow',saveState:'saveRights',saveColumn:'saveTopRow'};},init:function(){Runner.pages.RightsPage.superclass.init.call(this);this.initMasks();this.initSelGroup();this.initCheckboxes();this.initRightsControls();this.defaultValues=this.saveCheckboxesState();},initSelGroup:function(){$('.group').attr('size',this.groups.length);if(!$('.group :selected')){$('.group :first').prop("selected",true);}},initMasks:function(){this.masks['add']='A';this.masks['edt']='E';this.masks['del']='D';this.masks['lst']='S';this.masks['exp']='P';this.masks['imp']='I';this.masks['adm']='M';},initRightsControls:function(){var pageObj=this;$('#saveGroupBtn').click(function(){pageObj.save();});$('#addGroupBtn').click(function(e){if(pageObj.isDisabledButton(this)){Runner.Event.prototype.stopEvent(e);return false;}
pageObj.disableGroupButtons(true);$('.group').prop('disabled',true);$('.runner-ugaddarea').show();$('.groupname').focus();$('.groupname').val(pageObj.makename(''));$('.gmessage').html(pageObj.TEXT_AA_ADD_NEW_GROUP);pageObj.renameidx=-1;});$('#delGroupBtn').click(function(e){if(pageObj.isDisabledButton(this)){Runner.Event.prototype.stopEvent(e);return false;}
pageObj.deletegroup();});$('#renGroupBtn').click(function(e){if(pageObj.isDisabledButton(this)){Runner.Event.prototype.stopEvent(e);return false;}
if($('.group option:selected').val()<0){return false;}
pageObj.disableGroupButtons(true);$('.group').prop('disabled',true);$('.runner-ugaddarea').show();$('.groupname')[0].focus();$('.groupname').val($('.group option:selected').html());$('.gmessage').html(pageObj.TEXT_AA_RENAMEGROUP);pageObj.renameidx=$('.group')[0].selectedIndex;});$('.groupname').keydown(function(event){e=event;if(!e)e=window.event;if(e.keyCode!=13){return true;}
e.cancel=true;pageObj.save();return false;});$('#cancelBtn').click(function(){pageObj.hideBrick('message');$('.runner-ugaddarea').hide();$('.group').prop('disabled',false);pageObj.disableGroupButtons(false);if(pageObj.renameidx>=0){$('.groupname').val('');}});this.initRowCheckboxes();},initCheckboxes:function(){var pageObj=this;this.initHeadCheckboxes();this.initOrdinaryCheckboxes();var fillboxes=function(){var group=$('.group :selected').val(),cbxObj=new Object();pageObj.cbxPostfix=group;$.each(pageObj.columnHeaders,function(key,rightType){cbxObj[rightType]=false;});for(var g=0;g<pageObj.groups.length;g++){$.each(pageObj.rowHeaders,function(tIndex,table){var display=false,cbName='_'+tIndex+'_'+pageObj.groups[g];if(pageObj.groups[g]==group){var tbl_uncheck=false;display=true;$.each(pageObj.columnHeaders,function(key,rightType){if($('#cb'+rightType+cbName).attr('id')!=undefined){if((!tbl_uncheck||!cbxObj[rightType])&&!$('#cb'+rightType+cbName).prop('checked')){tbl_uncheck=cbxObj[rightType]=true;}}});}
$.each(pageObj.columnHeaders,function(key,rightType){if($('#cb'+rightType+cbName)){$('#cb'+rightType+cbName).css('display',display?'':'none');}});});}
pageObj.checkRowAndColumn();pageObj.setButtonsActiveState();};$('.group').change(fillboxes);$('.group').trigger('change');},saveCheckboxesState:function(){var pageObj=this,result={};$('.group option').each(function(){var group=$(this).val();$.each(pageObj.rowHeaders,function(tkey,table){$.each(pageObj.columnHeaders,function(key,rightType){if($('#cb'+rightType+'_'+tkey+'_'+group).prop('checked')){if(result[group]==undefined){result[group]={};}
if(result[group][tkey]==undefined){result[group][tkey]='';}
result[group][tkey]+=pageObj.masks[rightType];}});});});return result;},disableControls:function(isDisable){this.disableCounter+=isDisable?1:-1;if(isDisable){this.disableGroupButtons(isDisable);this.addDisabledClass($('#resetBtn'));$('.group').prop('disabled',isDisable);}else{if(this.disableCounter==0){this.disableGroupButtons(isDisable);this.delDisabledClass($('#resetBtn'));$('.group').prop('disabled',isDisable);}}},disableGroupButtons:function(isDisable){if(isDisable){this.addDisabledClass($('#addGroupBtn'));this.addDisabledClass($('#delGroupBtn'));this.addDisabledClass($('#renGroupBtn'));}else{this.delDisabledClass($('#addGroupBtn'));$('#addGroupBtn').prop('disabled',isDisable);this.setButtonsActiveState();}},setButtonsActiveState:function(){if($('.group :selected').val()<0){this.addDisabledClass($('#delGroupBtn'));this.addDisabledClass($('#renGroupBtn'));}else{this.delDisabledClass($('#delGroupBtn'));this.delDisabledClass($('#renGroupBtn'));this.initRunnerButtons();$('.groupname').val($('.group :selected').html());}},deletegroup:function(){var pageObj=this,id=$('.group :selected').val();if(id<0){return false;}
if(!confirm(''+" "+$('.group :selected').html()+'?')){return;}
$.get('ug_group.php',{rndval:Math.random(),id:id,a:'del'},function(ret){if(ret!='ok'){pageObj.replaceBrickContentHTMLWith('message','Error deleting record!');pageObj.showBrick('message');return;}
pageObj.hideBrick('message');for(var i=0;i<pageObj.groups.length;i++)
if(pageObj.groups[i]==id){pageObj.groups.splice(i,1);break;}
var newId=$('.group :selected').prev().val();$('.group :selected').remove();if(newId){$(".group [value='"+newId+"']").attr('selected','selected');}else{$('.group :first').attr('selected','selected');}
$('.group').trigger('change');$('.group').attr('size',pageObj.groups.length);$('input[type=checkbox][id$=_'+id+']').each(function(){this.parentNode.removeChild(this);});});},resetCheckboxes:function(){var pageObj=this;$('.group option').each(function(){var group=$(this).val();$.each(pageObj.rowHeaders,function(tkey,table){$.each(pageObj.columnHeaders,function(rkey,rightType){$('#cb'+rightType+'_'+tkey+'_'+group).prop('checked',(pageObj.defaultValues[group]&&pageObj.defaultValues[group][tkey]&&pageObj.defaultValues[group][tkey].indexOf(pageObj.masks[rightType])>-1)?true:false);});});});this.checkRowAndColumn();},makename:function(group){var n=1,gr=$('.group option'),tgroup=group;while(1){for(var i=0;i<gr.length;i++){if(tgroup==$(gr[i]).html())
break;}
if(i==this.groups.length){return tgroup;}
tgroup=group+n;n++;}},save:function(){var pageObj=this;for(var i=0;i<$('.group option').length;i++){if($('.group option:eq('+i+')').html()==$('.groupname').val()&&this.renameidx!=i){pageObj.replaceBrickContentHTMLWith('message','Group with such name is allready exist!');pageObj.showBrick('message');return;}}
if(this.renameidx==-1){var oldGroup=$('.group :selected').val();$.get('ug_group.php',{rndval:Math.random(),name:$('.groupname').val(),a:'add'},function(ret){if(ret.substring(0,2)!='ok'){pageObj.replaceBrickContentHTMLWith('message','Error adding group!');pageObj.showBrick('message');return;}
pageObj.hideBrick('message');var id=ret.substring(2)
$('.runner-ugaddarea').hide();$('input[type=checkbox][id$=_-1]').each(function(){var cbid=$(this).attr('id').substring(0,$(this).attr('id').length-2);$('#'+cbid+oldGroup).hide();cbid+=id;$(this.parentNode).append('<input type="checkbox"  id="'+cbid+'" name="'+cbid+'">');pageObj.initOrdinaryCheckboxes($('#'+cbid));});pageObj.groups.push(id);$('.group').append($('<option value="'+id+'">'+$('.groupname').val()+'</option>'));$('.group :last').prop('selected',true);$('.group').attr('size',pageObj.groups.length);$('.group').trigger('change');$('.groupname').val('');$('.group').prop('disabled',false);pageObj.disableGroupButtons(false);});}else{var idx=this.renameidx;this.renameidx=-1;if($('.group :selected').html()==$('.groupname').val()){this.saveEnd();}
$.get('ug_group.php',{rndval:Math.random(),id:$(".group option:eq("+idx+")").val(),name:$('.groupname').val(),a:'rename'},function(ret){if(ret.substring(0,2)!='ok'){pageObj.replaceBrickContentHTMLWith('message','Error renaming group!');pageObj.showBrick('message');return;}
$(".group option:eq("+idx+")").html($('.groupname').val());pageObj.saveEnd();});}},saveEnd:function(){this.hideBrick('message');$('.runner-ugaddarea').hide();$('.groupname').val('');$('.group').prop('disabled',false);this.disableGroupButtons(false);}});Runner.pages.ExportPage=Runner.extend(Runner.pages.RunnerPage,{pageType:Runner.pages.constants.PAGE_IMPORT,constructor:function(cfg){Runner.pages.ExportPage.superclass.constructor.call(this,cfg);this.submitUrl=Runner.pages.getUrl(this.tName,this.pageType,{});},init:function(){Runner.pages.ExportPage.superclass.init.call(this);this.initButtons();this.fireEvent('afterInit',this,this.id);},initButtons:function(){var pageObj=this,vtype,vrecords;$("#saveButton"+this.id).bind("click",function(e){Runner.Event.prototype.stopEvent(e);$('input[type=radio][name=type]').each(function(){if($(this).prop("checked"))
vtype=$(this).val();});$('input[type=radio][name=records]').each(function(){if($(this).prop("checked"))
vrecords=$(this).val();});pageObj.form=new Runner.form.BasicForm({submitUrl:pageObj.submitUrl,standardSubmit:true,method:'POST',id:pageObj.pageId,baseParams:{type:vtype,records:vrecords}});pageObj.form.submit();pageObj.form.destructor();pageObj.form=null;});}});Runner.pages.ImportPage=Runner.extend(Runner.pages.RunnerPage,{pageType:Runner.pages.constants.PAGE_IMPORT,constructor:function(cfg){Runner.pages.ImportPage.superclass.constructor.call(this,cfg);this.submitUrl=Runner.pages.getUrl(this.tName,this.pageType,{});},init:function(){Runner.pages.ImportPage.superclass.init.call(this);this.initButtons();this.fireEvent('afterInit',this,this.id);},initButtons:function(){var pageObj=this;$("#saveButton"+this.id).bind("click",function(e){Runner.Event.prototype.stopEvent(e);var path=$("#file_ImportFileName"+pageObj.id).val();if(!path){return false;}
var wpos=path.lastIndexOf('\\');var upos=path.lastIndexOf('/');var pos=wpos;if(upos>wpos){pos=upos;}
baseParams={a:"added",id:pageObj.pageId};baseParams["value_ImportFileName"+pageObj.id]=path.substr(pos+1);baseParams["type_ImportFileName"+pageObj.id]='upload2';var form=new Runner.form.BasicForm({submitUrl:pageObj.submitUrl,standardSubmit:true,isFileUpload:true,method:'POST',baseParams:baseParams,id:pageObj.pageId,addElems:[$("#file_ImportFileName"+pageObj.id)]});form.submit();});$("#backButton"+this.id).bind("click",function(e){Runner.Event.prototype.stopEvent(e);window.location.href=Runner.pages.getUrl(pageObj.tName,Runner.pages.constants.PAGE_LIST,{})+"?a=return";});$("a[linkType=debugOpener]").bind("click",function(e){Runner.Event.prototype.stopEvent(e);$("#importDebugInfoTable"+this.recId).toggle();});}});Runner.pages.RegisterPage=Runner.extend(Runner.pages.RunnerPage,{submitUrl:"",passFieldName:'password',userFieldName:'username',emailFieldName:'email',useAsGlobal:true,constructor:function(cfg){Runner.pages.RegisterPage.superclass.constructor.call(this,cfg);this.submitUrl="register.php";this.passFieldName=Runner.pages.PageSettings.getTableData(this.tName,"passFieldName");this.userFieldName=Runner.pages.PageSettings.getTableData(this.tName,"userFieldName");this.emailFieldName=Runner.pages.PageSettings.getTableData(this.tName,"emailFieldName");},init:function(){Runner.pages.RegisterPage.superclass.init.call(this);this.initButtons();this.initControlEvents();this.setFirstFocus();this.fireEvent('afterInit',this,this.id);var ctrlNames=[this.passFieldName,this.userFieldName,this.emailFieldName];for(var i=0;i<ctrlNames.length;i++){if(ctrlNames[i]==null)
continue;var ctrl=Runner.getControl(this.pageId,ctrlNames[i]);if(ctrl){if(!ctrl.isSetValidation('IsRequired'))
ctrl.addValidation('IsRequired');}}},initButtons:function(){var pageObj=this;if(!Runner.pages.PageSettings.getTableData(this.tName,"isMobileIOS"))
$("#saveButton"+this.id).bind("click",function(e){Runner.Event.prototype.stopEvent(e);var arrcntrl=Runner.controls.ControlManager.getAt(pageObj.tName),isInvalid=false,firstInvalidIndex=-1;for(var i=0;i<arrcntrl.length;i++){if(arrcntrl[i].invalid()===true||!arrcntrl[i].validate().result){firstInvalidIndex=i;isInvalid=true;}}
if(isInvalid){arrcntrl[firstInvalidIndex].setFocus();return false;}
var form=new Runner.form.BasicForm({isFileUpload:true,submitUrl:pageObj.submitUrl,standardSubmit:true,method:'POST',baseParams:{'btnSubmit':"Register"},id:pageObj.pageId,fieldControls:Runner.controls.ControlManager.getAt(pageObj.tName)});form.submit();});else
$("#saveButton"+this.id).bind("click",function(){$("#registerForm"+pageObj.id).submit();});},initControlEvents:function(){var passctrl=Runner.controls.ControlManager.getAt(this.tName,this.id,this.passFieldName),confctrl=Runner.controls.ControlManager.getAt(this.tName,this.id,'confirm');if(confctrl)
{passctrl.on('blur',function(e,confctrl){if(confctrl.getValue()!=this.getValue()&&confctrl.getValue()!=""){confctrl.markInvalid([Runner.lang.constants.PASSWORDS_DONT_MATCH]);}else{confctrl.clearInvalid();if(!this.invalid())
this.clearInvalid();}},{args:[confctrl]});confctrl.on('blur',function(e,passctrl){if(passctrl.getValue()!=this.getValue()){this.markInvalid([Runner.lang.constants.PASSWORDS_DONT_MATCH]);}else{if(!passctrl.invalid())
passctrl.clearInvalid();this.clearInvalid();}},{args:[passctrl]});}}});Runner.search.SearchForm=Runner.extend(Runner.util.Observable,{smplSrchBox:null,simpleSrchTypeCombo:null,simpleSrchFieldsCombo:null,usedSrch:false,id:-1,tName:"",searchType:"panel",conditionRadioTop:null,srchForm:null,ctrlsShowMap:null,ajaxSubmit:false,baseParams:null,optCombosArr:null,constructor:function(cfg){this.ctrlsShowMap={};this.baseParams={};this.optCombosArr=[];Runner.apply(this,cfg);Runner.search.SearchForm.superclass.constructor.call(this,cfg);this.conditionRadioTop=$('input:radio[name=srchType]');this.smplSrchBox=$('#ctlSearchFor'+this.id);this.simpleSrchTypeCombo=$('#simpleSrchTypeCombo'+this.id);this.simpleSrchFieldsCombo=$('#simpleSrchFieldsCombo'+this.id);this.addEvents('beforeSearch','afterSearch');},init:function(ctrlsBlocks){this.initControlBlocks(ctrlsBlocks);this.initForm();this.initSuggest();this.initButtons();},initForm:function(){var method="GET";if(this.ajaxSubmit){var method="POST";}
if(this.pageType==Runner.pages.constants.PAGE_LIST||this.pageType==Runner.pages.constants.PAGE_REPORT||this.pageType==Runner.pages.constants.PAGE_CHART||this.pageType==Runner.pages.constants.PAGE_PRINT){var submitUrl=Runner.pages.getUrl(this.tName,this.pageType,{});}else{var submitUrl=this.pageType+".php";}
this.srchForm=new Runner.form.BasicForm({standardSubmit:!this.ajaxSubmit,initImmediately:true,submitUrl:submitUrl,method:method,id:this.id,addRndVal:false,baseParams:this.baseParams||{}});this.srchForm.on('successSubmit',function(respObj){this.fireEvent('afterSearch',respObj,this,this.srchForm);},this);},initCombo:function(recId,fName,map){$("#"+this.getComboId(fName,recId)).bind("change",{tName:this.tName,recId:recId,fName:fName,map:map},function(e){if(typeof e.data.map[1]=="undefined"){return false;}
var ctrl=Runner.controls.ControlManager.getAt(e.data.tName,e.data.recId,e.data.fName,e.data.map[1]);if(!ctrl){return false;}
if(this.value=='Between'||this.value=='NOT Between'){ctrl.show();}else{ctrl.hide();};});this.optCombosArr.push($("#"+this.getComboId(fName,recId)));},initButtons:function(){var searchController=this;$("#searchButtTop"+this.id).bind("click",function(e){Runner.Event.prototype.stopEvent(e);searchController.submitSearch();});$("#showAll"+this.id).bind("click",function(e){Runner.Event.prototype.stopEvent(e);searchController.showAllSubmit();});},initControlBlocks:function(ctrlsBlocks){for(var i=0;i<ctrlsBlocks.length;i++){this.addRegCtrlsBlock(ctrlsBlocks[i].fName,ctrlsBlocks[i].recId,ctrlsBlocks[i].ctrlsMap);}},initSuggest:function(){if(!this.useSuggest){return false;}
var ctrls,i,searchController=this;for(var fName in this.ctrlsShowMap){for(var recId in this.ctrlsShowMap[fName]){ctrls=Runner.controls.ControlManager.getAt(this.tName,recId);for(i=0;i<ctrls.length;i++){ctrls[i].validationArr=[];if(ctrls[i].editFormat!="Text field"){continue;}
ctrls[i].on('keyup',function(e,argsArr){var srchTypeComboId=searchController.getComboId(searchController.tName,searchController.id);var srchTypeCombo=$('#'+srchTypeComboId);var suggestUrl='searchsuggest.php?table='+searchController.shortTName;return searchSuggest_new(e,this,srchTypeCombo,'advanced',suggestUrl);},{buffer:200});ctrls[i].on('keydown',function(e,argsArr){return listenEvent(e,this.valueElem.get(0),searchController);});}
if(ctrls.length>2){return true;}}}},submitSearch:function(){this.fireEvent('beforeSearch',this,this.srchForm);this.srchForm.clearForm();this.srchForm.addToForm("a",'integrated');this.srchForm.addToForm('ctlSearchFor',this.smplSrchBox.val());this.srchForm.addToForm('simpleSrchFieldsComboOpt',this.simpleSrchFieldsCombo.val()||"");var simpleSrchTypeComboVal=this.simpleSrchTypeCombo.val();if(simpleSrchTypeComboVal&&simpleSrchTypeComboVal.indexOf('NOT')==0){simpleSrchTypeComboVal=simpleSrchTypeComboVal.substr(4);this.srchForm.addToForm('simpleSrchTypeComboNot','on');}else{this.srchForm.addToForm('simpleSrchTypeComboNot','');}
this.srchForm.addToForm('simpleSrchTypeComboOpt',simpleSrchTypeComboVal||"");for(var i=0;i<this.conditionRadioTop.length;i++){if(this.conditionRadioTop[i].checked==true){this.srchForm.addToForm('criteria',this.conditionRadioTop[i].value);break;}}
var j=1,notVal='';for(var fName in this.ctrlsShowMap){for(var ind in this.ctrlsShowMap[fName]){var fMap=this.ctrlsShowMap[fName][ind];var ctrl1=Runner.controls.ControlManager.getAt(this.tName,ind,fName,fMap[0]);if(!ctrl1.appearOnPage()){continue;}
var srchCombo=$('#'+this.getComboId(fName,ind));var comboVal=srchCombo.val();var cachedRow=$("#"+this.getFilterRowId(fName,ind,this.srchWinShowStatus));if(ctrl1.isEmpty()&&comboVal.indexOf('Empty')==-1||$(cachedRow).css('display')=='none'){continue;}
this.srchForm.addToForm('type'+j,ctrl1.ctrlType);var ctrl1Val=ctrl1.getStringValue();this.srchForm.addToForm('value'+j+'1',ctrl1Val);this.srchForm.addToForm('field'+j,fName);if(srchCombo.val().indexOf('NOT')==0){comboVal=comboVal.substr(4);}
this.srchForm.addToForm('option'+j,comboVal);var srchCheckBox=$('#'+this.getCheckBoxId(fName,ind));notVal='';if(srchCheckBox.length){notVal=srchCheckBox[0].checked?'on':'';}else{notVal=srchCombo.val().indexOf('NOT')==0?'on':'';}
this.srchForm.addToForm('not'+j,notVal);if(srchCombo.val().toLowerCase().indexOf('between')!==-1&&fMap[1]){var ctrl2=Runner.controls.ControlManager.getAt(this.tName,ind,fName,fMap[1]);var ctrl2Val=ctrl2.getStringValue();this.srchForm.addToForm('value'+j+'2',ctrl2Val);}
j++;}}
this.addCrossParams();this.usedSrch=true;this.srchForm.submit();},addCrossParams:function(){if($("#select_group_x")[0]){this.srchForm.addToForm('axis_x',$("#select_group_x")[0].value);this.srchForm.addToForm('axis_y',$("#select_group_y")[0].value);this.srchForm.addToForm('field',$("#select_data")[0].value);grfunc_value=0;grfunc=$("input[name=group_func]");if(grfunc.length){for(i=0;i<grfunc.length;i++)
{if(grfunc[i].checked)
grfunc_value=grfunc[i].value;}}
else if($("#group_func_hidden")[0]){grfunc_value=$("#group_func_hidden")[0].value;}
this.srchForm.addToForm('group_func',grfunc_value);}},addToShowMap:function(fName,ind,ctrlIndArr){!this.ctrlsShowMap[fName]?this.ctrlsShowMap[fName]={}:'';!this.ctrlsShowMap[fName][ind]?this.ctrlsShowMap[fName][ind]={}:'';this.ctrlsShowMap[fName][ind]=ctrlIndArr;},addRegCtrlsBlock:function(fName,ind,ctrlIndArr){ctrlIndArr?this.addToShowMap(fName,ind,ctrlIndArr):'';this.initCombo(ind,fName,ctrlIndArr);},getComboId:function(fName,ind){return"srchOpt_"+ind+"_"+Runner.goodFieldName(fName);},getFilterRowId:function(fName,ind){return"filter_"+ind+"_"+Runner.goodFieldName(fName);},getCheckBoxId:function(fName,ind){return"not_"+ind+"_"+Runner.goodFieldName(fName);},showAllSubmit:function(){this.srchForm.clearForm();this.srchForm.addToForm("a",'showall');this.addCrossParams();this.usedSrch=false;this.smplUsed=true;if(this.smplSrchBox)
this.smplSrchBox.val("");this.srchForm.submit();},returnSubmit:function(){this.srchForm.clearForm();this.srchForm.addToForm('a','return');this.srchForm.submit();},clearCtrls:function(){Runner.controls.ControlManager.clearControlsForTable(this.tName);for(var i=0;i<this.optCombosArr.length;i++){if(this.optCombosArr[i].length){this.optCombosArr[i].get(0).options[0].selected=true;this.optCombosArr[i].change();}}
$("input[id^=not_]").each(function(){$(this).attr('checked',false);});this.conditionRadioTop[0].checked=true;return false;}});Runner.search.SearchFormWithUI=Runner.extend(Runner.search.SearchForm,{srchOptShowStatus:false,srchWinShowStatus:false,ctrlChooseMenuStatus:false,ctrlTypeComboStatus:false,srchOptDiv:null,srchOptExpander:null,srchWinExpander:null,srchBlock:null,showAll:null,showAllButtStatus:false,srchCtrlsBlock:null,srchBlockStatus:true,ctrlChooseMenuDiv:null,hideOptSrc:"images/search/hideOptions.gif",showOptSrc:"images/search/showOptions.gif",showOptText:"Show search options",hideOptText:"Hide search options",showComboText:'Show options',hideComboText:'Hide options',searchTypeCombosArr:null,srchFilterRowArr:null,fNamesArr:null,ctrlsShowMap:null,showHideSearchComboButton:null,hider:null,pageCont:null,pageObj:null,spBgColor:'',searchBricks:null,constructor:function(cfg){this.fNamesArr=[];this.searchBricks=[];this.srchFilterRowArr=[];this.searchTypeCombosArr=[];Runner.search.SearchFormWithUI.superclass.constructor.call(this,cfg);this.pageObj=Runner.pages.PageManager.getAt(this.tName,this.id);this.spBgColor=$(this.pageObj.getBrickContentsElem('searchpanel')).css('background-color');this.searchBricks=['search','vsearch2','searchpanel'];this.srchOptDiv=$(".searchOptions",this.pageObj.pageCont);this.srchOptExpander=$("#showOptPanel"+this.id);this.srchWinExpander=$("#showSrchWin"+this.id);this.srchBlock=$("#search_block"+this.id);this.srchCtrlsBlock=$(".controlsBlock",this.pageObj.pageCont);this.showHideSearchComboButton=$('#showHideSearchType'+this.id);this.showAll=$("#showAll"+this.id);this.showAllButtStatus=this.usedSrch;this.addDelegatedEvents();},addDelegatedEvents:function(){var controller=this;$('.srchPanelRow',this.srchCtrlsBlock).each(function(){$('.srchPanelCell',this).each(function(i){switch(i){case 0:controller.setBorderToLeftCell(this);break;case 1:controller.setBorderToCenterCell(this);break;case 2:controller.setBorderToRightCell(this);break;}});});this.srchCtrlsBlock.bind('mouseover',function(e){var target=Runner.Event.prototype.getTarget(e);while(target.className!=controller.srchCtrlsBlock.attr('class')){if(target.nodeName=="TD"){var tds=$(target).parent().children();if($(tds[0]).hasClass('srchPanelCell')){$('.searchPanelButton',tds[0]).css('visibility','visible');$(tds[0]).addClass('cellBorderCenterHovered cellBorderLeftHovered').attr('style','');$(tds[1]).addClass('cellBorderCenterHovered').attr('style','');$(tds[2]).addClass('cellBorderCenterHovered cellBorderRightHovered').attr('style','');}
break;}else{target=target.parentNode;}}});this.srchCtrlsBlock.bind('mouseout',function(e){var target=Runner.Event.prototype.getTarget(e);while(target.className!=controller.srchCtrlsBlock.attr('class')){if(target.nodeName=="TD"){var tds=$(target).parent().children();if($(tds[0]).hasClass('srchPanelCell')){$('.searchPanelButton',tds[0]).css('visibility','hidden');$(tds[0]).removeClass('cellBorderCenterHovered cellBorderLeftHovered');controller.setBorderToLeftCell(tds[0]);$(tds[1]).removeClass('cellBorderCenterHovered');controller.setBorderToCenterCell(tds[1]);$(tds[2]).removeClass('cellBorderCenterHovered cellBorderRightHovered');controller.setBorderToRightCell(tds[2]);}
break;}else{target=target.parentNode;}}});},setBorderToCenterCell:function(elem){$(elem).css({'border-top':'1px dotted '+this.spBgColor,'border-bottom':'1px dotted '+this.spBgColor});},setBorderToLeftCell:function(elem){$(elem).css('border-left','1px dotted '+this.spBgColor);this.setBorderToCenterCell(elem,this.spBgColor);},setBorderToRightCell:function(elem){$(elem).css('border-right','1px dotted '+this.spBgColor);this.setBorderToCenterCell(elem);},getComboContId:function(fName,ind){return"searchType_"+ind+"_"+Runner.goodFieldName(fName);},getComboId:function(fName,id){return"srchOpt_"+id+"_"+Runner.goodFieldName(fName);},showSearchWin:function(e){this.hideCtrlChooseMenu();var x=50,y=50;if(e){y=e.y||e.pageY;x=e.x||e.pageX;}
this.pageCont=document.createElement("DIV");var width="500px",height;if($.browser.msie){height="217px";}
if(e&&e.w&&e.h){height=e.h+"px";width=e.w+"px";}
var winCfg={draggable:true,width:width,autofillheight:"body",constraintoviewport:true,xy:[x,y]};if(height){winCfg.height=height;}
this.win=new YAHOO.widget.Panel(this.pageCont,winCfg);this.win.setHeader('<span style="color: black;">Search for:&nbsp;</span>');this.win.setBody("&nbsp;");this.win.setFooter("&nbsp;");this.win.render(document.body);this.win.bringToTop();Runner.setZindexMax(this.win.cfg.getProperty('zindex'));this.win.subscribe('hide',function(eventName,args,newScope){this.hideSearchWin();},this,true);this.win.subscribe('drag',function(eventName,args,newScope){this.bringToTop();Runner.setZindexMax(this.cfg.getProperty('zindex'));});var resize=new YAHOO.util.Resize(this.pageCont,{handles:["br"],autoRatio:false,minWidth:300,minHeight:100,status:false});resize.on("startResize",function(args){if(this.cfg.getProperty("constraintoviewport")){var D=YAHOO.util.Dom,clientRegion=D.getClientRegion(),elRegion=D.getRegion(this.element);resize.set("maxWidth",clientRegion.right-elRegion.left-YAHOO.widget.Overlay.VIEWPORT_OFFSET);resize.set("maxHeight",clientRegion.bottom-elRegion.top-YAHOO.widget.Overlay.VIEWPORT_OFFSET);}else{resize.set("maxWidth",null);resize.set("maxHeight",null);}},this.win,true);resize.on("resize",function(args){var panelHeight=args.height;this.cfg.setProperty("height",panelHeight+"px");var panelWidth=args.width;this.cfg.setProperty("width",panelWidth+"px");},this.win,true);this.getBricksFromParent();this.srchOptExpander.hide();this.srchWinShowStatus=true;this.showSearchOptions();this.initWinDelButtons();},getBricksFromParent:function(){var bricksObjs=this.pageObj.getBricksObjs(this.searchBricks);if(bricksObjs['search'].length){this.cloneContainerToWin(bricksObjs['search'][0].contObj,['search']);this.cloneContainerToWin(bricksObjs['searchpanel'][0].contObj,['searchpanel']);}
else if(bricksObjs['vsearch2'].length){if(bricksObjs['vsearch2'][0].contObj.name==bricksObjs['searchpanel'][0].contObj.name){this.cloneContainerToWin(bricksObjs['searchpanel'][0].contObj,['searchpanel','vsearch2']);}else{this.cloneContainerToWin(bricksObjs['vsearch2'][0].contObj,['vsearch2']);this.cloneContainerToWin(bricksObjs['searchpanel'][0].contObj,['searchpanel']);}}},cloneContainerToWin:function(contObj,briksEx){var bricks=contObj.getBricks(),winCont=contObj.elem.clone(),winBrick=null,winBrConts=$('.runner-brickcontents',winCont);if(!winBrConts.length){$('[class*="runner-b-"]',winCont).empty();}else{winBrConts.empty();}
$('script',winCont).remove();this.win.appendToBody($(winCont).get(0));winCont=$('.runner-c-'+contObj.name,this.win.body);winCont.parent().removeClass('runner-hiddencontainer');for(var i=0;i<bricks.length;i++){winBrick=$('.runner-b-'+bricks[i].name,winCont);if(!winBrick.length){continue;}
var replace=false;for(var j=0;j<briksEx.length;j++){if(bricks[i].name==briksEx[j]){replace=true;break;}}
if(!replace){winBrick.remove();}else{this.replaceWinBrick(bricks[i],winBrick);}}},replaceWinBrick:function(parBrick,winBrick){parBrick.contentElem.wrap(function(){return'<'+this.nodeName+' class="'+this.className+'"/>';});var winBrickContent=$('.runner-brickcontents',winBrick);if(winBrickContent.length){winBrickContent.replaceWith(parBrick.contentElem);}else{winBrick.replaceWith(parBrick.contentElem);}
if(parBrick.name=='searchpanel'){winBrick.removeClass('runner-hiddenbrick');}},setBricksToParent:function(){var winBricksContents={};for(var i=0;i<this.searchBricks.length;i++){var winBrick=$('.runner-b-'+this.searchBricks[i],this.win.body);if(winBrick.length){var winBrickContent=$('.runner-brickcontents',winBrick);if(winBrickContent.length){winBricksContents[this.searchBricks[i]]=winBrickContent;}else{winBricksContents[this.searchBricks[i]]=winBrick;}}}
this.pageObj.replaceBricksContentsWith(winBricksContents);$(this.win.body).empty();},hideShowAll:function(){this.showAll.hide();this.showAllButtStatus=false;},showShowAll:function(){this.showAll.parent().show();this.showShowAll=function(){this.showAll.show();this.showAllButtStatus=true;};this.showShowAll();},toggleShowAll:function(){this.showAllButtStatus?this.hideShowAll():this.showShowAll();},hideSearchWin:function(id){this.hideCtrlChooseMenu();this.setBricksToParent();this.srchOptExpander.show();var win=this.win
setTimeout(function(){win.destroy();},5);this.srchWinShowStatus=false;},toggleSearchWin:function(e){this.srchWinShowStatus?this.hideSearchWin():this.showSearchWin(e);this.hideCtrlChooseMenu();},showSearchBlock:function(){this.srchBlock.show();this.srchBlockStatus=true;},hideSearchBlock:function(){this.srchBlock.hide();this.srchBlockStatus=false;},toggleSearchBlock:function(){(this.srchBlockStatus&&!this.srchWinShowStatus)?this.hideSearchBlock():this.showSearchBlock();},showSearchOptions:function(){if(this.srchWinShowStatus){this.pageObj.hideBrick('searchpanel');}else{this.pageObj.showBrick('searchpanel');}
this.srchOptDiv.show();$('img',this.srchOptExpander).attr('src',this.hideOptSrc);this.srchOptExpander.attr('alt',this.hideOptText);this.srchOptExpander.attr('title',this.hideOptText);this.srchOptShowStatus=true;},hideSearchOptions:function(){this.pageObj.hideBrick('searchpanel');this.srchOptDiv.hide();$('img',this.srchOptExpander).attr('src',this.showOptSrc);this.srchOptExpander.attr('alt',this.showOptText);this.srchOptExpander.attr('title',this.showOptText);this.srchOptShowStatus=false;},toggleSearchOptions:function(){(this.srchOptShowStatus&&!this.srchWinShowStatus)?this.hideSearchOptions():this.showSearchOptions();this.hideCtrlChooseMenu();},showCtrlChooseMenu:function(){if(!this.ctrlChooseMenuDiv){this.ctrlChooseMenuDiv=$(".controlChooseMenu",this.pageObj.pageCont);this.ctrlChooseMenuDiv.appendTo(document.body);}
var controller=this;var hideHandler=function(){controller.showCtrlChooseMenu();}
var hideTask=new Runner.util.DelayedTask(hideHandler);controller.ctrlChooseMenuDiv.bind('mouseover',function(e){showTask.cancel();hideTask.delay(50,hideHandler,null,[e]);});var showHandler=function(){controller.hideCtrlChooseMenu();}
var showTask=new Runner.util.DelayedTask(showHandler);controller.ctrlChooseMenuDiv.bind('mouseout',function(e){hideTask.cancel();showTask.delay(50,showHandler,null,[e]);});this.showCtrlChooseMenu=function(){var posObj=Runner.getPosition($("#showHideControlChooseMenu"+this.id)[0]),divT=posObj.top+posObj.height,divL=posObj.left;this.ctrlChooseMenuDiv.css('top',divT).css('left',divL);this.ctrlChooseMenuDiv.width()<posObj.width?this.ctrlChooseMenuDiv.css('width',posObj.width):"";this.ctrlChooseMenuDiv.show();Runner.setZindexMaxToElem(this.ctrlChooseMenuDiv);this.ctrlChooseMenuStatus=true;}
this.showCtrlChooseMenu();},hideCtrlChooseMenu:function(){if(!this.ctrlChooseMenuDiv){this.ctrlChooseMenuDiv=$(".controlChooseMenu",this.pageObj.pageCont);this.ctrlChooseMenuDiv.appendTo(document.body);}
this.ctrlChooseMenuDiv.hide();this.ctrlChooseMenuStatus=false;},toggleCtrlChooseMenu:function(){this.ctrlChooseMenuStatus?this.hideCtrlChooseMenu():this.showCtrlChooseMenu();},showCtrlTypeCombo:function(){for(var i=0;i<this.searchTypeCombosArr.length;i++){this.searchTypeCombosArr[i].show();this.searchTypeCombosArr[i].find('select').show();}
this.showHideSearchComboButton.html(this.hideComboText);this.showHideSearchComboButton.attr('title',this.hideComboText);this.ctrlTypeComboStatus=true;},hideCtrlTypeCombo:function(){for(var i=0;i<this.searchTypeCombosArr.length;i++){this.searchTypeCombosArr[i].hide();this.searchTypeCombosArr[i].find('select').hide();}
this.showHideSearchComboButton.html(this.showComboText);this.showHideSearchComboButton.attr('title',this.showComboText);this.ctrlTypeComboStatus=false;},toggleCtrlTypeCombo:function(){this.ctrlTypeComboStatus?this.hideCtrlTypeCombo():this.showCtrlTypeCombo();},toggleCrit:function(ctrlsCount){var topCritCont=$('.srchCritTop',this.pageObj.pageCont),bottomSearchButt=$('.bottomSearchButt',this.pageObj.pageCont);this.toggleCrit=function(ctrlsCount){ctrlsCount>1?topCritCont.show():topCritCont.hide();ctrlsCount>0?bottomSearchButt.show():bottomSearchButt.hide();}
this.toggleCrit(ctrlsCount);}});Runner.search.SearchController=Runner.extend(Runner.search.SearchFormWithUI,{panelStateExpires:'',ajaxSearchUrl:"",styleDispNoneText:'display: none;',shortTName:"",constructor:function(cfg){Runner.search.SearchController.superclass.constructor.call(this,cfg);this.ajaxSearchUrl=this.shortTName+'_search.php';Runner.pages.PageManager.addUnloadHn(this.rememberPanelState,this,[]);},init:function(ctrlsBlocks){Runner.search.SearchController.superclass.init.call(this,ctrlsBlocks);this.remindPanelState();this.initFastSearch();this.initAddLinks();this.initDelButtons();},initFastSearch:function(){var controller=this;if(!this.usedSrch){$("#ctlSearchFor"+this.id).bind('focus',function(e){if(controller.smplUsed!=true){this.value='';controller.smplUsed=true;$(this).css('color','');$(this).unbind(e);}});}else{$("#ctlSearchFor"+this.id).focus();}
if(this.useSuggest){$("#ctlSearchFor"+this.id).bind('keyup',function(e){searchSuggest(e,this,'ordinary','searchsuggest.php?table='+controller.shortTName,1);});$("#ctlSearchFor"+this.id).bind('keydown',function(e){return listenEvent(e,this,controller);});}},initAddLinks:function(){var controller=this;for(var i=0;i<this.fNamesArr.length;i++){$("#addSearchControl_"+Runner.goodFieldName(this.fNamesArr[i])).bind("click",{fName:this.fNamesArr[i]},function(e){Runner.Event.prototype.stopEvent(e);controller.addFilter(e.data.fName);controller.hideCtrlChooseMenu();});};},initDelButtons:function(){var srchController=this;this.srchCtrlsBlock.bind('click',function(e){var target=Runner.Event.prototype.getTarget(e);if(target&&target.nodeName!="IMG"||!$(target).attr("fName")){return;}
Runner.Event.prototype.stopEvent(e);var fName=$(target).attr("fName"),ctrlId=parseInt($(target).attr("ctrlId"));for(var i=0;i<srchController.fNamesArr.length;i++){if(fName==Runner.goodFieldName(srchController.fNamesArr[i])){fName=srchController.fNamesArr[i];break;}}
srchController.delCtrl(fName,ctrlId);});},initWinDelButtons:function(){var srchController=this;$(this.win.body).bind('click',function(e){var target=Runner.Event.prototype.getTarget(e);if(target&&target.nodeName!="IMG"||!$(target).attr("fName")){return;}
Runner.Event.prototype.stopEvent(e);var fName=$(target).attr("fName"),ctrlId=parseInt($(target).attr("ctrlId"));for(var i=0;i<srchController.fNamesArr.length;i++){if(fName==Runner.goodFieldName(srchController.fNamesArr[i])){fName=srchController.fNamesArr[i];break;}}
srchController.delCtrl(fName,ctrlId);});},initButtons:function(){Runner.search.SearchController.superclass.initButtons.call(this);var searchController=this;$("#showOptPanel"+this.id).bind("click",function(e){Runner.Event.prototype.stopEvent(e);searchController.toggleSearchOptions();});$("#showSrchWin"+this.id).bind("click",function(e){Runner.Event.prototype.stopEvent(e);searchController.toggleSearchWin(e);});$("#searchButton"+this.id).bind("click",function(e){searchController.submitSearch();});$("#showHideSearchType"+this.id).bind("click",function(e){Runner.Event.prototype.stopEvent(e);searchController.toggleCtrlTypeCombo();});$("#showHideControlChooseMenu"+this.id).bind("click",function(e){Runner.Event.prototype.stopEvent(e);searchController.toggleCtrlChooseMenu();});},hideShowAll:function(){Runner.search.SearchController.superclass.hideShowAll.call(this);this.smplSrchBox.val("");},getLastAddedInd:function(filterName){if(!this.ctrlsShowMap[filterName]){return false;}
var maxInd=0,beforeMaxInd=false,i=0;for(var ind in this.ctrlsShowMap[filterName]){ind=parseInt(ind);if(maxInd<ind){beforeMaxInd=maxInd;maxInd=ind;}
if(i===0){beforeMaxInd=maxInd;}
i++;}
return beforeMaxInd;},getLastAdded:function(filterName){var beforeMaxInd=this.getLastAddedInd(filterName);if(!beforeMaxInd){return false;}
var filterObj=$('#'+this.getFilterRowId(filterName,beforeMaxInd));if(filterObj.length){return filterObj;}else{return false;}},addCtrlsHtml:function(fName,ind,blockHTML){this.addPanelHtml(fName,ind,blockHTML);var rowCont=$('#'+this.getFilterRowId(fName,ind,this.srchWinShowStatus))
var cells=rowCont.children();$(cells[0]).html(blockHTML.delButt);$(cells[2]).html(blockHTML.comboHtml+blockHTML.control1+blockHTML.control2);eval(blockHTML.jsCode);},addPanelHtml:function(fName,ind,blockHTML){var newSrchCtrlContId=this.getFilterRowId(fName,ind);var filterRowHtml=this.createTableRow(newSrchCtrlContId,'srchPanelRow',this.styleDispNoneText,'');this.srchCtrlsBlock.append(filterRowHtml);var newSrchCtrlCont=$("#"+newSrchCtrlContId);newSrchCtrlCont.append(this.createTableCell('srchPanelCell','',''));var fNameCellHtml=this.createTableCell('srchPanelCell','',blockHTML.fLabel+':&nbsp;');newSrchCtrlCont.append(fNameCellHtml);var comboHtml=this.createTableCell('srchPanelCell srchPanelCell2',(this.ctrlTypeComboStatus?'':this.styleDispNoneText),'');newSrchCtrlCont.append(comboHtml);return newSrchCtrlCont;},addRegCtrlsBlock:function(fName,ind,ctrlIndArr,blockHTML){blockHTML?this.addCtrlsHtml(fName,ind,blockHTML):"";Runner.search.SearchController.superclass.addRegCtrlsBlock.call(this,fName,ind,ctrlIndArr);var ctrl=Runner.controls.ControlManager.getAt(this.tName,ind,fName);if(!ctrl.hidden){this.setDependences(ctrl);}
this.searchTypeCombosArr.push($("#"+this.getComboContId(fName,ind)));this.srchFilterRowArr.push($("#"+this.getFilterRowId(fName,ind)));this.toggleCrit(this.getVisibleBlocksCount());},createTableRow:function(id,cssClass,style,innerHtml){return'<tr class="'+cssClass+'" id="'+id+'" style="'+style+'">'+innerHtml+'</tr>';},createTableCell:function(cssClass,style,innerHtml){return'<td class="'+cssClass+'" style="'+style+'">'+innerHtml+'</td>';},putCachedBlock:function(filterName,cachedInd,parentFieldName){var cachedRow=$("#"+this.getFilterRowId(filterName,cachedInd));var lastAdded=this.getLastAdded(filterName);if(parentFieldName&&this.getLastAdded(parentFieldName)){cachedRow.insertAfter(this.getLastAdded(parentFieldName));}else if(lastAdded&&$(lastAdded).attr("id")!=$(cachedRow).attr("id")){cachedRow.insertBefore(lastAdded);}else{this.srchCtrlsBlock.prepend(cachedRow);}
cachedRow.show();},createLoadingBox:function(filterName){var loadingTxt='&nbsp;&nbsp;'+filterName+':&nbsp;loading&nbsp;...&nbsp;';var loadTr=document.createElement('TR');var loadTd=document.createElement('TD');$(loadTd).attr('colspan','3').addClass('cellBorderRightHovered').addClass('cellBorderLeftHovered').addClass('cellBorderCenterHovered').html(loadingTxt);$(loadTr).addClass('srchPanelRow').append(loadTd);return loadTr;},putLoadingBox:function(loadBox,filterName){var lastAdded=this.getLastAdded(filterName);if(lastAdded){$(loadBox).insertBefore(lastAdded);}else{this.srchCtrlsBlock.append($(loadBox));}},setDependences:function(ctrl,triggerReload){if(!ctrl.isLookupWizard){return false;}
if(!ctrl.parentFieldName)
return false;if(!ctrl.parentFieldName||!this.ctrlsShowMap[ctrl.parentFieldName]){ctrl.reload();return false;}
var parentInd=this.getLastAddedInd(ctrl.parentFieldName);if(!this.ctrlsShowMap[ctrl.parentFieldName][parentInd]){return false;}
var parentCtrl=Runner.controls.ControlManager.getAt(this.tName,parentInd,ctrl.parentFieldName,this.ctrlsShowMap[ctrl.parentFieldName][parentInd][0]);if(parentCtrl.showStatus&&parentCtrl.isLookupWizard){ctrl.setParentCtrl(parentCtrl);parentCtrl.addDependentCtrls([ctrl]);if(triggerReload===true){parentCtrl.fireEvent('change');}else{ctrl.preload(ctrl.preloadData.vals,ctrl.preloadData.fVal);}}else{ctrl.reload();}
return true;},getShownFilterNames:function(){var fNamesArr=[];for(var fName in this.ctrlsShowMap){var cachedInd=0;for(var ind in this.ctrlsShowMap[fName]){ind=parseInt(ind);if($("#"+this.getFilterRowId(fName,ind)).css('display')!='none'){fNamesArr.push(fName);}}}
return fNamesArr;},showCached:function(filterName){if(!this.ctrlsShowMap[filterName]){return false;}
var cachedInd=0;for(var ind in this.ctrlsShowMap[filterName]){ind=parseInt(ind);cachedInd=cachedInd<ind?ind:cachedInd;}
if($("#"+this.getFilterRowId(filterName,cachedInd)).css('display')!='none'){return false;}
var cachedCtrlIndArr=this.ctrlsShowMap[filterName][cachedInd];var objIndForCM,parentFieldName,parentCtrl=null,parentInd=false,ctrl1;for(var i=0;i<cachedCtrlIndArr.length;i++){objIndForCM=cachedCtrlIndArr[i];var ctrlFromCache=Runner.controls.ControlManager.getAt(this.tName,cachedInd,filterName,objIndForCM);if(i===0){ctrl1=ctrlFromCache;ctrl1.show();}
parentFieldName=ctrlFromCache.parentFieldName;this.setDependences(ctrlFromCache,true);ctrlFromCache.spanContElem.find('script').remove();}
this.putCachedBlock(filterName,cachedInd,parentFieldName);if(this.ctrlTypeComboStatus){$("#"+this.getComboContId(filterName,cachedInd)).show();}
if(!this.srchWinShowStatus){ctrl1.setFocus();}
return true;},addFilter:function(filterName){var isShown=this.showCached(filterName);if(!isShown){var loadBox=this.createLoadingBox(filterName);this.putLoadingBox(loadBox,filterName);}else{this.ctrlTypeComboStatus?this.showCtrlTypeCombo():this.hideCtrlTypeCombo();}
var ajaxParams={searchControllerId:this.id,rndval:Math.random(),mode:"inlineLoadCtrl",ctrlField:filterName,id:Runner.genId(),isNeedSettings:!Runner.pages.PageSettings.checkSettings(this.tName,filterName)};var controller=this;$.getJSON(this.ajaxSearchUrl,ajaxParams,function(ctrlJSON,queryStatus){controller.addRegCtrlsBlock(filterName,ctrlJSON.divInd,(ctrlJSON.control2?[0,1]:[0]),ctrlJSON);if(!Runner.pages.PageSettings.checkSettings(controller.tName,filterName)){Runner.pages.PageSettings.addSettings(controller.tName,ctrlJSON.settings);}
var ctrl;for(var i=0;i<ctrlJSON.ctrlMap.length;i++){ctrl=Runner.controls.ControlFabric(ctrlJSON.ctrlMap[i]);if(controller.useSuggest){ctrl.on('keyup',function(e,argsArr){var srchTypeComboId=controller.getComboId(controller.tName,controller.id);var srchTypeCombo=$('#'+srchTypeComboId);var suggestUrl='searchsuggest.php?table='+controller.shortTName;return searchSuggest_new(e,this,srchTypeCombo,'advanced',suggestUrl);},{buffer:200});ctrl.on('keydown',function(e,argsArr){return listenEvent(e,this.valueElem.get(0),controller);});}}
if(!isShown){controller.showCached(filterName);$(loadBox).remove();controller.toggleCrit(controller.getVisibleBlocksCount());controller.ctrlTypeComboStatus?controller.showCtrlTypeCombo():controller.hideCtrlTypeCombo();}});},delCtrl:function(fName,ctrlId){var objIndForCM,ctrl;for(var i=0;i<this.ctrlsShowMap[fName][ctrlId].length;i++){objIndForCM=this.ctrlsShowMap[fName][ctrlId][i];ctrl=Runner.controls.ControlManager.getAt(this.tName,ctrlId,fName,objIndForCM);if(ctrl.isLookupWizard){ctrl.clearChildrenLinks(true);}
Runner.controls.ControlManager.unregister(this.tName,ctrlId,fName,objIndForCM);}
this.removeComboById(this.getComboContId(fName,ctrlId));this.removeFilterById(this.getFilterRowId(fName,ctrlId));this.toggleCrit(this.getVisibleBlocksCount());delete this.ctrlsShowMap[fName][ctrlId];if(this.useSuggest)
DestroySuggestDiv();},removeFilterById:function(id){var elemInd=this.srchFilterRowArr.getIndexOfElem(id,function(val,elem){return elem.attr('id')==val;});if(elemInd!==-1){this.srchFilterRowArr[elemInd].remove();this.srchFilterRowArr.splice(elemInd,1);}},removeComboById:function(id){var elemInd=this.searchTypeCombosArr.getIndexOfElem(id,function(val,elem){return elem.attr('id')==val;});if(elemInd!==-1){this.searchTypeCombosArr.splice(elemInd,1);}},getVisibleBlocksCount:function(){var visCount=0;var rowArr=this.srchFilterRowArr;for(var i=0;i<rowArr.length;i++){if(rowArr[i].css('display')!='none'){visCount++;}}
return visCount;},submitSearch:function(){this.rememberPanelState();if(!this.usedSrch&&!this.smplUsed){this.smplSrchBox.val('');}
Runner.search.SearchController.superclass.submitSearch.call(this);},resetCtrls:function(){var objIndForCM;for(var fName in this.ctrlsShowMap){for(var ind in this.ctrlsShowMap[fName]){for(var i=0;i<this.ctrlsShowMap[fName][ind].length;i++){objIndForCM=this.ctrlsShowMap[fName][ind][i];var ctrl=Runner.controls.ControlManager.getAt(this.tName,this.id,fName,objIndForCM);ctrl.reset();}}}
return false;},rememberPanelState:function(){var cutFrom=document.location['pathname'].lastIndexOf('/',1);var cookieRoot=document.location['pathname'].substr(0,(cutFrom+1));var panelStateObj={srchPanelOpen:this.srchOptShowStatus,srchCtrlComboOpen:this.ctrlTypeComboStatus,srchWinOpen:this.srchWinShowStatus,openFilters:[]};if(this.srchWinShowStatus){panelStateObj.winState={x:this.win.cfg.getProperty("x"),clientX:this.win.cfg.getProperty("x"),clientY:this.win.cfg.getProperty("y"),y:this.win.cfg.getProperty("y"),h:parseInt(this.win.cfg.getProperty("height")),w:parseInt(this.win.cfg.getProperty("width"))};}
if(!this.usedSrch){panelStateObj.openFilters=this.getShownFilterNames();}
var searchPanel={};searchPanel['panelState_'+this.shortTName+'_'+this.id]=panelStateObj;var panelStateString=JSON.stringify(searchPanel);set_cookie('searchPanel',panelStateString,this.panelStateExpires,cookieRoot,'','');},remindPanelState:function(){var panelStateString=get_cookie('searchPanel');var panelStateObj=null;if(panelStateString&&panelStateString.length)
{var searchPanel=JSON.parse(panelStateString);if(searchPanel['panelState_'+this.shortTName+'_'+this.id]!=undefined)
panelStateObj=searchPanel['panelState_'+this.shortTName+'_'+this.id];}
if(!panelStateObj){if(this.panelSearchFields.length){this.showSearchOptions();}
return;}
if(panelStateObj.srchWinOpen){this.hideSearchOptions();this.showSearchWin(panelStateObj.winState);}else if(panelStateObj.srchPanelOpen){this.showSearchOptions();}
if(panelStateObj.srchCtrlComboOpen){this.showCtrlTypeCombo();}else{this.hideCtrlTypeCombo();}
if(!this.usedSrch){for(var i=0;i<this.panelSearchFields.length;i++){var elemIndex=panelStateObj.openFilters.getIndexOfElem(this.panelSearchFields[i]);if(elemIndex!=-1){panelStateObj.openFilters.splice(elemIndex,1);}}
for(var i=0;i<panelStateObj.openFilters.length;i++){this.addFilter(panelStateObj.openFilters[i]);}}},getFieldIds:function(fName){var idsArr=[];if(this.ctrlsShowMap[fName]){for(var id in this.ctrlsShowMap[fName]){idsArr.push(id);}}
return idsArr;},getFieldControls:function(fName){var ctrlsArr=[],ctrl=null,idsArr=this.getFieldIds(fName);for(var i=0;i<idsArr.length;i++){ctrl=Runner.controls.ControlManager.getAt(this.tName,idsArr[i],fName);ctrlsArr.push(ctrl);}
return ctrlsArr;},getSecondControl:function(fName,id){return Runner.controls.ControlManager.getAt(this.tName,id,fName,1);},getFieldOptions:function(fName){var optsArr=[],opt=null,idsArr=this.getFieldIds(fName);for(var i=0;i<idsArr.length;i++){opt=$('#'+this.getComboId(fName,idsArr[i])).get(0);optsArr.push(opt);}
return optsArr;}});Runner.namespace('Runner.form');Runner.form.BasicForm=function(cfg){this.fieldControls=[];this.fields=[];this.addElems=[];this.ajaxForm={};this.baseParams={};Runner.apply(this,cfg);this.addEvents('beforeSubmit','successSubmit','submitFailed','validationFailed');if(this.beforeSubmit){this.on({'beforeSubmit':this.beforeSubmit});}
if(this.successSubmit){this.on({'successSubmit':this.successSubmit});}
if(this.submitFailed){this.on({'submitFailed':this.submitFailed});}
if(this.validationFailed){this.on({'validationFailed':this.validationFailed});}
Runner.form.BasicForm.superclass.constructor.call(this.cfg);if(cfg.initImmediately){this.initForm();}};Runner.form.BasicForm=Runner.extend(Runner.form.BasicForm,Runner.util.Observable,{fields:null,fieldControls:null,addElems:null,isFileUpload:false,standardSubmit:false,formEl:null,ioEl:null,ioElId:'',submitUrl:'',method:'GET',id:-1,baseParams:null,tName:'',shortTName:'',target:'',ajaxForm:null,autoValidation:true,addRndVal:true,useMultipart:false,initControls:function(){},destructor:function(leaveControls){if(leaveControls===true){for(var i=0;i<this.fieldControls.length;i++){this.fieldControls[i].unregister();}}
if(this.ioEl){var iframe=this.ioEl;setTimeout(function(){$(iframe).remove();},0);}
if(this.formEl){$(this.formEl).remove();}},submit:function(){this.triedToSubmit=true;var beforeSubmitRes=this.fireEvent('beforeSubmit',this);if(beforeSubmitRes===false){return false;}
if(!this.validate()){return false;};if(this.isFileUpload||this.standardSubmit){this.initForm();this.addFormSubmit();this.formEl.submit();}else{this.addFormSubmit();var formObj=this;$.ajax({url:this.submitUrl,type:this.method,data:this.ajaxForm,success:function(data,textStatus,XMLHttpRequest){var respObj=JSON.parse(data);formObj.fireEvent("successSubmit",respObj,formObj,formObj.fieldControls);},error:function(XMLHttpRequest,textStatus,errorThrown){formObj.fireEvent("successFailed",respObj,formObj,formObj.fieldControls);}});}
return true;},initForm:function(){if(this.isFormReady){return;}
if(this.isFileUpload&&!this.standardSubmit){this.createIFrame();this.createForm();}else if(this.standardSubmit){this.createForm();}
this.isFormReady=true;},clearForm:function(){if(this.formEl){$(this.formEl).children().remove();}
this.ajaxForm={};return true;},addFormSubmit:function(){if(this.addRndVal){this.baseParams["rndVal"]=Math.random();}
if(this.formEl){var arrClns;for(var i=0;i<this.fieldControls.length;i++){arrClns=this.fieldControls[i].getForSubmit();for(var j=0;j<arrClns.length;j++){$(arrClns[j]).appendTo(this.formEl);}}
for(var param in this.baseParams){this.addToForm(param,this.baseParams[param]);}
for(var i=0;i<this.addElems.length;i++){$(this.addElems[i]).appendTo(this.formEl);}}else{this.ajaxForm=Runner.apply(this.ajaxForm,this.baseParams);for(var i=0;i<this.fieldControls.length;i++){this.ajaxForm[this.fieldControls[i].fieldName]=this.fieldControls[i].getStringValue();}
for(var i=0;i<this.addElems.length;i++){$(this.addElems[i]).appendTo(this.formEl);this.addToForm(this.addElems[i].attr("id")||this.addElems[i].attr("name"),this.addElems[i].val());}}
return true;},addToForm:function(id,val){if(typeof val=='undefined'||typeof id=='undefined'||val===null||id===null){return false;}
if(this.isFileUpload||this.standardSubmit){if(!this.formEl){this.initForm();}
var formElem=document.createElement('INPUT');$(formElem).attr('type','hidden').attr('name',id).attr('id',id).val(val.toString()).appendTo(this.formEl);}else{this.ajaxForm[id]=val;}},addElemToForm:function(el){if(!el){return false;}
if($(el).attr("id")===""){return false;}
if(this.isFileUpload||this.standardSubmit){if(!this.formEl){return false;}
$(el).appendTo(this.formEl);}else{this.ajaxForm[$(el).attr("id")]=$(el).val();}},validate:function(){if(!this.autoValidation){return true;}
var vRes,controlsArr=[];for(var i=0;i<this.fieldControls.length;i++){vRes=this.fieldControls[i].validate();if(!vRes.result){controlsArr.push(this.fieldControls[i]);}}
if(controlsArr.length){controlsArr[0].setFocus();this.fireEvent("validationFailed",this,this.fieldControls,controlsArr);return false;}else{return true;}},createIFrame:function(){if(this.ioEl){return false;}
var frameId='uploadFrame_'+this.id;if(Runner.isIE){this.ioEl=document.createElement('<iframe id="'+frameId+'" name="'+frameId+'" />');if(Runner.isSecure){this.ioEl.src='javascript:false';}}
else{this.ioEl=document.createElement('iframe');this.ioEl.id=frameId;this.ioEl.name=frameId;}
this.ioEl.style.position='absolute';this.ioEl.style.top='-1000px';this.ioEl.style.left='-1000px';document.body.appendChild(this.ioEl);var basicForm=this;$(this.ioEl).bind('load',function(e){var iframeNode=$("#"+frameId)[0],ioDoc;if(iframeNode.contentDocument){ioDoc=iframeNode.contentDocument;}else if(iframeNode.contentWindow){ioDoc=iframeNode.contentWindow.document;}else{ioDoc=iframeNode.document;}
if(ioDoc.body.innerHTML!=''){try{var response=$(ioDoc.body.innerHTML).text()
var responseObj=JSON.parse(response);}catch(e){basicForm.fireEvent('submitFailed',ioDoc.body.innerHTML,basicForm,basicForm.fieldControls);return;}
basicForm.fireEvent('successSubmit',responseObj,basicForm,basicForm.fieldControls);}else{basicForm.fireEvent('submitFailed',{},basicForm,basicForm.fieldControls);}});this.ioElId=frameId;return this.ioEl;},createForm:function(){if(this.formEl){return false;}
this.formEl=document.createElement('FORM');this.formEl.action=this.submitUrl;this.formEl.method=this.method;if(this.target){this.formEl.target=this.target;}
$(this.formEl).css('display','none');if(this.isFileUpload||this.useMultipart){$(this.formEl).attr('enctype','multipart/form-data');}
if(this.ioEl){$(this.formEl).attr('target',this.ioElId);}
document.body.appendChild(this.formEl);return this.formEl;},makeReadonly:function(){for(var i=0;i<this.fieldControls.length;i++){this.fieldControls[i].makeReadonly();}}});Runner.namespace('Runner.util.details');Runner.util.details.DP=Runner.extend(Runner.util.Observable,{tName:"",shortTName:"",masterTName:"",masterShortTName:"",ajaxRequestUrl:"",pageType:"",id:0,parId:1,constructor:function(cfg){Runner.apply(this,cfg);Runner.util.details.DP.superclass.constructor.call(this,cfg);this.shortTName=Runner.pages.PageSettings.getShortTName(this.tName);this.masterShortTName=Runner.pages.PageSettings.getShortTName(this.masterTName);this.ajaxRequestUrl=this.shortTName+"_"+this.pageType+".php";},init:function(){}});Runner.util.details.ListDP=Runner.extend(Runner.util.details.DP,{rows:null,mainMasterPageType:"",recsPerRowList:1,hideChild:false,constructor:function(cfg){this.rows=[];this.pageType=Runner.pages.constants.PAGE_LIST;Runner.util.details.ListDP.superclass.constructor.call(this,cfg);this.addEvents("beforeShow","afterShow");this.recsPerRowList=Runner.pages.PageSettings.getTableData(this.masterTName,"recsPerRowList");this.hideChild=Runner.pages.PageSettings.getTableData(this.masterTName,"detailTables")[this.tName]['hideChild']==1;},init:function(){Runner.util.details.ListDP.superclass.init.call(this);this.initRows();var mainPage=Runner.pages.PageManager.getById(this.parId);if(mainPage){this.mainMasterPageType=mainPage.pageType;}},initRows:function(){for(var i=0;i<this.rows.length;i++){this.rows[i]=Runner.apply({},this.rows[i]);this.initRow(this.rows[i]);}},initRow:function(row,setHref){if(!row.row){row.row=$("#gridRow"+row.id);if(!row.row.length){row.row=$("#master_"+this.shortTName+row.id);}
if(!row.row.length){row.row=$("#"+this.shortTName+"_preview"+row.id).closest('tr[id^=gridRow]');}}
row.masterKeys=row.masterKeys[this.tName]||row.masterKeys;this.initLink(row,setHref);this.getDetailLinkId(row);},getDetailLinkId:function(row){if(this.recsPerRowList>1){row.detLinksId=[];var pattern=this.shortTName+"_preview";$("a[id^="+this.shortTName+"_preview]",row.row).each(function(){row.detLinksId.push(this.id.substr(pattern.length));});}},initLink:function(row,setHref){var dpObj=this;if(!Runner.isMobile)
$("#"+this.shortTName+"_preview"+row.id).bind("click",{row:row},function(e){Runner.Event.prototype.stopEvent(e);if(row.isShown){dpObj.closeDetails(null,row);}else{dpObj.getDetails(e.data.row);}});if(setHref===true){var href=Runner.pages.getUrl(this.tName,this.pageType,row.masterKeys,"masterkey")+"&mastertable="+this.masterShortTName;$("#"+this.shortTName+"_preview"+row.id).attr('href',href);}},addRow:function(row){this.rows.push(row);row.rowInd=this.rows.length-1;this.initRow(row,true);var childRecNum=this.getChildCountBySameKeys(row);this.setChildRecNum(row,childRecNum);},getChildCountBySameKeys:function(row){var mKeysAsString=JSON.stringify(row.masterKeys);for(var i=0;i<this.rows.length;i++){if(this.rows[i].id!=row.id&&mKeysAsString==JSON.stringify(this.rows[i].masterKeys)){return this.rows[i].childNum;}}
return"0";},getDetails:function(row){if(row.isShown===true||row.startRequest===true){return false;}
this.fireEvent('beforeShowDetails',this,row);row.startRequest=true;var params=this.getParams(row);$.get(this.ajaxRequestUrl,params,this.showDetails.createDelegate(this,[row,params],1));},getParams:function(row){return Runner.apply({id:Runner.genId(),mode:Runner.pages.constants.MODE_LIST_DETAILS,rndVal:Math.random(),mastertable:this.masterTName,masterid:this.id,masterpagetype:this.pageType,mainmasterpagetype:this.mainMasterPageType},row.masterKeys);},createPreviewRow:function(row){if(this.recsPerRowList>1){var nextGridRow=row.row.next();if(nextGridRow.hasClass('runner-dpreviewrow')){row.detTr=nextGridRow;row.detTd=$("#"+this.masterShortTName+"_previewcell"+row.id,row.detTr);}else{row.detTr=$(document.createElement("TR")).addClass('runner-dpreviewrow');var colSpanArr=[];var start=0,i=0;row.row.children('td').each(function(){if($(this).attr("colid")=="endrecord"){colSpanArr[colSpanArr.length]=i-start;start=i+1;}
i++;});colSpanArr[colSpanArr.length]=i-start;row.row.after(row.detTr);for(var i=0;i<colSpanArr.length;i++){$(document.createElement("TD")).addClass('runner-dpinline ').attr('colspan',colSpanArr[i]).attr('id',this.masterShortTName+"_previewcell"+row.detLinksId[i]).appendTo(row.detTr);$(document.createElement("TD")).addClass('runner-cs').attr('colid',"endrecord").appendTo(row.detTr);}
row.detTd=$("#"+this.masterShortTName+"_previewcell"+row.id,row.detTr);}}
else{var colSpan=0;row.detTr=$(document.createElement("TR"));row.detTd=$(document.createElement("TD"));colSpan=row.row.find('td').length;row.row.after(row.detTr);row.detTd.appendTo(row.detTr).addClass('runner-dpinline').attr('colspan',colSpan);}},showDetails:function(respObj,row,params){respObj=JSON.parse(respObj);if(respObj.success===false){return;}
Runner.pages.PageSettings.addSettings(this.tName,respObj.settings,false);this.createPreviewRow(row);row.detCont=$(document.createElement("DIV"));var newId=params.id;row.detCont.attr('id','detailPreview'+newId).addClass('runner-pagewrapper').addClass(Runner.pages.PageSettings.getTableData(this.tName,"pageSkinStyle")).appendTo(row.detTd).html(respObj.html).before('<div id="dpHide'+newId+'" align="left"><img id="dpClose'+newId+'" src="images/search/closeRed.gif" valign="middle" style="cursor:pointer;margin-right:10px;">'+'<a href="'+$("#"+this.shortTName+"_preview"+row.id).attr('href')+'" name="dp'+newId+'">'+Runner.lang.constants.TEXT_PROCEED_TO+' '+this.tName+'</a></div>');$("#dpClose"+newId).bind("click",this.closeDetails.createDelegate(this,[row],true));row.isShown=true;row.startRequest=false;var baseParams={id:newId,mode:Runner.pages.constants.MODE_LIST_DETAILS,rndVal:Math.random(),masterpagetype:this.pageType,mastertable:this.masterTName,mainmasterpagetype:this.mainMasterPageType};var cfg={tName:this.tName,pageId:newId,pageType:this.pageType,controlsMap:respObj.controlsMap[this.tName][this.pageType][newId],pageMode:Runner.pages.constants.MODE_LIST_DETAILS,detCont:row.detCont,masterKeys:row.masterKeys,parId:this.parId,afterSaveDetails:{fn:function(allVals,fields,allKeys,allRowIds){this.submitMade=true;this.submitSucceded=true;this.getChildRecNum(row.masterKeys);this.fireEvent("detailsSaved",this,allVals,fields,allKeys,allRowIds);},scope:this},afterDeleteDetails:{fn:function(){this.getChildRecNum(row.masterKeys);},scope:this},saveFailed:{fn:function(respObj,formObj,fieldControls){this.submitMade=true;this.submitSucceded=false;this.fireEvent("saveFailed",this,respObj,formObj);},scope:this},afterInit:{fn:function(){this.fireEvent('afterInit',this,this.id);},scope:this},baseParams:Runner.apply(baseParams,row.masterKeys)};row.detPage=Runner.pages.PageManager.initPage(cfg);},getChildRecNum:function(masterKeys,rowId){var mKeys=[],i=0;for(var k in masterKeys){mKeys[i++]=masterKeys[k];}
var reqParams={mKeys:JSON.stringify(mKeys),dTable:this.tName,dSTable:this.shortTName,pageType:this.pageType,rndVal:Math.random(),mTable:this.masterTName,mSTable:this.masterShortTName}
$.get("detreccount.php",reqParams,function(resp,masterKeys){resp=JSON.parse(resp);if(resp.success){if(rowId!=undefined)
this.updateChildRecNumById(masterKeys,resp.recsCount,rowId);else
this.updateChildRecNum(masterKeys,resp.recsCount);}}.createDelegate(this,[masterKeys],1));},updateChildRecNumById:function(masterKeys,detNum,rowId){for(var i=0;i<this.rows.length;i++){if(this.rows[i].id==rowId){this.setChildRecNum(this.rows[i],detNum);this.rows[i].masterKeys=masterKeys;}}},updateChildRecNum:function(masterKeys,detNum){var mKeysAsString=JSON.stringify(masterKeys);for(var i=0;i<this.rows.length;i++){if(mKeysAsString==JSON.stringify(this.rows[i].masterKeys)){this.setChildRecNum(this.rows[i],detNum);}}},setChildRecNum:function(row,detNum){var spanCont=$("#cntDet_"+this.shortTName+"_"+row.id);if(!spanCont.length){spanCont=row.row.find('#'+this.shortTName+'_preview'+row.id).find('span').attr('id',"#cntDet_"+this.shortTName+"_"+row.id);if(!spanCont.attr('id'))
spanCont=row.row.find('#master_'+this.shortTName+"_"+row.id).find('span').attr('id',"#cntDet_"+this.shortTName+"_"+row.id);}
if(!parseInt(detNum)){if(this.hideChild)
spanCont.parent().hide();else
spanCont.parent().show();spanCont.html("");}else{spanCont.html("("+parseInt(detNum)+")");if(spanCont.parent().css('display')=='none')
spanCont.parent().show();}},closeDetailsByInd:function(ind){var row=this.getRowByInd(ind);if(row){this.closeDetails(null,row);}},closeDetailsById:function(rowId){var row=this.getRowById(rowId);if(row){this.closeDetails(null,row);}},closeDetails:function(e,row){if(!row.isShown){return false;}
row.detPage.destructor();row.detPage=null;if((this.recsPerRowList>1)&&(!this.isTdReset(row))){this.resetCell(row);}
else{row.detTr.remove();row.detTr=null;row.detTd.remove();row.detTd=null;}
row.detCont.remove();row.detCont=null;row.isShown=false;return true;},isTdReset:function(row){var removeTd=false;for(var i=0;i<row.detLinksId.length;i++){var dpTd=$("#"+this.masterShortTName+"_previewcell"+row.detLinksId[i]);if(row.detLinksId[i]!=row.id){if(dpTd.html()==''){removeTd=true;}
else{return false;}}}
return removeTd;},resetCell:function(row){row.detTd.empty();},getRowByInd:function(ind){for(var i=0;i<this.rows.length;i++){if(this.rows[i].rowInd==ind){return this.rows[i];}}
return false;},getRowById:function(id){for(var i=0;i<this.rows.length;i++){if(this.rows[i].id==id){return this.rows[i];}}
return false;},saveRow:function(){this.initRow(row);},destructor:function(){for(var i=0;i<this.rows.length;i++){this.closeDetails(null,this.rows[i]);}}})
Runner.util.details.DPPopUp=Runner.extend(Runner.util.details.ListDP,{timeout:null,masterDetails:null,constructor:function(cfg){Runner.util.details.DPPopUp.superclass.constructor.call(this,cfg);this.masterDetails={show:false,flag:"",counter:0};},init:function(){Runner.util.details.DPPopUp.superclass.init.call(this);},showPopup:function(obj,str){clearTimeout(this.timeout);var pageObj=this;if($('.runner-details-popup').css("display")=='none'||(str!=undefined&&str!=pageObj.masterDetails.flag)){this.timeout=setTimeout(function(){pageObj.masterDetails.flag=str;pageObj.masterDetails.show=true;pageObj.masterDetails.counter++;$.get(str,{counter:pageObj.masterDetails.counter,rndVal:(new Date().getTime())},function(txt){if(!pageObj.masterDetails.show)
return;if($(".runner-details-popup").length>0)
$(".runner-details-popup").remove();var viewContainer=Runner.getAbsoluteParent(obj);$(viewContainer).prepend('<div class="runner-details-popup"> </div>');$(".runner-details-popup").css({"display":"none","position":"absolute"});var str=txt.split("counterSeparator");if(pageObj.masterDetails.counter==str[1]){$(".runner-details-popup").html(str[0]);if(str[2]){$(".runner-details-popup").attr("class","runner-details-popup page-detailspreview runner-pagewrapper "+str[4]);Runner.util.ScriptLoader.loadCSS([str[2]],true);Runner.util.ScriptLoader.loadCSS([str[3]]);}}
$(".runner-details-popup").show();pageObj.LeftTop(obj,$(".runner-details-popup").get(0),viewContainer);});},200);}},hidePopup:function(){this.masterDetails.show=false;if($('.runner-details-popup').css("display")=='none'){clearTimeout(this.timeout);}else{this.timeout=setTimeout(function(){$(".runner-details-popup").hide();$(".runner-details-popup").html("");},10);}},LeftTop:function(link,preview,viewContainer){if(!this.masterDetails.show){return;}
var scrollBarWidth=16,linkAbsPos=Runner.getAbsolutePosition(link,1),linkScroll=Runner.getElementScroll(link),viewContainerPosition=Runner.getPosition(viewContainer),objectOffsetFromBorders=2,newTop=0,newLeft=0,winDim=Runner.getWindowDimensions(),clientWidth=winDim.width,clientHeight=winDim.height,scroll=Runner.getScrollXY(),viewBottomX=clientWidth+scroll.x,elementBottomX=linkAbsPos.left+linkAbsPos.width+preview.offsetWidth-linkScroll.x+viewContainerPosition.left,viewBottomY=clientHeight+scroll.y,elementBottomY=linkAbsPos.top+linkAbsPos.height+preview.offsetHeight-linkScroll.y+viewContainerPosition.top;if(elementBottomX>viewBottomX){newLeft=linkAbsPos.left+linkAbsPos.width-(elementBottomX-viewBottomX)-objectOffsetFromBorders-scrollBarWidth;if(newLeft<0){newLeft=0;}
newTop=linkAbsPos.top+linkAbsPos.height+5-linkScroll.y;}else{newLeft=linkAbsPos.left+linkAbsPos.width+5-linkScroll.x;newTop=linkAbsPos.top-linkScroll.y;}
if(elementBottomY>viewBottomY){newTop=linkAbsPos.top+linkAbsPos.height-(elementBottomY-viewBottomY)-objectOffsetFromBorders-scrollBarWidth-linkScroll.y;if(newTop<0){newTop=0;}}
$(preview).css("left",""+newLeft+"px");$(preview).css("top",""+newTop+"px");}});Runner.util.details.recDP=Runner.extend(Runner.util.details.DP,{listPageObj:null,submitMade:true,submitSucceded:true,useChildCount:false,init:function(id){Runner.util.details.recDP.superclass.init.call(this);this.initButton(id);this.initDpPage(id);this.addEvents('detailsSaved');if(this.detailsSaved){this.on({'detailsSaved':this.detailsSaved});}
if(this.saveFailed){this.on({'saveFailed':this.saveFailed});}},initDpPage:function(id,cfg){if(typeof id=="undefined"){id=this.id;}
cfg=cfg||{};Runner.apply(cfg,{tName:this.tName,pageType:Runner.pages.constants.PAGE_LIST,pageId:id,controlsMap:this.controlsMap,masterTName:this.masterTName,detCont:$("#detailPreview"+this.id),useChildCount:this.useChildCount,childRecNum:0,parId:this.parId,pageMode:Runner.pages.constants.MODE_LIST_DETAILS,baseParams:{id:id,mode:Runner.pages.constants.MODE_LIST_DETAILS,rndVal:Math.random(),masterpagetype:this.pageType},afterSaveDetails:{fn:function(allVals,fields,allKeys,allRowIds){this.submitMade=true;this.submitSucceded=true;this.fireEvent("detailsSaved",this,allVals,fields,allKeys,allRowIds);},scope:this},saveFailed:{fn:function(respObj,formObj,fieldControls){this.submitMade=true;this.submitSucceded=false;this.fireEvent("saveFailed",this,respObj,formObj);},scope:this}});this.listPageObj=Runner.pages.PageManager.initPage(cfg);return this.listPageObj;},initButton:function(id){if(typeof id=="undefined"){id=this.id;}
$("#dpMinus"+this.id).bind("click",function(e){$("#detailPreview"+id).toggle();var src=$("#dpMinus"+id).attr('src');if(src=='images/minus.gif'){$("#dpMinus"+id).attr('src','images/plus.gif');}else{$("#dpMinus"+id).attr('src','images/minus.gif');}});},saveDetails:function(){this.submitSucceded=false;this.submitMade=false;this.listPageObj.saveAll();},validate:function(){var addValidRes=false,editValidRes=false;if(this.listPageObj.inlineEdit){addValidRes=this.listPageObj.inlineEdit.validate();}
if(this.listPageObj.inlineAdd){editValidRes=this.listPageObj.inlineAdd.validate();}
return editValidRes&&addValidRes;},destructor:function(){if(this.listPageObj){this.listPageObj.destructor();}}});Runner.util.details.AddDP=Runner.extend(Runner.util.details.recDP,{constructor:function(cfg){this.pageType=Runner.pages.constants.PAGE_ADD;Runner.util.details.AddDP.superclass.constructor.call(this,cfg);},initDpPage:function(id){id=id||this.id;var cfg={hideSaveButt:true,afterInit:{fn:function(pageObj,pageId){if(pageObj.inlineAdd){pageObj.inlineAdd.inlineAdd(true,true);pageObj.inlineAdd.on("createControls",function(row,ctrlsArr){if(this.inlineAddChangeContent){return true;}
var cntrlType,eventName='change',delay=0;for(var i=0;i<ctrlsArr.length;i++){cntrlType=ctrlsArr[i].getControlType();eventName='change';if(cntrlType=='checkbox'||cntrlType=='radio'){eventName='click';}else if(cntrlType=='text'||cntrlType=='password'||cntrlType=='textarea'){eventName='keyup';}else if(cntrlType=='RTE'){eventName='blur';}
ctrlsArr[i].on(eventName,function(e,row){this.inlineAddChangeContent=true;this.getEditBlock(row,false,true);},{single:true,args:[row]},this);}},pageObj.inlineAdd);}},scope:this}};Runner.util.details.AddDP.superclass.initDpPage.call(this,id,cfg);this.listPageObj.on('beforeSave',function(row,inlineObj,formObj){if(inlineObj.inlineAddChangeContent!==true){inlineObj.cancelAll();return false;}},this);return this.listPageObj;},init:function(){Runner.util.details.AddDP.superclass.init.call(this);},saveDetails:function(mKeys){this.listPageObj.saveAll(mKeys);}});Runner.util.details.EditDP=Runner.extend(Runner.util.details.recDP,{constructor:function(cfg){this.pageType=Runner.pages.constants.PAGE_EDIT;Runner.util.details.EditDP.superclass.constructor.call(this,cfg);},init:function(){Runner.util.details.EditDP.superclass.init.call(this);}});Runner.util.details.ViewDP=Runner.extend(Runner.util.details.recDP,{constructor:function(cfg){this.pageType=Runner.pages.constants.PAGE_VIEW;Runner.util.details.ViewDP.superclass.constructor.call(this,cfg);}});